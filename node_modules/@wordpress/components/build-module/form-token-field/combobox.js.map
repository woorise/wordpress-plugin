{"version":3,"sources":["@wordpress/components/src/form-token-field/combobox.js"],"names":["take","difference","each","identity","classnames","__","_n","sprintf","Component","withInstanceId","ENTER","UP","DOWN","LEFT","RIGHT","ESCAPE","isShallowEqual","TokenInput","SuggestionsList","withSpokenMessages","initialState","incompleteTokenValue","isActive","isExpanded","selectedSuggestion","ComboboxControl","arguments","state","onKeyDown","bind","onFocus","onBlur","onContainerTouched","onSuggestionHovered","onSuggestionSelected","onInputChange","bindInput","bindTokensAndInput","updateSuggestions","prevProps","input","hasFocus","focus","props","suggestions","value","suggestionsDidUpdate","ref","tokensAndInput","event","target","setState","preventDefault","keyCode","handleLeftArrowKey","handleUpArrowKey","handleRightArrowKey","handleDownArrowKey","handleEscapeKey","stopPropagation","suggestion","text","matchingSuggestions","getMatchingSuggestions","index","indexOf","length","newValue","onChange","speak","messages","selected","searchValue","maxSuggestions","saveTransform","match","startsWithMatch","containsMatch","toLocaleLowerCase","push","concat","inputHasMinimumChars","trim","hasMatchingSuggestions","newState","debouncedSpeak","message","autoCapitalize","autoComplete","maxLength","instanceId","key","disabled","selectedSuggestionIndex","label","className","classes","tokenFieldProps","tabIndex","Object","assign","renderInput","displayTransform","defaultProps","freeze","isBorderless"],"mappings":"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","sourcesContent":["/**\n * External dependencies\n */\nimport { take, difference, each, identity } from 'lodash';\nimport classnames from 'classnames';\n\n/**\n * WordPress dependencies\n */\nimport { __, _n, sprintf } from '@wordpress/i18n';\nimport { Component } from '@wordpress/element';\nimport { withInstanceId } from '@wordpress/compose';\nimport { ENTER, UP, DOWN, LEFT, RIGHT, ESCAPE } from '@wordpress/keycodes';\nimport isShallowEqual from '@wordpress/is-shallow-equal';\n\n/**\n * Internal dependencies\n */\nimport TokenInput from './token-input';\nimport SuggestionsList from './suggestions-list';\nimport withSpokenMessages from '../higher-order/with-spoken-messages';\n\nconst initialState = {\n\tincompleteTokenValue: '',\n\tisActive: false,\n\tisExpanded: false,\n\tselectedSuggestion: null,\n};\n\nclass ComboboxControl extends Component {\n\tconstructor() {\n\t\tsuper( ...arguments );\n\t\tthis.state = initialState;\n\t\tthis.onKeyDown = this.onKeyDown.bind( this );\n\t\tthis.onFocus = this.onFocus.bind( this );\n\t\tthis.onBlur = this.onBlur.bind( this );\n\t\tthis.onContainerTouched = this.onContainerTouched.bind( this );\n\t\tthis.onSuggestionHovered = this.onSuggestionHovered.bind( this );\n\t\tthis.onSuggestionSelected = this.onSuggestionSelected.bind( this );\n\t\tthis.onInputChange = this.onInputChange.bind( this );\n\t\tthis.bindInput = this.bindInput.bind( this );\n\t\tthis.bindTokensAndInput = this.bindTokensAndInput.bind( this );\n\t\tthis.updateSuggestions = this.updateSuggestions.bind( this );\n\t}\n\n\tcomponentDidUpdate( prevProps ) {\n\t\t// Make sure to focus the input when the isActive state is true.\n\t\tif ( this.state.isActive && ! this.input.hasFocus() ) {\n\t\t\tthis.input.focus();\n\t\t}\n\n\t\tconst { suggestions, value } = this.props;\n\t\tconst suggestionsDidUpdate = ! isShallowEqual(\n\t\t\tsuggestions,\n\t\t\tprevProps.suggestions\n\t\t);\n\t\tif ( suggestionsDidUpdate || value !== prevProps.value ) {\n\t\t\tthis.updateSuggestions();\n\t\t}\n\t}\n\n\tstatic getDerivedStateFromProps( props, state ) {\n\t\tif ( ! props.disabled || ! state.isActive ) {\n\t\t\treturn null;\n\t\t}\n\n\t\treturn {\n\t\t\tisActive: false,\n\t\t\tincompleteTokenValue: '',\n\t\t};\n\t}\n\n\tbindInput( ref ) {\n\t\tthis.input = ref;\n\t}\n\n\tbindTokensAndInput( ref ) {\n\t\tthis.tokensAndInput = ref;\n\t}\n\n\tonFocus( event ) {\n\t\t// If focus is on the input or on the container, set the isActive state to true.\n\t\tif ( this.input.hasFocus() || event.target === this.tokensAndInput ) {\n\t\t\tthis.setState( { isActive: true } );\n\t\t} else {\n\t\t\t/*\n\t\t\t * Otherwise, focus is on one of the token \"remove\" buttons and we\n\t\t\t * set the isActive state to false to prevent the input to be\n\t\t\t * re-focused, see componentDidUpdate().\n\t\t\t */\n\t\t\tthis.setState( { isActive: false } );\n\t\t}\n\n\t\tif ( 'function' === typeof this.props.onFocus ) {\n\t\t\tthis.props.onFocus( event );\n\t\t}\n\t}\n\n\tonBlur() {\n\t\tthis.setState( {\n\t\t\tisActive: false,\n\t\t\tincompleteTokenValue: this.props.value,\n\t\t\tisExpanded: false,\n\t\t} );\n\t}\n\n\tonKeyDown( event ) {\n\t\tlet preventDefault = false;\n\n\t\tswitch ( event.keyCode ) {\n\t\t\tcase ENTER:\n\t\t\t\tif ( this.state.selectedSuggestion ) {\n\t\t\t\t\tthis.onSuggestionSelected( this.state.selectedSuggestion );\n\t\t\t\t\tpreventDefault = true;\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase LEFT:\n\t\t\t\tpreventDefault = this.handleLeftArrowKey();\n\t\t\t\tbreak;\n\t\t\tcase UP:\n\t\t\t\tpreventDefault = this.handleUpArrowKey();\n\t\t\t\tbreak;\n\t\t\tcase RIGHT:\n\t\t\t\tpreventDefault = this.handleRightArrowKey();\n\t\t\t\tbreak;\n\t\t\tcase DOWN:\n\t\t\t\tpreventDefault = this.handleDownArrowKey();\n\t\t\t\tbreak;\n\t\t\tcase ESCAPE:\n\t\t\t\tpreventDefault = this.handleEscapeKey( event );\n\t\t\t\tevent.stopPropagation();\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tbreak;\n\t\t}\n\n\t\tif ( preventDefault ) {\n\t\t\tevent.preventDefault();\n\t\t}\n\t}\n\n\tonContainerTouched( event ) {\n\t\t// Prevent clicking/touching the tokensAndInput container from blurring\n\t\t// the input and adding the current token.\n\t\tif ( event.target === this.tokensAndInput && this.state.isActive ) {\n\t\t\tevent.preventDefault();\n\t\t}\n\t}\n\n\tonSuggestionHovered( suggestion ) {\n\t\tthis.setState( {\n\t\t\tselectedSuggestion: suggestion,\n\t\t} );\n\t}\n\n\tonInputChange( event ) {\n\t\tconst text = event.value;\n\t\tthis.setState( { incompleteTokenValue: text }, this.updateSuggestions );\n\t\tthis.props.onInputChange( text );\n\t}\n\n\thandleUpArrowKey() {\n\t\tconst matchingSuggestions = this.getMatchingSuggestions();\n\t\tconst index = matchingSuggestions.indexOf(\n\t\t\tthis.state.selectedSuggestion\n\t\t);\n\t\tif ( index === 0 || index === -1 ) {\n\t\t\tthis.setState( {\n\t\t\t\tselectedSuggestion:\n\t\t\t\t\tmatchingSuggestions[ matchingSuggestions.length - 1 ],\n\t\t\t} );\n\t\t} else {\n\t\t\tthis.setState( {\n\t\t\t\tselectedSuggestion: matchingSuggestions[ index - 1 ],\n\t\t\t} );\n\t\t}\n\n\t\treturn true; // preventDefault\n\t}\n\n\thandleDownArrowKey() {\n\t\tconst matchingSuggestions = this.getMatchingSuggestions();\n\t\tconst index = matchingSuggestions.indexOf(\n\t\t\tthis.state.selectedSuggestion\n\t\t);\n\t\tif ( index === matchingSuggestions.length - 1 || index === -1 ) {\n\t\t\tthis.setState( {\n\t\t\t\tselectedSuggestion: matchingSuggestions[ 0 ],\n\t\t\t} );\n\t\t} else {\n\t\t\tthis.setState( {\n\t\t\t\tselectedSuggestion: matchingSuggestions[ index + 1 ],\n\t\t\t} );\n\t\t}\n\t\treturn true; // preventDefault\n\t}\n\n\thandleEscapeKey( event ) {\n\t\tthis.setState( {\n\t\t\tincompleteTokenValue: event.target.value,\n\t\t\tisExpanded: false,\n\t\t\tselectedSuggestion: null,\n\t\t} );\n\t\treturn true; // preventDefault\n\t}\n\n\tonSuggestionSelected( newValue ) {\n\t\tthis.props.onChange( newValue );\n\t\tthis.props.speak( this.props.messages.selected, 'assertive' );\n\n\t\tif ( this.state.isActive ) {\n\t\t\tthis.input.focus();\n\t\t}\n\n\t\tthis.setState( {\n\t\t\tincompleteTokenValue: newValue,\n\t\t\tselectedSuggestion: null,\n\t\t\tisExpanded: false,\n\t\t} );\n\t}\n\n\tgetMatchingSuggestions(\n\t\tsearchValue = this.state.incompleteTokenValue,\n\t\tsuggestions = this.props.suggestions,\n\t\tvalue = this.props.value,\n\t\tmaxSuggestions = this.props.maxSuggestions,\n\t\tsaveTransform = this.props.saveTransform\n\t) {\n\t\tlet match = saveTransform( searchValue );\n\t\tconst startsWithMatch = [];\n\t\tconst containsMatch = [];\n\n\t\tif ( ! match || match.length === 0 ) {\n\t\t\tsuggestions = difference( suggestions, value );\n\t\t} else {\n\t\t\tmatch = match.toLocaleLowerCase();\n\n\t\t\teach( suggestions, ( suggestion ) => {\n\t\t\t\tconst index = suggestion.toLocaleLowerCase().indexOf( match );\n\t\t\t\tif ( index === 0 ) {\n\t\t\t\t\tstartsWithMatch.push( suggestion );\n\t\t\t\t} else if ( index > 0 ) {\n\t\t\t\t\tcontainsMatch.push( suggestion );\n\t\t\t\t}\n\t\t\t} );\n\n\t\t\tsuggestions = startsWithMatch.concat( containsMatch );\n\t\t}\n\n\t\treturn take( suggestions, maxSuggestions );\n\t}\n\n\tupdateSuggestions() {\n\t\tconst { incompleteTokenValue, selectedSuggestion } = this.state;\n\t\tconst inputHasMinimumChars =\n\t\t\t!! incompleteTokenValue && incompleteTokenValue.trim().length > 1;\n\t\tconst matchingSuggestions = this.getMatchingSuggestions(\n\t\t\tincompleteTokenValue\n\t\t);\n\t\tconst hasMatchingSuggestions = matchingSuggestions.length > 0;\n\n\t\tconst newState = {\n\t\t\tisExpanded: inputHasMinimumChars && hasMatchingSuggestions,\n\t\t};\n\n\t\tif ( matchingSuggestions.indexOf( selectedSuggestion ) === -1 ) {\n\t\t\tnewState.selectedSuggestion = null;\n\t\t}\n\n\t\tif (\n\t\t\t! incompleteTokenValue ||\n\t\t\tmatchingSuggestions.indexOf( this.props.value ) === -1\n\t\t) {\n\t\t\tthis.props.onChange( null );\n\t\t}\n\n\t\tthis.setState( newState );\n\n\t\tif ( inputHasMinimumChars ) {\n\t\t\tconst { debouncedSpeak } = this.props;\n\n\t\t\tconst message = hasMatchingSuggestions\n\t\t\t\t? sprintf(\n\t\t\t\t\t\t/* translators: %d: number of results. */\n\t\t\t\t\t\t_n(\n\t\t\t\t\t\t\t'%d result found, use up and down arrow keys to navigate.',\n\t\t\t\t\t\t\t'%d results found, use up and down arrow keys to navigate.',\n\t\t\t\t\t\t\tmatchingSuggestions.length\n\t\t\t\t\t\t),\n\t\t\t\t\t\tmatchingSuggestions.length\n\t\t\t\t  )\n\t\t\t\t: __( 'No results.' );\n\n\t\t\tdebouncedSpeak( message, 'assertive' );\n\t\t}\n\t}\n\n\trenderInput() {\n\t\tconst {\n\t\t\tautoCapitalize,\n\t\t\tautoComplete,\n\t\t\tmaxLength,\n\t\t\tvalue,\n\t\t\tinstanceId,\n\t\t} = this.props;\n\t\tconst matchingSuggestions = this.getMatchingSuggestions();\n\n\t\tlet props = {\n\t\t\tinstanceId,\n\t\t\tautoCapitalize,\n\t\t\tautoComplete,\n\t\t\tref: this.bindInput,\n\t\t\tkey: 'input',\n\t\t\tdisabled: this.props.disabled,\n\t\t\tvalue: this.state.incompleteTokenValue,\n\t\t\tonBlur: this.onBlur,\n\t\t\tisExpanded: this.state.isExpanded,\n\t\t\tselectedSuggestionIndex: matchingSuggestions.indexOf(\n\t\t\t\tthis.state.selectedSuggestion\n\t\t\t),\n\t\t};\n\n\t\tif ( ! ( maxLength && value.length >= maxLength ) ) {\n\t\t\tprops = { ...props, onChange: this.onInputChange };\n\t\t}\n\n\t\treturn <TokenInput { ...props } />;\n\t}\n\n\trender() {\n\t\tconst {\n\t\t\tdisabled,\n\t\t\tlabel = __( 'Select item' ),\n\t\t\tinstanceId,\n\t\t\tclassName,\n\t\t} = this.props;\n\t\tconst {\n\t\t\tisExpanded,\n\t\t\tselectedSuggestion,\n\t\t\tincompleteTokenValue,\n\t\t} = this.state;\n\t\tconst classes = classnames(\n\t\t\tclassName,\n\t\t\t'components-form-token-field__input-container',\n\t\t\t{\n\t\t\t\t'is-active': this.state.isActive,\n\t\t\t\t'is-disabled': disabled,\n\t\t\t}\n\t\t);\n\n\t\tlet tokenFieldProps = {\n\t\t\tclassName: 'components-form-token-field',\n\t\t\ttabIndex: '-1',\n\t\t};\n\t\tconst matchingSuggestions = this.getMatchingSuggestions();\n\n\t\tif ( ! disabled ) {\n\t\t\ttokenFieldProps = Object.assign( {}, tokenFieldProps, {\n\t\t\t\tonKeyDown: this.onKeyDown,\n\t\t\t\tonFocus: this.onFocus,\n\t\t\t} );\n\t\t}\n\n\t\t// Disable reason: There is no appropriate role which describes the\n\t\t// input container intended accessible usability.\n\t\t// TODO: Refactor click detection to use blur to stop propagation.\n\t\t/* eslint-disable jsx-a11y/no-static-element-interactions */\n\t\treturn (\n\t\t\t<div { ...tokenFieldProps }>\n\t\t\t\t<label\n\t\t\t\t\thtmlFor={ `components-form-token-input-${ instanceId }` }\n\t\t\t\t\tclassName=\"components-form-token-field__label\"\n\t\t\t\t>\n\t\t\t\t\t{ label }\n\t\t\t\t</label>\n\t\t\t\t<div\n\t\t\t\t\tref={ this.bindTokensAndInput }\n\t\t\t\t\tclassName={ classes }\n\t\t\t\t\ttabIndex=\"-1\"\n\t\t\t\t\tonMouseDown={ this.onContainerTouched }\n\t\t\t\t\tonTouchStart={ this.onContainerTouched }\n\t\t\t\t>\n\t\t\t\t\t{ this.renderInput() }\n\t\t\t\t\t{ isExpanded && (\n\t\t\t\t\t\t<SuggestionsList\n\t\t\t\t\t\t\tinstanceId={ instanceId }\n\t\t\t\t\t\t\tmatch={ this.props.saveTransform(\n\t\t\t\t\t\t\t\tincompleteTokenValue\n\t\t\t\t\t\t\t) }\n\t\t\t\t\t\t\tdisplayTransform={ this.props.displayTransform }\n\t\t\t\t\t\t\tsuggestions={ matchingSuggestions }\n\t\t\t\t\t\t\tselectedIndex={ matchingSuggestions.indexOf(\n\t\t\t\t\t\t\t\tselectedSuggestion\n\t\t\t\t\t\t\t) }\n\t\t\t\t\t\t\tonHover={ this.onSuggestionHovered }\n\t\t\t\t\t\t\tonSelect={ this.onSuggestionSelected }\n\t\t\t\t\t\t/>\n\t\t\t\t\t) }\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t);\n\t\t/* eslint-enable jsx-a11y/no-static-element-interactions */\n\t}\n}\n\nComboboxControl.defaultProps = {\n\tsuggestions: Object.freeze( [] ),\n\tmaxSuggestions: 100,\n\tvalue: null,\n\tdisplayTransform: identity,\n\tsaveTransform: identity,\n\tonChange: () => {},\n\tonInputChange: () => {},\n\tisBorderless: false,\n\tdisabled: false,\n\tmessages: {\n\t\tselected: __( 'Item selected.' ),\n\t},\n};\n\nexport default withSpokenMessages( withInstanceId( ComboboxControl ) );\n"]}