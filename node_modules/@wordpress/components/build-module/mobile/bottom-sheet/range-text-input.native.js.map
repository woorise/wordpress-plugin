{"version":3,"sources":["@wordpress/components/src/mobile/bottom-sheet/range-text-input.native.js"],"names":["AccessibilityInfo","View","TextInput","PixelRatio","AppState","Platform","Text","TouchableWithoutFeedback","Component","withPreferredColorScheme","__","sprintf","toFixed","removeNonDigit","styles","borderStyles","isIOS","OS","RangeTextInput","props","announceCurrentValue","bind","onInputFocus","onInputBlur","handleChangePixelRatio","onSubmitEditing","onChangeText","value","defaultValue","min","decimalNum","initialValue","fontScale","getFontScale","state","inputValue","controlValue","hasFocus","addEventListener","removeEventListener","clearTimeout","timeoutAnnounceValue","prevProps","prevState","setState","validValue","validateInput","_valueTextInput","focus","nextAppState","text","max","result","Math","onChange","textValue","replace","updateValue","nativeEvent","isNaN","Number","announcement","announceForAccessibility","getStylesFromColorScheme","children","textInputStyle","textInput","textInputDark","verticalBorderStyle","verticalBorder","verticalBorderDark","inputBorderStyles","borderStyle","isSelected","valueFinalStyle","width","textInputContainer","c"],"mappings":"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","sourcesContent":["/**\n * External dependencies\n */\nimport {\n\tAccessibilityInfo,\n\tView,\n\tTextInput,\n\tPixelRatio,\n\tAppState,\n\tPlatform,\n\tText,\n\tTouchableWithoutFeedback,\n} from 'react-native';\n\n/**\n * WordPress dependencies\n */\nimport { Component } from '@wordpress/element';\nimport { withPreferredColorScheme } from '@wordpress/compose';\nimport { __, sprintf } from '@wordpress/i18n';\n\n/**\n * Internal dependencies\n */\nimport { toFixed, removeNonDigit } from '../utils';\nimport styles from './styles.scss';\nimport borderStyles from './borderStyles.scss';\n\nconst isIOS = Platform.OS === 'ios';\n\nclass RangeTextInput extends Component {\n\tconstructor( props ) {\n\t\tsuper( props );\n\n\t\tthis.announceCurrentValue = this.announceCurrentValue.bind( this );\n\t\tthis.onInputFocus = this.onInputFocus.bind( this );\n\t\tthis.onInputBlur = this.onInputBlur.bind( this );\n\t\tthis.handleChangePixelRatio = this.handleChangePixelRatio.bind( this );\n\t\tthis.onSubmitEditing = this.onSubmitEditing.bind( this );\n\t\tthis.onChangeText = this.onChangeText.bind( this );\n\n\t\tconst { value, defaultValue, min, decimalNum } = props;\n\t\tconst initialValue = toFixed(\n\t\t\tvalue || defaultValue || min,\n\t\t\tdecimalNum\n\t\t);\n\n\t\tconst fontScale = this.getFontScale();\n\n\t\tthis.state = {\n\t\t\tfontScale,\n\t\t\tinputValue: initialValue,\n\t\t\tcontrolValue: initialValue,\n\t\t\thasFocus: false,\n\t\t};\n\t}\n\n\tcomponentDidMount() {\n\t\tAppState.addEventListener( 'change', this.handleChangePixelRatio );\n\t}\n\n\tcomponentWillUnmount() {\n\t\tAppState.removeEventListener( 'change', this.handleChangePixelRatio );\n\t\tclearTimeout( this.timeoutAnnounceValue );\n\t}\n\n\tcomponentDidUpdate( prevProps, prevState ) {\n\t\tconst { value } = this.props;\n\t\tconst { hasFocus, inputValue } = this.state;\n\n\t\tif ( prevProps.value !== value ) {\n\t\t\tthis.setState( { inputValue: value } );\n\t\t}\n\n\t\tif ( prevState.hasFocus !== hasFocus ) {\n\t\t\tconst validValue = this.validateInput( inputValue );\n\t\t\tthis.setState( { inputValue: validValue } );\n\t\t}\n\n\t\tif ( ! prevState.hasFocus && hasFocus ) {\n\t\t\tthis._valueTextInput.focus();\n\t\t}\n\t}\n\n\tgetFontScale() {\n\t\treturn PixelRatio.getFontScale() < 1 ? 1 : PixelRatio.getFontScale();\n\t}\n\n\thandleChangePixelRatio( nextAppState ) {\n\t\tif ( nextAppState === 'active' ) {\n\t\t\tthis.setState( { fontScale: this.getFontScale() } );\n\t\t}\n\t}\n\n\tonInputFocus() {\n\t\tthis.setState( {\n\t\t\thasFocus: true,\n\t\t} );\n\t}\n\n\tonInputBlur() {\n\t\tconst { inputValue } = this.state;\n\t\tthis.onChangeText( `${ inputValue }` );\n\t\tthis.setState( {\n\t\t\thasFocus: false,\n\t\t} );\n\t}\n\n\tvalidateInput( text ) {\n\t\tconst { min, max, decimalNum } = this.props;\n\t\tlet result = min;\n\t\tif ( ! text ) {\n\t\t\treturn min;\n\t\t}\n\n\t\tif ( typeof text === 'number' ) {\n\t\t\tresult = Math.max( text, min );\n\t\t\treturn max ? Math.min( result, max ) : result;\n\t\t}\n\n\t\tresult = Math.max( removeNonDigit( text, decimalNum ), min );\n\t\treturn max ? Math.min( result, max ) : result;\n\t}\n\n\tupdateValue( value ) {\n\t\tconst { onChange } = this.props;\n\t\tconst validValue = this.validateInput( value );\n\n\t\tthis.announceCurrentValue( `${ validValue }` );\n\n\t\tonChange( validValue );\n\t}\n\n\tonChangeText( textValue ) {\n\t\tconst { decimalNum } = this.props;\n\t\tconst inputValue = removeNonDigit( textValue, decimalNum );\n\n\t\ttextValue = inputValue.replace( ',', '.' );\n\t\ttextValue = toFixed( textValue, decimalNum );\n\t\tconst value = this.validateInput( textValue );\n\t\tthis.setState( {\n\t\t\tinputValue,\n\t\t\tcontrolValue: value,\n\t\t} );\n\t\tthis.updateValue( value );\n\t}\n\n\tonSubmitEditing( { nativeEvent: { text } } ) {\n\t\tconst { decimalNum } = this.props;\n\t\tconst { inputValue } = this.state;\n\n\t\tif ( ! isNaN( Number( text ) ) ) {\n\t\t\ttext = toFixed( text.replace( ',', '.' ), decimalNum );\n\t\t\tconst validValue = this.validateInput( text );\n\n\t\t\tif ( inputValue !== validValue ) {\n\t\t\t\tthis.setState( { inputValue: validValue } );\n\t\t\t\tthis.announceCurrentValue( `${ validValue }` );\n\t\t\t\tthis.props.onChange( validValue );\n\t\t\t}\n\t\t}\n\t}\n\n\tannounceCurrentValue( value ) {\n\t\t/* translators: %s: current cell value. */\n\t\tconst announcement = sprintf( __( 'Current value is %s' ), value );\n\t\tAccessibilityInfo.announceForAccessibility( announcement );\n\t}\n\n\trender() {\n\t\tconst { getStylesFromColorScheme, children } = this.props;\n\t\tconst { fontScale, inputValue, hasFocus } = this.state;\n\n\t\tconst textInputStyle = getStylesFromColorScheme(\n\t\t\tstyles.textInput,\n\t\t\tstyles.textInputDark\n\t\t);\n\n\t\tconst verticalBorderStyle = getStylesFromColorScheme(\n\t\t\tstyles.verticalBorder,\n\t\t\tstyles.verticalBorderDark\n\t\t);\n\n\t\tconst inputBorderStyles = [\n\t\t\ttextInputStyle,\n\t\t\tborderStyles.borderStyle,\n\t\t\thasFocus && borderStyles.isSelected,\n\t\t];\n\n\t\tconst valueFinalStyle = [\n\t\t\t! isIOS ? inputBorderStyles : verticalBorderStyle,\n\t\t\t{\n\t\t\t\twidth: 50 * fontScale,\n\t\t\t},\n\t\t];\n\n\t\treturn (\n\t\t\t<TouchableWithoutFeedback\n\t\t\t\tonPress={ this.onInputFocus }\n\t\t\t\taccessible={ false }\n\t\t\t>\n\t\t\t\t<View\n\t\t\t\t\tstyle={ [\n\t\t\t\t\t\tstyles.textInputContainer,\n\t\t\t\t\t\tisIOS && inputBorderStyles,\n\t\t\t\t\t] }\n\t\t\t\t\taccessible={ false }\n\t\t\t\t>\n\t\t\t\t\t{ isIOS || hasFocus ? (\n\t\t\t\t\t\t<TextInput\n\t\t\t\t\t\t\tref={ ( c ) => ( this._valueTextInput = c ) }\n\t\t\t\t\t\t\tstyle={ valueFinalStyle }\n\t\t\t\t\t\t\tonChangeText={ this.onChangeText }\n\t\t\t\t\t\t\tonSubmitEditing={ this.onSubmitEditing }\n\t\t\t\t\t\t\tonFocus={ this.onInputFocus }\n\t\t\t\t\t\t\tonBlur={ this.onInputBlur }\n\t\t\t\t\t\t\tkeyboardType=\"numeric\"\n\t\t\t\t\t\t\treturnKeyType=\"done\"\n\t\t\t\t\t\t\tnumberOfLines={ 1 }\n\t\t\t\t\t\t\tdefaultValue={ `${ inputValue }` }\n\t\t\t\t\t\t\tvalue={ inputValue }\n\t\t\t\t\t\t\tpointerEvents={ hasFocus ? 'auto' : 'none' }\n\t\t\t\t\t\t/>\n\t\t\t\t\t) : (\n\t\t\t\t\t\t<Text\n\t\t\t\t\t\t\tstyle={ valueFinalStyle }\n\t\t\t\t\t\t\tnumberOfLines={ 1 }\n\t\t\t\t\t\t\tellipsizeMode=\"clip\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t{ inputValue }\n\t\t\t\t\t\t</Text>\n\t\t\t\t\t) }\n\t\t\t\t\t{ children }\n\t\t\t\t</View>\n\t\t\t</TouchableWithoutFeedback>\n\t\t);\n\t}\n}\n\nexport default withPreferredColorScheme( RangeTextInput );\n"]}