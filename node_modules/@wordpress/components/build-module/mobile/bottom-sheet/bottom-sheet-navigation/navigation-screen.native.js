import { createElement } from "@wordpress/element";

/**
 * External dependencies
 */
import { useIsFocused, useNavigation, useFocusEffect } from '@react-navigation/native';
import { View, ScrollView, TouchableHighlight } from 'react-native';
import { debounce } from 'lodash';
/**
 * WordPress dependencies
 */

import { BottomSheetContext } from '@wordpress/components';
import { useRef, useCallback, useContext, useMemo } from '@wordpress/element';
/**
 * Internal dependencies
 */

import { BottomSheetNavigationContext } from './bottom-sheet-navigation-context';
import styles from './styles.scss';

var BottomSheetNavigationScreen = function BottomSheetNavigationScreen(_ref) {
  var children = _ref.children,
      fullScreen = _ref.fullScreen,
      isScrollable = _ref.isScrollable,
      isNested = _ref.isNested;
  var navigation = useNavigation();
  var heightRef = useRef({
    maxHeight: 0
  });
  var isFocused = useIsFocused();

  var _useContext = useContext(BottomSheetContext),
      onHandleHardwareButtonPress = _useContext.onHandleHardwareButtonPress,
      shouldEnableBottomSheetMaxHeight = _useContext.shouldEnableBottomSheetMaxHeight,
      setIsFullScreen = _useContext.setIsFullScreen,
      listProps = _useContext.listProps,
      safeAreaBottomInset = _useContext.safeAreaBottomInset;

  var _useContext2 = useContext(BottomSheetNavigationContext),
      setHeight = _useContext2.setHeight;

  var setHeightDebounce = useCallback(debounce(setHeight, 10), [setHeight]);
  useFocusEffect(useCallback(function () {
    onHandleHardwareButtonPress(function () {
      if (navigation.canGoBack()) {
        shouldEnableBottomSheetMaxHeight(true);
        navigation.goBack();
        return true;
      }

      onHandleHardwareButtonPress(null);
      return false;
    });

    if (fullScreen) {
      setHeight('100%');
      setIsFullScreen(true);
    } else if (heightRef.current.maxHeight !== 0) {
      setIsFullScreen(false);
      setHeight(heightRef.current.maxHeight);
    }

    return function () {};
  }, []));

  var onLayout = function onLayout(_ref2) {
    var nativeEvent = _ref2.nativeEvent;

    if (fullScreen) {
      return;
    }

    var height = nativeEvent.layout.height;

    if (heightRef.current.maxHeight !== height && isFocused) {
      heightRef.current.maxHeight = height;
      setHeightDebounce(height);
    }
  };

  return useMemo(function () {
    return isScrollable || isNested ? createElement(View, {
      onLayout: onLayout
    }, children) : createElement(ScrollView, listProps, createElement(TouchableHighlight, {
      accessible: false
    }, createElement(View, {
      onLayout: onLayout
    }, children, !isNested && createElement(View, {
      style: {
        height: safeAreaBottomInset || styles.scrollableContent.paddingBottom
      }
    }))));
  }, [children, isFocused, safeAreaBottomInset, listProps]);
};

export default BottomSheetNavigationScreen;
//# sourceMappingURL=navigation-screen.native.js.map