{"version":3,"sources":["@wordpress/components/src/focal-point-picker/index.js"],"names":["classnames","__","Component","createRef","withInstanceId","UP","DOWN","LEFT","RIGHT","BaseControl","Controls","FocalPoint","Grid","Media","MediaWrapper","MediaContainer","roundClamp","INITIAL_BOUNDS","FocalPointPicker","props","arguments","state","isDragging","bounds","percentages","value","containerRef","mediaRef","onMouseDown","startDrag","bind","onMouseUp","stopDrag","onKeyDown","onMouseMove","doDrag","ifDraggingStop","onChangeAtControls","updateValue","onChange","updateBounds","defaultView","current","ownerDocument","addEventListener","prevProps","url","x","y","setState","removeEventListener","clientWidth","clientHeight","dimensions","width","height","pickerDimensions","widthRatio","heightRatio","right","top","bottom","left","nextValue","nextPercentage","parseFloat","toFixed","calculateBounds","event","persist","focus","getValueFromPoint","pageX","pageY","shiftKey","onDragStart","onDragEnd","keyCode","includes","preventDefault","next","step","delta","axis","onDrag","point","byTenths","relativePoint","Math","max","min","nextX","nextY","containerNode","getBoundingClientRect","document","body","scrollTop","undefined","autoPlay","className","help","instanceId","label","iconCoordinates","classes","id","defaultProps"],"mappings":"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","sourcesContent":["/**\n * External dependencies\n */\nimport classnames from 'classnames';\n\n/**\n * WordPress dependencies\n */\nimport { __ } from '@wordpress/i18n';\nimport { Component, createRef } from '@wordpress/element';\nimport { withInstanceId } from '@wordpress/compose';\nimport { UP, DOWN, LEFT, RIGHT } from '@wordpress/keycodes';\n\n/**\n * Internal dependencies\n */\nimport BaseControl from '../base-control';\nimport Controls from './controls';\nimport FocalPoint from './focal-point';\nimport Grid from './grid';\nimport Media from './media';\nimport {\n\tMediaWrapper,\n\tMediaContainer,\n} from './styles/focal-point-picker-style';\nimport { roundClamp } from '../utils/math';\nimport { INITIAL_BOUNDS } from './utils';\n\nexport class FocalPointPicker extends Component {\n\tconstructor( props ) {\n\t\tsuper( ...arguments );\n\n\t\tthis.state = {\n\t\t\tisDragging: false,\n\t\t\tbounds: INITIAL_BOUNDS,\n\t\t\tpercentages: props.value,\n\t\t};\n\n\t\tthis.containerRef = createRef();\n\t\tthis.mediaRef = createRef();\n\n\t\tthis.onMouseDown = this.startDrag.bind( this );\n\t\tthis.onMouseUp = this.stopDrag.bind( this );\n\t\tthis.onKeyDown = this.onKeyDown.bind( this );\n\t\tthis.onMouseMove = this.doDrag.bind( this );\n\t\tthis.ifDraggingStop = () => {\n\t\t\tif ( this.state.isDragging ) {\n\t\t\t\tthis.stopDrag();\n\t\t\t}\n\t\t};\n\t\tthis.onChangeAtControls = ( value ) => {\n\t\t\tthis.updateValue( value );\n\t\t\tthis.props.onChange( value );\n\t\t};\n\n\t\tthis.updateBounds = this.updateBounds.bind( this );\n\t\tthis.updateValue = this.updateValue.bind( this );\n\t}\n\tcomponentDidMount() {\n\t\tconst { defaultView } = this.containerRef.current.ownerDocument;\n\t\tdefaultView.addEventListener( 'resize', this.updateBounds );\n\n\t\t/*\n\t\t * Set initial bound values.\n\t\t *\n\t\t * This is necessary for Safari:\n\t\t * https://github.com/WordPress/gutenberg/issues/25814\n\t\t */\n\t\tthis.updateBounds();\n\t}\n\tcomponentDidUpdate( prevProps ) {\n\t\tif ( prevProps.url !== this.props.url ) {\n\t\t\tthis.ifDraggingStop();\n\t\t}\n\t\t/*\n\t\t * Handles cases where the incoming value changes.\n\t\t * An example is the values resetting based on an UNDO action.\n\t\t */\n\t\tconst {\n\t\t\tisDragging,\n\t\t\tpercentages: { x, y },\n\t\t} = this.state;\n\t\tconst { value } = this.props;\n\t\tif ( ! isDragging && ( value.x !== x || value.y !== y ) ) {\n\t\t\tthis.setState( { percentages: this.props.value } );\n\t\t}\n\t}\n\tcomponentWillUnmount() {\n\t\tconst { defaultView } = this.containerRef.current.ownerDocument;\n\t\tdefaultView.removeEventListener( 'resize', this.updateBounds );\n\t\tthis.ifDraggingStop();\n\t}\n\tcalculateBounds() {\n\t\tconst bounds = INITIAL_BOUNDS;\n\n\t\tif ( ! this.mediaRef.current ) {\n\t\t\treturn bounds;\n\t\t}\n\n\t\t// Prevent division by zero when updateBounds runs in componentDidMount\n\t\tif (\n\t\t\tthis.mediaRef.current.clientWidth === 0 ||\n\t\t\tthis.mediaRef.current.clientHeight === 0\n\t\t) {\n\t\t\treturn bounds;\n\t\t}\n\n\t\tconst dimensions = {\n\t\t\twidth: this.mediaRef.current.clientWidth,\n\t\t\theight: this.mediaRef.current.clientHeight,\n\t\t};\n\n\t\tconst pickerDimensions = this.pickerDimensions();\n\n\t\tconst widthRatio = pickerDimensions.width / dimensions.width;\n\t\tconst heightRatio = pickerDimensions.height / dimensions.height;\n\n\t\tif ( heightRatio >= widthRatio ) {\n\t\t\tbounds.width = bounds.right = pickerDimensions.width;\n\t\t\tbounds.height = dimensions.height * widthRatio;\n\t\t\tbounds.top = ( pickerDimensions.height - bounds.height ) / 2;\n\t\t\tbounds.bottom = bounds.top + bounds.height;\n\t\t} else {\n\t\t\tbounds.height = bounds.bottom = pickerDimensions.height;\n\t\t\tbounds.width = dimensions.width * heightRatio;\n\t\t\tbounds.left = ( pickerDimensions.width - bounds.width ) / 2;\n\t\t\tbounds.right = bounds.left + bounds.width;\n\t\t}\n\t\treturn bounds;\n\t}\n\tupdateValue( nextValue = {} ) {\n\t\tconst { x, y } = nextValue;\n\n\t\tconst nextPercentage = {\n\t\t\tx: parseFloat( x ).toFixed( 2 ),\n\t\t\ty: parseFloat( y ).toFixed( 2 ),\n\t\t};\n\n\t\tthis.setState( { percentages: nextPercentage } );\n\t}\n\tupdateBounds() {\n\t\tthis.setState( {\n\t\t\tbounds: this.calculateBounds(),\n\t\t} );\n\t}\n\tstartDrag( event ) {\n\t\tevent.persist();\n\t\tthis.containerRef.current.focus();\n\t\tthis.setState( { isDragging: true } );\n\t\tconst { ownerDocument } = this.containerRef.current;\n\t\townerDocument.addEventListener( 'mouseup', this.onMouseUp );\n\t\townerDocument.addEventListener( 'mousemove', this.onMouseMove );\n\t\tconst value = this.getValueFromPoint(\n\t\t\t{ x: event.pageX, y: event.pageY },\n\t\t\tevent.shiftKey\n\t\t);\n\t\tthis.updateValue( value );\n\t\tthis.props.onDragStart?.( value, event );\n\t}\n\tstopDrag( event ) {\n\t\tconst { ownerDocument } = this.containerRef.current;\n\t\townerDocument.removeEventListener( 'mouseup', this.onMouseUp );\n\t\townerDocument.removeEventListener( 'mousemove', this.onMouseMove );\n\t\tthis.setState( { isDragging: false }, () => {\n\t\t\tthis.props.onChange( this.state.percentages );\n\t\t} );\n\t\tthis.props.onDragEnd?.( event );\n\t}\n\tonKeyDown( event ) {\n\t\tconst { keyCode, shiftKey } = event;\n\t\tif ( ! [ UP, DOWN, LEFT, RIGHT ].includes( keyCode ) ) return;\n\n\t\tevent.preventDefault();\n\n\t\tconst next = { ...this.state.percentages };\n\t\tconst step = shiftKey ? 0.1 : 0.01;\n\t\tconst delta = keyCode === UP || keyCode === LEFT ? -1 * step : step;\n\t\tconst axis = keyCode === UP || keyCode === DOWN ? 'y' : 'x';\n\t\tconst value = parseFloat( next[ axis ] ) + delta;\n\n\t\tnext[ axis ] = roundClamp( value, 0, 1, step );\n\n\t\tthis.updateValue( next );\n\t\tthis.props.onChange( next );\n\t}\n\tdoDrag( event ) {\n\t\t// Prevents text-selection when dragging.\n\t\tevent.preventDefault();\n\t\tconst value = this.getValueFromPoint(\n\t\t\t{ x: event.pageX, y: event.pageY },\n\t\t\tevent.shiftKey\n\t\t);\n\t\tthis.updateValue( value );\n\t\tthis.props.onDrag?.( value, event );\n\t}\n\tgetValueFromPoint( point, byTenths ) {\n\t\tconst { bounds } = this.state;\n\n\t\tconst pickerDimensions = this.pickerDimensions();\n\t\tconst relativePoint = {\n\t\t\tleft: point.x - pickerDimensions.left,\n\t\t\ttop: point.y - pickerDimensions.top,\n\t\t};\n\n\t\tconst left = Math.max(\n\t\t\tbounds.left,\n\t\t\tMath.min( relativePoint.left, bounds.right )\n\t\t);\n\t\tconst top = Math.max(\n\t\t\tbounds.top,\n\t\t\tMath.min( relativePoint.top, bounds.bottom )\n\t\t);\n\n\t\tlet nextX =\n\t\t\t( left - bounds.left ) /\n\t\t\t( pickerDimensions.width - bounds.left * 2 );\n\t\tlet nextY =\n\t\t\t( top - bounds.top ) / ( pickerDimensions.height - bounds.top * 2 );\n\n\t\t// Enables holding shift to jump values by 10%\n\t\tconst step = byTenths ? 0.1 : 0.01;\n\n\t\tnextX = roundClamp( nextX, 0, 1, step );\n\t\tnextY = roundClamp( nextY, 0, 1, step );\n\n\t\treturn { x: nextX, y: nextY };\n\t}\n\tpickerDimensions() {\n\t\tconst containerNode = this.containerRef.current;\n\n\t\tif ( ! containerNode ) {\n\t\t\treturn {\n\t\t\t\twidth: 0,\n\t\t\t\theight: 0,\n\t\t\t\tleft: 0,\n\t\t\t\ttop: 0,\n\t\t\t};\n\t\t}\n\n\t\tconst { clientHeight, clientWidth } = containerNode;\n\t\tconst { top, left } = containerNode.getBoundingClientRect();\n\n\t\treturn {\n\t\t\twidth: clientWidth,\n\t\t\theight: clientHeight,\n\t\t\ttop: top + document.body.scrollTop,\n\t\t\tleft,\n\t\t};\n\t}\n\ticonCoordinates() {\n\t\tconst {\n\t\t\tbounds,\n\t\t\tpercentages: { x, y },\n\t\t} = this.state;\n\n\t\tif ( bounds.left === undefined || bounds.top === undefined ) {\n\t\t\treturn {\n\t\t\t\tleft: '50%',\n\t\t\t\ttop: '50%',\n\t\t\t};\n\t\t}\n\n\t\tconst { width, height } = this.pickerDimensions();\n\t\treturn {\n\t\t\tleft: x * ( width - bounds.left * 2 ) + bounds.left,\n\t\t\ttop: y * ( height - bounds.top * 2 ) + bounds.top,\n\t\t};\n\t}\n\trender() {\n\t\tconst {\n\t\t\tautoPlay,\n\t\t\tclassName,\n\t\t\thelp,\n\t\t\tinstanceId,\n\t\t\tlabel,\n\t\t\turl,\n\t\t} = this.props;\n\t\tconst { bounds, isDragging, percentages } = this.state;\n\t\tconst iconCoordinates = this.iconCoordinates();\n\n\t\tconst classes = classnames(\n\t\t\t'components-focal-point-picker-control',\n\t\t\tclassName\n\t\t);\n\n\t\tconst id = `inspector-focal-point-picker-control-${ instanceId }`;\n\n\t\treturn (\n\t\t\t<BaseControl\n\t\t\t\tlabel={ label }\n\t\t\t\tid={ id }\n\t\t\t\thelp={ help }\n\t\t\t\tclassName={ classes }\n\t\t\t>\n\t\t\t\t<MediaWrapper className=\"components-focal-point-picker-wrapper\">\n\t\t\t\t\t<MediaContainer\n\t\t\t\t\t\tclassName=\"components-focal-point-picker\"\n\t\t\t\t\t\tonKeyDown={ this.onKeyDown }\n\t\t\t\t\t\tonMouseDown={ this.onMouseDown }\n\t\t\t\t\t\tonBlur={ this.ifDraggingStop }\n\t\t\t\t\t\tref={ this.containerRef }\n\t\t\t\t\t\trole=\"button\"\n\t\t\t\t\t\ttabIndex=\"-1\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<Grid\n\t\t\t\t\t\t\tbounds={ bounds }\n\t\t\t\t\t\t\tvalue={ percentages.x + percentages.y }\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<Media\n\t\t\t\t\t\t\talt={ __( 'Media preview' ) }\n\t\t\t\t\t\t\tautoPlay={ autoPlay }\n\t\t\t\t\t\t\tmediaRef={ this.mediaRef }\n\t\t\t\t\t\t\tonLoad={ this.updateBounds }\n\t\t\t\t\t\t\tsrc={ url }\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<FocalPoint\n\t\t\t\t\t\t\tcoordinates={ iconCoordinates }\n\t\t\t\t\t\t\tisDragging={ isDragging }\n\t\t\t\t\t\t/>\n\t\t\t\t\t</MediaContainer>\n\t\t\t\t</MediaWrapper>\n\t\t\t\t<Controls\n\t\t\t\t\tpercentages={ percentages }\n\t\t\t\t\tonChange={ this.onChangeAtControls }\n\t\t\t\t/>\n\t\t\t</BaseControl>\n\t\t);\n\t}\n}\n\nFocalPointPicker.defaultProps = {\n\tautoPlay: true,\n\tvalue: {\n\t\tx: 0.5,\n\t\ty: 0.5,\n\t},\n\turl: null,\n};\n\nexport default withInstanceId( FocalPointPicker );\n"]}