{"version":3,"sources":["@wordpress/components/src/focal-point-picker/index.js"],"names":["FocalPointPicker","props","arguments","state","isDragging","bounds","INITIAL_BOUNDS","percentages","value","containerRef","mediaRef","onMouseDown","startDrag","bind","onMouseUp","stopDrag","onKeyDown","onMouseMove","doDrag","ifDraggingStop","onChangeAtControls","updateValue","onChange","updateBounds","defaultView","current","ownerDocument","addEventListener","prevProps","url","x","y","setState","removeEventListener","clientWidth","clientHeight","dimensions","width","height","pickerDimensions","widthRatio","heightRatio","right","top","bottom","left","nextValue","nextPercentage","parseFloat","toFixed","calculateBounds","event","persist","focus","getValueFromPoint","pageX","pageY","shiftKey","onDragStart","onDragEnd","keyCode","UP","DOWN","LEFT","RIGHT","includes","preventDefault","next","step","delta","axis","onDrag","point","byTenths","relativePoint","Math","max","min","nextX","nextY","containerNode","getBoundingClientRect","document","body","scrollTop","undefined","autoPlay","className","help","instanceId","label","iconCoordinates","classes","id","Component","defaultProps"],"mappings":"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","sourcesContent":["/**\n * External dependencies\n */\nimport classnames from 'classnames';\n\n/**\n * WordPress dependencies\n */\nimport { __ } from '@wordpress/i18n';\nimport { Component, createRef } from '@wordpress/element';\nimport { withInstanceId } from '@wordpress/compose';\nimport { UP, DOWN, LEFT, RIGHT } from '@wordpress/keycodes';\n\n/**\n * Internal dependencies\n */\nimport BaseControl from '../base-control';\nimport Controls from './controls';\nimport FocalPoint from './focal-point';\nimport Grid from './grid';\nimport Media from './media';\nimport {\n\tMediaWrapper,\n\tMediaContainer,\n} from './styles/focal-point-picker-style';\nimport { roundClamp } from '../utils/math';\nimport { INITIAL_BOUNDS } from './utils';\n\nexport class FocalPointPicker extends Component {\n\tconstructor( props ) {\n\t\tsuper( ...arguments );\n\n\t\tthis.state = {\n\t\t\tisDragging: false,\n\t\t\tbounds: INITIAL_BOUNDS,\n\t\t\tpercentages: props.value,\n\t\t};\n\n\t\tthis.containerRef = createRef();\n\t\tthis.mediaRef = createRef();\n\n\t\tthis.onMouseDown = this.startDrag.bind( this );\n\t\tthis.onMouseUp = this.stopDrag.bind( this );\n\t\tthis.onKeyDown = this.onKeyDown.bind( this );\n\t\tthis.onMouseMove = this.doDrag.bind( this );\n\t\tthis.ifDraggingStop = () => {\n\t\t\tif ( this.state.isDragging ) {\n\t\t\t\tthis.stopDrag();\n\t\t\t}\n\t\t};\n\t\tthis.onChangeAtControls = ( value ) => {\n\t\t\tthis.updateValue( value );\n\t\t\tthis.props.onChange( value );\n\t\t};\n\n\t\tthis.updateBounds = this.updateBounds.bind( this );\n\t\tthis.updateValue = this.updateValue.bind( this );\n\t}\n\tcomponentDidMount() {\n\t\tconst { defaultView } = this.containerRef.current.ownerDocument;\n\t\tdefaultView.addEventListener( 'resize', this.updateBounds );\n\n\t\t/*\n\t\t * Set initial bound values.\n\t\t *\n\t\t * This is necessary for Safari:\n\t\t * https://github.com/WordPress/gutenberg/issues/25814\n\t\t */\n\t\tthis.updateBounds();\n\t}\n\tcomponentDidUpdate( prevProps ) {\n\t\tif ( prevProps.url !== this.props.url ) {\n\t\t\tthis.ifDraggingStop();\n\t\t}\n\t\t/*\n\t\t * Handles cases where the incoming value changes.\n\t\t * An example is the values resetting based on an UNDO action.\n\t\t */\n\t\tconst {\n\t\t\tisDragging,\n\t\t\tpercentages: { x, y },\n\t\t} = this.state;\n\t\tconst { value } = this.props;\n\t\tif ( ! isDragging && ( value.x !== x || value.y !== y ) ) {\n\t\t\tthis.setState( { percentages: this.props.value } );\n\t\t}\n\t}\n\tcomponentWillUnmount() {\n\t\tconst { defaultView } = this.containerRef.current.ownerDocument;\n\t\tdefaultView.removeEventListener( 'resize', this.updateBounds );\n\t\tthis.ifDraggingStop();\n\t}\n\tcalculateBounds() {\n\t\tconst bounds = INITIAL_BOUNDS;\n\n\t\tif ( ! this.mediaRef.current ) {\n\t\t\treturn bounds;\n\t\t}\n\n\t\t// Prevent division by zero when updateBounds runs in componentDidMount\n\t\tif (\n\t\t\tthis.mediaRef.current.clientWidth === 0 ||\n\t\t\tthis.mediaRef.current.clientHeight === 0\n\t\t) {\n\t\t\treturn bounds;\n\t\t}\n\n\t\tconst dimensions = {\n\t\t\twidth: this.mediaRef.current.clientWidth,\n\t\t\theight: this.mediaRef.current.clientHeight,\n\t\t};\n\n\t\tconst pickerDimensions = this.pickerDimensions();\n\n\t\tconst widthRatio = pickerDimensions.width / dimensions.width;\n\t\tconst heightRatio = pickerDimensions.height / dimensions.height;\n\n\t\tif ( heightRatio >= widthRatio ) {\n\t\t\tbounds.width = bounds.right = pickerDimensions.width;\n\t\t\tbounds.height = dimensions.height * widthRatio;\n\t\t\tbounds.top = ( pickerDimensions.height - bounds.height ) / 2;\n\t\t\tbounds.bottom = bounds.top + bounds.height;\n\t\t} else {\n\t\t\tbounds.height = bounds.bottom = pickerDimensions.height;\n\t\t\tbounds.width = dimensions.width * heightRatio;\n\t\t\tbounds.left = ( pickerDimensions.width - bounds.width ) / 2;\n\t\t\tbounds.right = bounds.left + bounds.width;\n\t\t}\n\t\treturn bounds;\n\t}\n\tupdateValue( nextValue = {} ) {\n\t\tconst { x, y } = nextValue;\n\n\t\tconst nextPercentage = {\n\t\t\tx: parseFloat( x ).toFixed( 2 ),\n\t\t\ty: parseFloat( y ).toFixed( 2 ),\n\t\t};\n\n\t\tthis.setState( { percentages: nextPercentage } );\n\t}\n\tupdateBounds() {\n\t\tthis.setState( {\n\t\t\tbounds: this.calculateBounds(),\n\t\t} );\n\t}\n\tstartDrag( event ) {\n\t\tevent.persist();\n\t\tthis.containerRef.current.focus();\n\t\tthis.setState( { isDragging: true } );\n\t\tconst { ownerDocument } = this.containerRef.current;\n\t\townerDocument.addEventListener( 'mouseup', this.onMouseUp );\n\t\townerDocument.addEventListener( 'mousemove', this.onMouseMove );\n\t\tconst value = this.getValueFromPoint(\n\t\t\t{ x: event.pageX, y: event.pageY },\n\t\t\tevent.shiftKey\n\t\t);\n\t\tthis.updateValue( value );\n\t\tthis.props.onDragStart?.( value, event );\n\t}\n\tstopDrag( event ) {\n\t\tconst { ownerDocument } = this.containerRef.current;\n\t\townerDocument.removeEventListener( 'mouseup', this.onMouseUp );\n\t\townerDocument.removeEventListener( 'mousemove', this.onMouseMove );\n\t\tthis.setState( { isDragging: false }, () => {\n\t\t\tthis.props.onChange( this.state.percentages );\n\t\t} );\n\t\tthis.props.onDragEnd?.( event );\n\t}\n\tonKeyDown( event ) {\n\t\tconst { keyCode, shiftKey } = event;\n\t\tif ( ! [ UP, DOWN, LEFT, RIGHT ].includes( keyCode ) ) return;\n\n\t\tevent.preventDefault();\n\n\t\tconst next = { ...this.state.percentages };\n\t\tconst step = shiftKey ? 0.1 : 0.01;\n\t\tconst delta = keyCode === UP || keyCode === LEFT ? -1 * step : step;\n\t\tconst axis = keyCode === UP || keyCode === DOWN ? 'y' : 'x';\n\t\tconst value = parseFloat( next[ axis ] ) + delta;\n\n\t\tnext[ axis ] = roundClamp( value, 0, 1, step );\n\n\t\tthis.updateValue( next );\n\t\tthis.props.onChange( next );\n\t}\n\tdoDrag( event ) {\n\t\t// Prevents text-selection when dragging.\n\t\tevent.preventDefault();\n\t\tconst value = this.getValueFromPoint(\n\t\t\t{ x: event.pageX, y: event.pageY },\n\t\t\tevent.shiftKey\n\t\t);\n\t\tthis.updateValue( value );\n\t\tthis.props.onDrag?.( value, event );\n\t}\n\tgetValueFromPoint( point, byTenths ) {\n\t\tconst { bounds } = this.state;\n\n\t\tconst pickerDimensions = this.pickerDimensions();\n\t\tconst relativePoint = {\n\t\t\tleft: point.x - pickerDimensions.left,\n\t\t\ttop: point.y - pickerDimensions.top,\n\t\t};\n\n\t\tconst left = Math.max(\n\t\t\tbounds.left,\n\t\t\tMath.min( relativePoint.left, bounds.right )\n\t\t);\n\t\tconst top = Math.max(\n\t\t\tbounds.top,\n\t\t\tMath.min( relativePoint.top, bounds.bottom )\n\t\t);\n\n\t\tlet nextX =\n\t\t\t( left - bounds.left ) /\n\t\t\t( pickerDimensions.width - bounds.left * 2 );\n\t\tlet nextY =\n\t\t\t( top - bounds.top ) / ( pickerDimensions.height - bounds.top * 2 );\n\n\t\t// Enables holding shift to jump values by 10%\n\t\tconst step = byTenths ? 0.1 : 0.01;\n\n\t\tnextX = roundClamp( nextX, 0, 1, step );\n\t\tnextY = roundClamp( nextY, 0, 1, step );\n\n\t\treturn { x: nextX, y: nextY };\n\t}\n\tpickerDimensions() {\n\t\tconst containerNode = this.containerRef.current;\n\n\t\tif ( ! containerNode ) {\n\t\t\treturn {\n\t\t\t\twidth: 0,\n\t\t\t\theight: 0,\n\t\t\t\tleft: 0,\n\t\t\t\ttop: 0,\n\t\t\t};\n\t\t}\n\n\t\tconst { clientHeight, clientWidth } = containerNode;\n\t\tconst { top, left } = containerNode.getBoundingClientRect();\n\n\t\treturn {\n\t\t\twidth: clientWidth,\n\t\t\theight: clientHeight,\n\t\t\ttop: top + document.body.scrollTop,\n\t\t\tleft,\n\t\t};\n\t}\n\ticonCoordinates() {\n\t\tconst {\n\t\t\tbounds,\n\t\t\tpercentages: { x, y },\n\t\t} = this.state;\n\n\t\tif ( bounds.left === undefined || bounds.top === undefined ) {\n\t\t\treturn {\n\t\t\t\tleft: '50%',\n\t\t\t\ttop: '50%',\n\t\t\t};\n\t\t}\n\n\t\tconst { width, height } = this.pickerDimensions();\n\t\treturn {\n\t\t\tleft: x * ( width - bounds.left * 2 ) + bounds.left,\n\t\t\ttop: y * ( height - bounds.top * 2 ) + bounds.top,\n\t\t};\n\t}\n\trender() {\n\t\tconst {\n\t\t\tautoPlay,\n\t\t\tclassName,\n\t\t\thelp,\n\t\t\tinstanceId,\n\t\t\tlabel,\n\t\t\turl,\n\t\t} = this.props;\n\t\tconst { bounds, isDragging, percentages } = this.state;\n\t\tconst iconCoordinates = this.iconCoordinates();\n\n\t\tconst classes = classnames(\n\t\t\t'components-focal-point-picker-control',\n\t\t\tclassName\n\t\t);\n\n\t\tconst id = `inspector-focal-point-picker-control-${ instanceId }`;\n\n\t\treturn (\n\t\t\t<BaseControl\n\t\t\t\tlabel={ label }\n\t\t\t\tid={ id }\n\t\t\t\thelp={ help }\n\t\t\t\tclassName={ classes }\n\t\t\t>\n\t\t\t\t<MediaWrapper className=\"components-focal-point-picker-wrapper\">\n\t\t\t\t\t<MediaContainer\n\t\t\t\t\t\tclassName=\"components-focal-point-picker\"\n\t\t\t\t\t\tonKeyDown={ this.onKeyDown }\n\t\t\t\t\t\tonMouseDown={ this.onMouseDown }\n\t\t\t\t\t\tonBlur={ this.ifDraggingStop }\n\t\t\t\t\t\tref={ this.containerRef }\n\t\t\t\t\t\trole=\"button\"\n\t\t\t\t\t\ttabIndex=\"-1\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<Grid\n\t\t\t\t\t\t\tbounds={ bounds }\n\t\t\t\t\t\t\tvalue={ percentages.x + percentages.y }\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<Media\n\t\t\t\t\t\t\talt={ __( 'Media preview' ) }\n\t\t\t\t\t\t\tautoPlay={ autoPlay }\n\t\t\t\t\t\t\tmediaRef={ this.mediaRef }\n\t\t\t\t\t\t\tonLoad={ this.updateBounds }\n\t\t\t\t\t\t\tsrc={ url }\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<FocalPoint\n\t\t\t\t\t\t\tcoordinates={ iconCoordinates }\n\t\t\t\t\t\t\tisDragging={ isDragging }\n\t\t\t\t\t\t/>\n\t\t\t\t\t</MediaContainer>\n\t\t\t\t</MediaWrapper>\n\t\t\t\t<Controls\n\t\t\t\t\tpercentages={ percentages }\n\t\t\t\t\tonChange={ this.onChangeAtControls }\n\t\t\t\t/>\n\t\t\t</BaseControl>\n\t\t);\n\t}\n}\n\nFocalPointPicker.defaultProps = {\n\tautoPlay: true,\n\tvalue: {\n\t\tx: 0.5,\n\t\ty: 0.5,\n\t},\n\turl: null,\n};\n\nexport default withInstanceId( FocalPointPicker );\n"]}