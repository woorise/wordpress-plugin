{"version":3,"sources":["@wordpress/components/src/draggable/index.js"],"names":["dragImageClass","cloneWrapperClass","cloneHeightTransformationBreakpoint","clonePadding","bodyClass","Draggable","children","onDragStart","onDragOver","onDragEnd","cloneClassname","elementId","transferData","dragComponent","__experimentalDragComponent","dragComponentRef","cleanup","end","event","preventDefault","current","start","ownerDocument","target","dataTransfer","setData","JSON","stringify","cloneWrapper","createElement","dragImage","setDragImage","classList","add","body","appendChild","style","top","clientY","left","clientX","clonedDragComponent","innerHTML","element","getElementById","elementRect","getBoundingClientRect","elementWrapper","parentNode","elementTopOffset","parseInt","elementLeftOffset","width","clone","cloneNode","id","height","transform","transformOrigin","Array","from","querySelectorAll","forEach","child","removeChild","cursorLeft","cursorTop","over","e","addEventListener","persist","timerId","setTimeout","remove","removeEventListener","clearTimeout","onDraggableStart","onDraggableEnd","display"],"mappings":"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","sourcesContent":["/**\n * WordPress dependencies\n */\nimport { useEffect, useRef } from '@wordpress/element';\n\nconst dragImageClass = 'components-draggable__invisible-drag-image';\nconst cloneWrapperClass = 'components-draggable__clone';\nconst cloneHeightTransformationBreakpoint = 700;\nconst clonePadding = 0;\nconst bodyClass = 'is-dragging-components-draggable';\n\nexport default function Draggable( {\n\tchildren,\n\tonDragStart,\n\tonDragOver,\n\tonDragEnd,\n\tcloneClassname,\n\telementId,\n\ttransferData,\n\t__experimentalDragComponent: dragComponent,\n} ) {\n\tconst dragComponentRef = useRef();\n\tconst cleanup = useRef( () => {} );\n\n\t/**\n\t * Removes the element clone, resets cursor, and removes drag listener.\n\t *\n\t * @param {Object} event The non-custom DragEvent.\n\t */\n\tfunction end( event ) {\n\t\tevent.preventDefault();\n\t\tcleanup.current();\n\n\t\tif ( onDragOver ) {\n\t\t\tonDragEnd( event );\n\t\t}\n\t}\n\n\t/**\n\t * This method does a couple of things:\n\t *\n\t * - Clones the current element and spawns clone over original element.\n\t * - Adds a fake temporary drag image to avoid browser defaults.\n\t * - Sets transfer data.\n\t * - Adds dragover listener.\n\t *\n\t * @param {Object} event The non-custom DragEvent.\n\t */\n\tfunction start( event ) {\n\t\tconst { ownerDocument } = event.target;\n\n\t\tevent.dataTransfer.setData( 'text', JSON.stringify( transferData ) );\n\n\t\tconst cloneWrapper = ownerDocument.createElement( 'div' );\n\t\tconst dragImage = ownerDocument.createElement( 'div' );\n\n\t\t// Set a fake drag image to avoid browser defaults. Remove from DOM\n\t\t// right after. event.dataTransfer.setDragImage is not supported yet in\n\t\t// IE, we need to check for its existence first.\n\t\tif ( 'function' === typeof event.dataTransfer.setDragImage ) {\n\t\t\tdragImage.classList.add( dragImageClass );\n\t\t\townerDocument.body.appendChild( dragImage );\n\t\t\tevent.dataTransfer.setDragImage( dragImage, 0, 0 );\n\t\t}\n\n\t\tcloneWrapper.classList.add( cloneWrapperClass );\n\n\t\tif ( cloneClassname ) {\n\t\t\tcloneWrapper.classList.add( cloneClassname );\n\t\t}\n\n\t\t// If a dragComponent is defined, the following logic will clone the\n\t\t// HTML node and inject it into the cloneWrapper.\n\t\tif ( dragComponentRef.current ) {\n\t\t\t// Position dragComponent at the same position as the cursor.\n\t\t\tcloneWrapper.style.top = `${ event.clientY }px`;\n\t\t\tcloneWrapper.style.left = `${ event.clientX }px`;\n\n\t\t\tconst clonedDragComponent = ownerDocument.createElement( 'div' );\n\t\t\tclonedDragComponent.innerHTML = dragComponentRef.current.innerHTML;\n\t\t\tcloneWrapper.appendChild( clonedDragComponent );\n\n\t\t\t// Inject the cloneWrapper into the DOM.\n\t\t\townerDocument.body.appendChild( cloneWrapper );\n\t\t} else {\n\t\t\tconst element = ownerDocument.getElementById( elementId );\n\n\t\t\t// Prepare element clone and append to element wrapper.\n\t\t\tconst elementRect = element.getBoundingClientRect();\n\t\t\tconst elementWrapper = element.parentNode;\n\t\t\tconst elementTopOffset = parseInt( elementRect.top, 10 );\n\t\t\tconst elementLeftOffset = parseInt( elementRect.left, 10 );\n\n\t\t\tcloneWrapper.style.width = `${\n\t\t\t\telementRect.width + clonePadding * 2\n\t\t\t}px`;\n\n\t\t\tconst clone = element.cloneNode( true );\n\t\t\tclone.id = `clone-${ elementId }`;\n\n\t\t\tif ( elementRect.height > cloneHeightTransformationBreakpoint ) {\n\t\t\t\t// Scale down clone if original element is larger than 700px.\n\t\t\t\tcloneWrapper.style.transform = 'scale(0.5)';\n\t\t\t\tcloneWrapper.style.transformOrigin = 'top left';\n\t\t\t\t// Position clone near the cursor.\n\t\t\t\tcloneWrapper.style.top = `${ event.clientY - 100 }px`;\n\t\t\t\tcloneWrapper.style.left = `${ event.clientX }px`;\n\t\t\t} else {\n\t\t\t\t// Position clone right over the original element (20px padding).\n\t\t\t\tcloneWrapper.style.top = `${\n\t\t\t\t\telementTopOffset - clonePadding\n\t\t\t\t}px`;\n\t\t\t\tcloneWrapper.style.left = `${\n\t\t\t\t\telementLeftOffset - clonePadding\n\t\t\t\t}px`;\n\t\t\t}\n\n\t\t\t// Hack: Remove iFrames as it's causing the embeds drag clone to freeze\n\t\t\tArray.from(\n\t\t\t\tclone.querySelectorAll( 'iframe' )\n\t\t\t).forEach( ( child ) => child.parentNode.removeChild( child ) );\n\n\t\t\tcloneWrapper.appendChild( clone );\n\n\t\t\t// Inject the cloneWrapper into the DOM.\n\t\t\telementWrapper.appendChild( cloneWrapper );\n\t\t}\n\n\t\t// Mark the current cursor coordinates.\n\t\tlet cursorLeft = event.clientX;\n\t\tlet cursorTop = event.clientY;\n\n\t\tfunction over( e ) {\n\t\t\tcloneWrapper.style.top = `${\n\t\t\t\tparseInt( cloneWrapper.style.top, 10 ) + e.clientY - cursorTop\n\t\t\t}px`;\n\t\t\tcloneWrapper.style.left = `${\n\t\t\t\tparseInt( cloneWrapper.style.left, 10 ) + e.clientX - cursorLeft\n\t\t\t}px`;\n\n\t\t\t// Update cursor coordinates.\n\t\t\tcursorLeft = e.clientX;\n\t\t\tcursorTop = e.clientY;\n\n\t\t\tif ( onDragOver ) {\n\t\t\t\tonDragOver( e );\n\t\t\t}\n\t\t}\n\n\t\townerDocument.addEventListener( 'dragover', over );\n\n\t\t// Update cursor to 'grabbing', document wide.\n\t\townerDocument.body.classList.add( bodyClass );\n\n\t\t// Allow the Synthetic Event to be accessed from asynchronous code.\n\t\t// https://reactjs.org/docs/events.html#event-pooling\n\t\tevent.persist();\n\n\t\tlet timerId;\n\n\t\tif ( onDragStart ) {\n\t\t\ttimerId = setTimeout( () => onDragStart( event ) );\n\t\t}\n\n\t\tcleanup.current = () => {\n\t\t\t// Remove drag clone\n\t\t\tif ( cloneWrapper && cloneWrapper.parentNode ) {\n\t\t\t\tcloneWrapper.parentNode.removeChild( cloneWrapper );\n\t\t\t}\n\n\t\t\tif ( dragImage && dragImage.parentNode ) {\n\t\t\t\tdragImage.parentNode.removeChild( dragImage );\n\t\t\t}\n\n\t\t\t// Reset cursor.\n\t\t\townerDocument.body.classList.remove( bodyClass );\n\n\t\t\townerDocument.removeEventListener( 'dragover', over );\n\n\t\t\tclearTimeout( timerId );\n\t\t};\n\t}\n\n\tuseEffect(\n\t\t() => () => {\n\t\t\tcleanup.current();\n\t\t},\n\t\t[]\n\t);\n\n\treturn (\n\t\t<>\n\t\t\t{ children( {\n\t\t\t\tonDraggableStart: start,\n\t\t\t\tonDraggableEnd: end,\n\t\t\t} ) }\n\t\t\t{ dragComponent && (\n\t\t\t\t<div\n\t\t\t\t\tclassName=\"components-draggable-drag-component-root\"\n\t\t\t\t\tstyle={ { display: 'none' } }\n\t\t\t\t\tref={ dragComponentRef }\n\t\t\t\t>\n\t\t\t\t\t{ dragComponent }\n\t\t\t\t</div>\n\t\t\t) }\n\t\t</>\n\t);\n}\n"]}