"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.withNext = withNext;

var _element = require("@wordpress/element");

var _extends2 = _interopRequireDefault(require("@babel/runtime/helpers/extends"));

var _objectWithoutProperties2 = _interopRequireDefault(require("@babel/runtime/helpers/objectWithoutProperties"));

var _context = require("@wp-g2/context");

/**
 * External dependencies
 */

/**
 * @template {{}} TCurrentProps
 * @template {{}} TNextProps
 * @param {import('react').ForwardRefExoticComponent<TCurrentProps>} CurrentComponent
 * @param {import('react').ComponentType<TNextProps>} NextComponent
 * @param {string} namespace
 * @param {(props: TCurrentProps) => TNextProps} adapter
 */
function withNext(CurrentComponent) {
  var NextComponent = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : function () {
    return null;
  };
  var namespace = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 'Component';
  var adapter = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : function (p) {
    return (
      /** @type {any} */
      p
    );
  };

  if (process.env.COMPONENT_SYSTEM_PHASE === 1) {
    /* eslint-disable jsdoc/no-undefined-types */

    /**
     * @param {TCurrentProps} props
     * @param {import('react').Ref<any>} ref
     */

    /* eslint-enable jsdoc/no-undefined-types */
    var WrappedComponent = function WrappedComponent(props, ref) {
      // @ts-ignore
      var _useContextSystem = (0, _context.useContextSystem)(props, namespace),
          __unstableVersion = _useContextSystem.__unstableVersion,
          otherProps = (0, _objectWithoutProperties2.default)(_useContextSystem, ["__unstableVersion"]);

      if (__unstableVersion === 'next') {
        // @ts-ignore
        var nextProps = adapter(otherProps);
        return (0, _element.createElement)(NextComponent, (0, _extends2.default)({}, nextProps, {
          ref: ref
        }));
      }

      return (0, _element.createElement)(CurrentComponent, (0, _extends2.default)({}, props, {
        ref: ref
      }));
    };

    return (0, _context.contextConnect)(WrappedComponent, namespace);
  }

  return CurrentComponent;
}
//# sourceMappingURL=with-next.js.map