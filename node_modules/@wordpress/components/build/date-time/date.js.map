{"version":3,"sources":["@wordpress/components/src/date-time/date.js"],"names":["TIMEZONELESS_FORMAT","DatePicker","arguments","onChangeMoment","bind","nodeRef","keepFocusInside","isDayHighlighted","current","ownerDocument","activeElement","contains","focusRegion","querySelector","focus","newDate","props","currentDate","onChange","momentDate","momentTime","hours","minutes","seconds","set","format","date","events","length","onMonthPreviewed","toDate","some","highlighted","isSame","isInvalidDate","getMomentDate","Component"],"mappings":"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","sourcesContent":["/**\n * External dependencies\n */\nimport moment from 'moment';\n// react-dates doesn't tree-shake correctly, so we import from the individual\n// component here, to avoid including too much of the library\nimport DayPickerSingleDateController from 'react-dates/lib/components/DayPickerSingleDateController';\n\n/**\n * WordPress dependencies\n */\nimport { Component, createRef } from '@wordpress/element';\nimport { isRTL } from '@wordpress/i18n';\n\n/**\n * Module Constants\n */\nconst TIMEZONELESS_FORMAT = 'YYYY-MM-DDTHH:mm:ss';\n\nclass DatePicker extends Component {\n\tconstructor() {\n\t\tsuper( ...arguments );\n\n\t\tthis.onChangeMoment = this.onChangeMoment.bind( this );\n\t\tthis.nodeRef = createRef();\n\t\tthis.keepFocusInside = this.keepFocusInside.bind( this );\n\t\tthis.isDayHighlighted = this.isDayHighlighted.bind( this );\n\t}\n\n\t/*\n\t * Todo: We should remove this function ASAP.\n\t * It is kept because focus is lost when we click on the previous and next month buttons.\n\t * This focus loss closes the date picker popover.\n\t * Ideally we should add an upstream commit on react-dates to fix this issue.\n\t */\n\tkeepFocusInside() {\n\t\tif ( ! this.nodeRef.current ) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst { ownerDocument } = this.nodeRef.current;\n\t\tconst { activeElement } = ownerDocument;\n\n\t\t// If focus was lost.\n\t\tif (\n\t\t\t! activeElement ||\n\t\t\t! this.nodeRef.current.contains( ownerDocument.activeElement )\n\t\t) {\n\t\t\t// Retrieve the focus region div.\n\t\t\tconst focusRegion = this.nodeRef.current.querySelector(\n\t\t\t\t'.DayPicker_focusRegion'\n\t\t\t);\n\t\t\tif ( ! focusRegion ) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\t// Keep the focus on focus region.\n\t\t\tfocusRegion.focus();\n\t\t}\n\t}\n\n\tonChangeMoment( newDate ) {\n\t\tconst { currentDate, onChange } = this.props;\n\n\t\t// If currentDate is null, use now as momentTime to designate hours, minutes, seconds.\n\t\tconst momentDate = currentDate ? moment( currentDate ) : moment();\n\t\tconst momentTime = {\n\t\t\thours: momentDate.hours(),\n\t\t\tminutes: momentDate.minutes(),\n\t\t\tseconds: 0,\n\t\t};\n\n\t\tonChange( newDate.set( momentTime ).format( TIMEZONELESS_FORMAT ) );\n\n\t\t// Keep focus on the date picker.\n\t\tthis.keepFocusInside();\n\t}\n\n\t/**\n\t * Create a Moment object from a date string. With no currentDate supplied, default to a Moment\n\t * object representing now. If a null value is passed, return a null value.\n\t *\n\t * @param {?string} currentDate Date representing the currently selected date or null to signify no selection.\n\t * @return {?moment.Moment} Moment object for selected date or null.\n\t */\n\tgetMomentDate( currentDate ) {\n\t\tif ( null === currentDate ) {\n\t\t\treturn null;\n\t\t}\n\t\treturn currentDate ? moment( currentDate ) : moment();\n\t}\n\n\t// todo change reference to `isDayHighlighted` every time, `events` prop change\n\tisDayHighlighted( date ) {\n\t\t// Do not highlight when no events.\n\t\tif ( ! this.props.events?.length ) {\n\t\t\treturn false;\n\t\t}\n\t\tif ( this.props.onMonthPreviewed ) {\n\t\t\tthis.props.onMonthPreviewed( date.toDate() );\n\t\t}\n\n\t\t// Compare date against highlighted events.\n\t\treturn this.props.events.some( ( highlighted ) =>\n\t\t\tdate.isSame( highlighted.date, 'day' )\n\t\t);\n\t}\n\n\trender() {\n\t\tconst { currentDate, isInvalidDate } = this.props;\n\t\tconst momentDate = this.getMomentDate( currentDate );\n\n\t\treturn (\n\t\t\t<div className=\"components-datetime__date\" ref={ this.nodeRef }>\n\t\t\t\t<DayPickerSingleDateController\n\t\t\t\t\tdate={ momentDate }\n\t\t\t\t\tdaySize={ 30 }\n\t\t\t\t\tfocused\n\t\t\t\t\thideKeyboardShortcutsPanel\n\t\t\t\t\t// This is a hack to force the calendar to update on month or year change\n\t\t\t\t\t// https://github.com/airbnb/react-dates/issues/240#issuecomment-361776665\n\t\t\t\t\tkey={ `datepicker-controller-${\n\t\t\t\t\t\tmomentDate ? momentDate.format( 'MM-YYYY' ) : 'null'\n\t\t\t\t\t}` }\n\t\t\t\t\tnoBorder\n\t\t\t\t\tnumberOfMonths={ 1 }\n\t\t\t\t\tonDateChange={ this.onChangeMoment }\n\t\t\t\t\ttransitionDuration={ 0 }\n\t\t\t\t\tweekDayFormat=\"ddd\"\n\t\t\t\t\tisRTL={ isRTL() }\n\t\t\t\t\tisOutsideRange={ ( date ) => {\n\t\t\t\t\t\treturn isInvalidDate && isInvalidDate( date.toDate() );\n\t\t\t\t\t} }\n\t\t\t\t\tisDayHighlighted={ this.isDayHighlighted }\n\t\t\t\t\tonPrevMonthClick={ this.keepFocusInside }\n\t\t\t\t\tonNextMonthClick={ this.keepFocusInside }\n\t\t\t\t/>\n\t\t\t</div>\n\t\t);\n\t}\n}\n\nexport default DatePicker;\n"]}