"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.getValueAndUnit = exports.useConvertUnitToMobile = exports.convertUnitToMobile = void 0;

var _slicedToArray2 = _interopRequireDefault(require("@babel/runtime/helpers/slicedToArray"));

var _reactNative = require("react-native");

var _element = require("@wordpress/element");

var _globalStylesContext = _interopRequireDefault(require("../global-styles-context"));

/**
 * External dependencies
 */

/**
 * WordPress dependencies
 */

/**
 * Internal dependencies
 */
var getValueAndUnit = function getValueAndUnit(value, unit) {
  var _ref, _ref$match;

  var regex = /(\d+\.?\d*)(.*)/;
  var splitValue = (_ref = "".concat(value)) === null || _ref === void 0 ? void 0 : (_ref$match = _ref.match(regex)) === null || _ref$match === void 0 ? void 0 : _ref$match.filter(function (v) {
    return v !== '';
  });

  if (splitValue) {
    return {
      valueToConvert: splitValue[1],
      valueUnit: unit || splitValue[2]
    };
  }

  return undefined;
};

exports.getValueAndUnit = getValueAndUnit;

var convertUnitToMobile = function convertUnitToMobile(containerSize, globalStyles, value, unit) {
  var width = containerSize.width,
      height = containerSize.height;

  var _ref2 = getValueAndUnit(value, unit) || {},
      valueToConvert = _ref2.valueToConvert,
      valueUnit = _ref2.valueUnit;

  var _ref3 = globalStyles || {},
      _ref3$fontSize = _ref3.fontSize,
      fontSize = _ref3$fontSize === void 0 ? 16 : _ref3$fontSize;

  switch (valueUnit) {
    case 'rem':
    case 'em':
      return valueToConvert * fontSize;

    case '%':
      return Number(valueToConvert / 100) * width;

    case 'px':
      return Number(valueToConvert);

    case 'vw':
      var vw = width / 100;
      return Math.round(valueToConvert * vw);

    case 'vh':
      var vh = height / 100;
      return Math.round(valueToConvert * vh);

    default:
      return Number(valueToConvert / 100) * width;
  }
};

exports.convertUnitToMobile = convertUnitToMobile;

var useConvertUnitToMobile = function useConvertUnitToMobile(value, unit) {
  var _useContext = (0, _element.useContext)(_globalStylesContext.default),
      styles = _useContext.globalStyles;

  var _useState = (0, _element.useState)(_reactNative.Dimensions.get('window')),
      _useState2 = (0, _slicedToArray2.default)(_useState, 2),
      windowSizes = _useState2[0],
      setWindowSizes = _useState2[1];

  (0, _element.useEffect)(function () {
    _reactNative.Dimensions.addEventListener('change', onDimensionsChange);

    return function () {
      _reactNative.Dimensions.removeEventListener('change', onDimensionsChange);
    };
  }, []);
  var onDimensionsChange = (0, _element.useCallback)(function (_ref4) {
    var window = _ref4.window;
    setWindowSizes(window);
  }, []);
  return (0, _element.useMemo)(function () {
    var _getValueAndUnit = getValueAndUnit(value, unit),
        valueToConvert = _getValueAndUnit.valueToConvert,
        valueUnit = _getValueAndUnit.valueUnit;

    return convertUnitToMobile(windowSizes, styles, valueToConvert, valueUnit);
  }, [windowSizes, value, unit]);
};

exports.useConvertUnitToMobile = useConvertUnitToMobile;
//# sourceMappingURL=use-unit-converter-to-mobile.native.js.map