{"version":3,"sources":["@wordpress/block-editor/src/autocompleters/block.js"],"names":["SHOWN_BLOCK_TYPES","createBlockCompleter","name","className","triggerPrefix","useItems","filterValue","select","blockEditorStore","getSelectedBlockClientId","getBlockName","getBlockInsertionPoint","selectedBlockClientId","selectedBlockName","rootClientId","noop","items","categories","collections","filteredItems","initialFilteredItems","trim","filter","item","slice","options","map","blockItem","title","icon","isDisabled","key","id","value","label","allowContext","before","after","test","getOptionCompletion","inserterItem","initialAttributes","innerBlocks","action"],"mappings":"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","sourcesContent":["/**\n * External dependencies\n */\nimport { noop, orderBy } from 'lodash';\n\n/**\n * WordPress dependencies\n */\nimport { useSelect } from '@wordpress/data';\nimport {\n\tcreateBlock,\n\tcreateBlocksFromInnerBlocksTemplate,\n} from '@wordpress/blocks';\nimport { useMemo } from '@wordpress/element';\n\n/**\n * Internal dependencies\n */\nimport { searchBlockItems } from '../components/inserter/search-items';\nimport useBlockTypesState from '../components/inserter/hooks/use-block-types-state';\nimport BlockIcon from '../components/block-icon';\nimport { store as blockEditorStore } from '../store';\n\nconst SHOWN_BLOCK_TYPES = 9;\n\n/** @typedef {import('@wordpress/components').WPCompleter} WPCompleter */\n\n/**\n * Creates a blocks repeater for replacing the current block with a selected block type.\n *\n * @return {WPCompleter} A blocks completer.\n */\nfunction createBlockCompleter() {\n\treturn {\n\t\tname: 'blocks',\n\t\tclassName: 'block-editor-autocompleters__block',\n\t\ttriggerPrefix: '/',\n\n\t\tuseItems( filterValue ) {\n\t\t\tconst { rootClientId, selectedBlockName } = useSelect(\n\t\t\t\t( select ) => {\n\t\t\t\t\tconst {\n\t\t\t\t\t\tgetSelectedBlockClientId,\n\t\t\t\t\t\tgetBlockName,\n\t\t\t\t\t\tgetBlockInsertionPoint,\n\t\t\t\t\t} = select( blockEditorStore );\n\t\t\t\t\tconst selectedBlockClientId = getSelectedBlockClientId();\n\t\t\t\t\treturn {\n\t\t\t\t\t\tselectedBlockName: selectedBlockClientId\n\t\t\t\t\t\t\t? getBlockName( selectedBlockClientId )\n\t\t\t\t\t\t\t: null,\n\t\t\t\t\t\trootClientId: getBlockInsertionPoint().rootClientId,\n\t\t\t\t\t};\n\t\t\t\t},\n\t\t\t\t[]\n\t\t\t);\n\t\t\tconst [ items, categories, collections ] = useBlockTypesState(\n\t\t\t\trootClientId,\n\t\t\t\tnoop\n\t\t\t);\n\n\t\t\tconst filteredItems = useMemo( () => {\n\t\t\t\tconst initialFilteredItems = !! filterValue.trim()\n\t\t\t\t\t? searchBlockItems(\n\t\t\t\t\t\t\titems,\n\t\t\t\t\t\t\tcategories,\n\t\t\t\t\t\t\tcollections,\n\t\t\t\t\t\t\tfilterValue\n\t\t\t\t\t  )\n\t\t\t\t\t: orderBy( items, [ 'frecency' ], [ 'desc' ] );\n\n\t\t\t\treturn initialFilteredItems\n\t\t\t\t\t.filter( ( item ) => item.name !== selectedBlockName )\n\t\t\t\t\t.slice( 0, SHOWN_BLOCK_TYPES );\n\t\t\t}, [\n\t\t\t\tfilterValue,\n\t\t\t\tselectedBlockName,\n\t\t\t\titems,\n\t\t\t\tcategories,\n\t\t\t\tcollections,\n\t\t\t] );\n\n\t\t\tconst options = useMemo(\n\t\t\t\t() =>\n\t\t\t\t\tfilteredItems.map( ( blockItem ) => {\n\t\t\t\t\t\tconst { title, icon, isDisabled } = blockItem;\n\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\tkey: `block-${ blockItem.id }`,\n\t\t\t\t\t\t\tvalue: blockItem,\n\t\t\t\t\t\t\tlabel: (\n\t\t\t\t\t\t\t\t<>\n\t\t\t\t\t\t\t\t\t<BlockIcon\n\t\t\t\t\t\t\t\t\t\tkey=\"icon\"\n\t\t\t\t\t\t\t\t\t\ticon={ icon }\n\t\t\t\t\t\t\t\t\t\tshowColors\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t{ title }\n\t\t\t\t\t\t\t\t</>\n\t\t\t\t\t\t\t),\n\t\t\t\t\t\t\tisDisabled,\n\t\t\t\t\t\t};\n\t\t\t\t\t} ),\n\t\t\t\t[ filteredItems ]\n\t\t\t);\n\n\t\t\treturn [ options ];\n\t\t},\n\t\tallowContext( before, after ) {\n\t\t\treturn ! ( /\\S/.test( before ) || /\\S/.test( after ) );\n\t\t},\n\t\tgetOptionCompletion( inserterItem ) {\n\t\t\tconst { name, initialAttributes, innerBlocks } = inserterItem;\n\t\t\treturn {\n\t\t\t\taction: 'replace',\n\t\t\t\tvalue: createBlock(\n\t\t\t\t\tname,\n\t\t\t\t\tinitialAttributes,\n\t\t\t\t\tcreateBlocksFromInnerBlocksTemplate( innerBlocks )\n\t\t\t\t),\n\t\t\t};\n\t\t},\n\t};\n}\n\n/**\n * Creates a blocks repeater for replacing the current block with a selected block type.\n *\n * @return {WPCompleter} A blocks completer.\n */\nexport default createBlockCompleter();\n"]}