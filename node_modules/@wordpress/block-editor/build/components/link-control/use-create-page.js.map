{"version":3,"sources":["@wordpress/block-editor/src/components/link-control/use-create-page.js"],"names":["useCreatePage","handleCreatePage","cancelableCreateSuggestion","isCreatingPage","setIsCreatingPage","errorMessage","setErrorMessage","createPage","suggestionTitle","current","makeCancelable","Promise","resolve","promise","isCanceled","message","cancel","hasCanceled_","wrappedPromise","reject","then","val","error"],"mappings":";;;;;;;;;;;;;;;AAGA;;AACA;;AAJA;AACA;AACA;AAIe,SAASA,aAAT,CAAwBC,gBAAxB,EAA2C;AACzD,MAAMC,0BAA0B,GAAG,sBAAnC;;AADyD,kBAEX,uBAAU,KAAV,CAFW;AAAA;AAAA,MAEjDC,cAFiD;AAAA,MAEjCC,iBAFiC;;AAAA,mBAGf,uBAAU,IAAV,CAHe;AAAA;AAAA,MAGjDC,YAHiD;AAAA,MAGnCC,eAHmC;;AAKzD,MAAMC,UAAU;AAAA,uFAAG,iBAAiBC,eAAjB;AAAA;AAAA;AAAA;AAAA;AAClBJ,cAAAA,iBAAiB,CAAE,IAAF,CAAjB;AACAE,cAAAA,eAAe,CAAE,IAAF,CAAf;AAFkB;AAKjB;AACA;AACAJ,cAAAA,0BAA0B,CAACO,OAA3B,GAAqCC,cAAc,EAClD;AACA;AACAC,cAAAA,OAAO,CAACC,OAAR,CAAiBX,gBAAgB,CAAEO,eAAF,CAAjC,CAHkD,CAAnD;AAPiB;AAAA,qBAaJN,0BAA0B,CAACO,OAA3B,CAAmCI,OAb/B;;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA,oBAeZ,eAAS,YAAMC,UAfH;AAAA;AAAA;AAAA;;AAAA;;AAAA;AAmBjBR,cAAAA,eAAe,CACd,YAAMS,OAAN,IACC,cACC,8DADD,CAFa,CAAf;AAnBiB;;AAAA;AAAA;AA2BjBX,cAAAA,iBAAiB,CAAE,KAAF,CAAjB;AA3BiB;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAAH;;AAAA,oBAAVG,UAAU;AAAA;AAAA;AAAA,KAAhB;AA+BA;AACD;AACA;;;AACC,0BAAW,YAAM;AAChB,WAAO,YAAM;AACZ;AACA,UAAKL,0BAA0B,CAACO,OAAhC,EAA0C;AACzCP,QAAAA,0BAA0B,CAACO,OAA3B,CAAmCO,MAAnC;AACA;AACD,KALD;AAMA,GAPD,EAOG,EAPH;AASA,SAAO;AACNT,IAAAA,UAAU,EAAVA,UADM;AAENJ,IAAAA,cAAc,EAAdA,cAFM;AAGNE,IAAAA,YAAY,EAAZA;AAHM,GAAP;AAKA;AAED;AACA;AACA;AACA;AACA;AACA;AACA;;;AACA,IAAMK,cAAc,GAAG,SAAjBA,cAAiB,CAAEG,OAAF,EAAe;AACrC,MAAII,YAAY,GAAG,KAAnB;AAEA,MAAMC,cAAc,GAAG,IAAIP,OAAJ,CAAa,UAAEC,OAAF,EAAWO,MAAX,EAAuB;AAC1DN,IAAAA,OAAO,CAACO,IAAR,CACC,UAAEC,GAAF;AAAA,aACCJ,YAAY,GAAGE,MAAM,CAAE;AAAEL,QAAAA,UAAU,EAAE;AAAd,OAAF,CAAT,GAAoCF,OAAO,CAAES,GAAF,CADxD;AAAA,KADD,EAGC,UAAEC,KAAF;AAAA,aACCL,YAAY,GAAGE,MAAM,CAAE;AAAEL,QAAAA,UAAU,EAAE;AAAd,OAAF,CAAT,GAAoCK,MAAM,CAAEG,KAAF,CADvD;AAAA,KAHD;AAMA,GAPsB,CAAvB;AASA,SAAO;AACNT,IAAAA,OAAO,EAAEK,cADH;AAENF,IAAAA,MAFM,oBAEG;AACRC,MAAAA,YAAY,GAAG,IAAf;AACA;AAJK,GAAP;AAMA,CAlBD","sourcesContent":["/**\n * WordPress dependencies\n */\nimport { __ } from '@wordpress/i18n';\nimport { useEffect, useState, useRef } from '@wordpress/element';\n\nexport default function useCreatePage( handleCreatePage ) {\n\tconst cancelableCreateSuggestion = useRef();\n\tconst [ isCreatingPage, setIsCreatingPage ] = useState( false );\n\tconst [ errorMessage, setErrorMessage ] = useState( null );\n\n\tconst createPage = async function ( suggestionTitle ) {\n\t\tsetIsCreatingPage( true );\n\t\tsetErrorMessage( null );\n\n\t\ttry {\n\t\t\t// Make cancellable in order that we can avoid setting State\n\t\t\t// if the component unmounts during the call to `createSuggestion`\n\t\t\tcancelableCreateSuggestion.current = makeCancelable(\n\t\t\t\t// Using Promise.resolve to allow createSuggestion to return a\n\t\t\t\t// non-Promise based value.\n\t\t\t\tPromise.resolve( handleCreatePage( suggestionTitle ) )\n\t\t\t);\n\n\t\t\treturn await cancelableCreateSuggestion.current.promise;\n\t\t} catch ( error ) {\n\t\t\tif ( error && error.isCanceled ) {\n\t\t\t\treturn; // bail if canceled to avoid setting state\n\t\t\t}\n\n\t\t\tsetErrorMessage(\n\t\t\t\terror.message ||\n\t\t\t\t\t__(\n\t\t\t\t\t\t'An unknown error occurred during creation. Please try again.'\n\t\t\t\t\t)\n\t\t\t);\n\t\t\tthrow error;\n\t\t} finally {\n\t\t\tsetIsCreatingPage( false );\n\t\t}\n\t};\n\n\t/**\n\t * Handles cancelling any pending Promises that have been made cancelable.\n\t */\n\tuseEffect( () => {\n\t\treturn () => {\n\t\t\t// componentDidUnmount\n\t\t\tif ( cancelableCreateSuggestion.current ) {\n\t\t\t\tcancelableCreateSuggestion.current.cancel();\n\t\t\t}\n\t\t};\n\t}, [] );\n\n\treturn {\n\t\tcreatePage,\n\t\tisCreatingPage,\n\t\terrorMessage,\n\t};\n}\n\n/**\n * Creates a wrapper around a promise which allows it to be programmatically\n * cancelled.\n * See: https://reactjs.org/blog/2015/12/16/ismounted-antipattern.html\n *\n * @param {Promise} promise the Promise to make cancelable\n */\nconst makeCancelable = ( promise ) => {\n\tlet hasCanceled_ = false;\n\n\tconst wrappedPromise = new Promise( ( resolve, reject ) => {\n\t\tpromise.then(\n\t\t\t( val ) =>\n\t\t\t\thasCanceled_ ? reject( { isCanceled: true } ) : resolve( val ),\n\t\t\t( error ) =>\n\t\t\t\thasCanceled_ ? reject( { isCanceled: true } ) : reject( error )\n\t\t);\n\t} );\n\n\treturn {\n\t\tpromise: wrappedPromise,\n\t\tcancel() {\n\t\t\thasCanceled_ = true;\n\t\t},\n\t};\n};\n"]}