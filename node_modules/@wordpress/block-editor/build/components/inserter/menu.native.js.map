{"version":3,"sources":["@wordpress/block-editor/src/components/inserter/menu.native.js"],"names":["MIN_ITEMS_FOR_SEARCH","InserterMenu","onSelect","onDismiss","rootClientId","clientId","isAppender","shouldReplaceBlock","insertionIndex","filterValue","setFilterValue","searchFormHeight","setSearchFormHeight","__DEV__","showSearchForm","setShowSearchForm","blockEditorStore","showInsertionPoint","hideInsertionPoint","clearSelectedBlock","insertBlock","removeBlock","resetBlocks","insertDefaultBlock","select","getInserterItems","getBlockRootClientId","getBlockSelectionEnd","selectBlockEditorStore","targetRootClientId","end","undefined","items","destinationRootClientId","getBlockOrder","getBlockCount","canInsertBlockType","blocksStore","getBlockType","count","blockToReplace","getItems","length","onClose","onInsert","item","name","initialAttributes","innerBlocks","newBlock","itemsToDisplay","filter","clipboard","clipboardBlock","HTML","canAddClipboardBlock","icon","attributes","id","listProps","safeAreaBottomInset","value","event","height","nativeEvent","layout"],"mappings":"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","sourcesContent":["/**\n * External dependencies\n */\nimport { View } from 'react-native';\n/**\n * WordPress dependencies\n */\nimport { useEffect, useState, useCallback } from '@wordpress/element';\nimport { useSelect, useDispatch } from '@wordpress/data';\nimport {\n\tcreateBlock,\n\trawHandler,\n\tstore as blocksStore,\n} from '@wordpress/blocks';\nimport {\n\tBottomSheet,\n\tBottomSheetConsumer,\n\tgetClipboard,\n} from '@wordpress/components';\n\n/**\n * Internal dependencies\n */\n\nimport InserterSearchResults from './search-results';\nimport InserterSearchForm from './search-form';\nimport { store as blockEditorStore } from '../../store';\nimport { searchItems } from './search-items';\n\nconst MIN_ITEMS_FOR_SEARCH = 2;\n\nfunction InserterMenu( {\n\tonSelect,\n\tonDismiss,\n\trootClientId,\n\tclientId,\n\tisAppender,\n\tshouldReplaceBlock,\n\tinsertionIndex,\n} ) {\n\tconst [ filterValue, setFilterValue ] = useState( '' );\n\tconst [ searchFormHeight, setSearchFormHeight ] = useState( 0 );\n\t// eslint-disable-next-line no-undef\n\tconst [ showSearchForm, setShowSearchForm ] = useState( __DEV__ );\n\n\tconst {\n\t\tshowInsertionPoint,\n\t\thideInsertionPoint,\n\t\tclearSelectedBlock,\n\t\tinsertBlock,\n\t\tremoveBlock,\n\t\tresetBlocks,\n\t\tinsertDefaultBlock,\n\t} = useDispatch( blockEditorStore );\n\n\tconst {\n\t\titems,\n\t\tdestinationRootClientId,\n\t\tgetBlockOrder,\n\t\tgetBlockCount,\n\t\tcanInsertBlockType,\n\t} = useSelect( ( select ) => {\n\t\tconst {\n\t\t\tgetInserterItems,\n\t\t\tgetBlockRootClientId,\n\t\t\tgetBlockSelectionEnd,\n\t\t\t...selectBlockEditorStore\n\t\t} = select( blockEditorStore );\n\n\t\tlet targetRootClientId = rootClientId;\n\t\tif ( ! targetRootClientId && ! clientId && ! isAppender ) {\n\t\t\tconst end = getBlockSelectionEnd();\n\t\t\tif ( end ) {\n\t\t\t\ttargetRootClientId = getBlockRootClientId( end ) || undefined;\n\t\t\t}\n\t\t}\n\n\t\treturn {\n\t\t\titems: getInserterItems( targetRootClientId ),\n\t\t\tdestinationRootClientId: targetRootClientId,\n\t\t\tgetBlockOrder: selectBlockEditorStore.getBlockOrder,\n\t\t\tgetBlockCount: selectBlockEditorStore.getBlockCount,\n\t\t\tcanInsertBlockType: selectBlockEditorStore.canInsertBlockType,\n\t\t};\n\t} );\n\n\tconst { getBlockType } = useSelect( ( select ) => select( blocksStore ) );\n\n\tuseEffect( () => {\n\t\t// Show/Hide insertion point on Mount/Dismount\n\t\tif ( shouldReplaceBlock ) {\n\t\t\tconst count = getBlockCount();\n\t\t\t// Check if there is a rootClientId because that means it is a nested replaceable block\n\t\t\t// and we don't want to clear/reset all blocks.\n\t\t\tif ( count === 1 && ! rootClientId ) {\n\t\t\t\t// Removing the last block is not possilble with `removeBlock` action.\n\t\t\t\t// It always inserts a default block if the last of the blocks have been removed.\n\t\t\t\tclearSelectedBlock();\n\t\t\t\tresetBlocks( [] );\n\t\t\t} else {\n\t\t\t\tconst blockToReplace = getBlockOrder( destinationRootClientId )[\n\t\t\t\t\tinsertionIndex\n\t\t\t\t];\n\t\t\t\tremoveBlock( blockToReplace, false );\n\t\t\t}\n\t\t}\n\t\tshowInsertionPoint( destinationRootClientId, insertionIndex );\n\n\t\t// Show search form if there are enough items to filter.\n\t\tif ( getItems()?.length < MIN_ITEMS_FOR_SEARCH ) {\n\t\t\tsetShowSearchForm( false );\n\t\t}\n\n\t\treturn hideInsertionPoint;\n\t}, [] );\n\n\tconst onClose = useCallback( () => {\n\t\t// if should replace but didn't insert any block\n\t\t// re-insert default block\n\t\tif ( shouldReplaceBlock ) {\n\t\t\tinsertDefaultBlock( {}, destinationRootClientId, insertionIndex );\n\t\t}\n\t\tonDismiss();\n\t}, [ shouldReplaceBlock, destinationRootClientId, insertionIndex ] );\n\n\tconst onInsert = useCallback(\n\t\t( item ) => {\n\t\t\tconst { name, initialAttributes, innerBlocks } = item;\n\n\t\t\tconst newBlock = createBlock(\n\t\t\t\tname,\n\t\t\t\tinitialAttributes,\n\t\t\t\tinnerBlocks\n\t\t\t);\n\n\t\t\tinsertBlock( newBlock, insertionIndex, destinationRootClientId );\n\t\t},\n\t\t[ insertBlock, destinationRootClientId, insertionIndex ]\n\t);\n\n\t/**\n\t * Processes the inserter items to check\n\t * if there's any copied block in the clipboard\n\t * to add it as an extra item\n\t */\n\tfunction getItems() {\n\t\t// Filter out reusable blocks (they will be added in another tab)\n\t\tlet itemsToDisplay = items.filter(\n\t\t\t( { name } ) => name !== 'core/block'\n\t\t);\n\n\t\titemsToDisplay = searchItems( itemsToDisplay, filterValue );\n\n\t\tconst clipboard = getClipboard();\n\t\tlet clipboardBlock = rawHandler( { HTML: clipboard } )[ 0 ];\n\n\t\tconst canAddClipboardBlock = canInsertBlockType(\n\t\t\tclipboardBlock?.name,\n\t\t\tdestinationRootClientId\n\t\t);\n\n\t\tif ( ! canAddClipboardBlock ) {\n\t\t\treturn itemsToDisplay;\n\t\t}\n\n\t\tconst { icon, name } = getBlockType( clipboardBlock.name );\n\t\tconst { attributes: initialAttributes, innerBlocks } = clipboardBlock;\n\n\t\tclipboardBlock = {\n\t\t\tid: 'clipboard',\n\t\t\tname,\n\t\t\ticon,\n\t\t\tinitialAttributes,\n\t\t\tinnerBlocks,\n\t\t};\n\n\t\treturn [ clipboardBlock, ...itemsToDisplay ];\n\t}\n\n\treturn (\n\t\t<BottomSheet\n\t\t\tisVisible={ true }\n\t\t\tonClose={ onClose }\n\t\t\thideHeader\n\t\t\thasNavigation\n\t\t\tsetMinHeightToMaxHeight={ showSearchForm }\n\t\t>\n\t\t\t<BottomSheetConsumer>\n\t\t\t\t{ ( { listProps, safeAreaBottomInset } ) => (\n\t\t\t\t\t<View>\n\t\t\t\t\t\t{ showSearchForm && (\n\t\t\t\t\t\t\t<InserterSearchForm\n\t\t\t\t\t\t\t\tonChange={ ( value ) => {\n\t\t\t\t\t\t\t\t\tsetFilterValue( value );\n\t\t\t\t\t\t\t\t} }\n\t\t\t\t\t\t\t\tvalue={ filterValue }\n\t\t\t\t\t\t\t\tonLayout={ ( event ) => {\n\t\t\t\t\t\t\t\t\tconst { height } = event.nativeEvent.layout;\n\t\t\t\t\t\t\t\t\tsetSearchFormHeight( height );\n\t\t\t\t\t\t\t\t} }\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t) }\n\n\t\t\t\t\t\t<InserterSearchResults\n\t\t\t\t\t\t\titems={ getItems() }\n\t\t\t\t\t\t\tonSelect={ ( item ) => {\n\t\t\t\t\t\t\t\tonInsert( item );\n\t\t\t\t\t\t\t\tonSelect( item );\n\t\t\t\t\t\t\t} }\n\t\t\t\t\t\t\t{ ...{\n\t\t\t\t\t\t\t\tlistProps,\n\t\t\t\t\t\t\t\tsafeAreaBottomInset,\n\t\t\t\t\t\t\t\tsearchFormHeight,\n\t\t\t\t\t\t\t} }\n\t\t\t\t\t\t/>\n\t\t\t\t\t</View>\n\t\t\t\t) }\n\t\t\t</BottomSheetConsumer>\n\t\t</BottomSheet>\n\t);\n}\n\nexport default InserterMenu;\n"]}