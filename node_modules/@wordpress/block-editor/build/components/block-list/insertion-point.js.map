{"version":3,"sources":["@wordpress/block-editor/src/components/block-list/insertion-point.js"],"names":["InsertionPointInserter","clientId","rootClientId","setIsInserterForced","InsertionPointPopover","selectedRootClientId","isInserterShown","isInserterForced","containerRef","showInsertionPoint","blockEditorStore","selectBlock","ref","select","getBlockOrder","getBlockRootClientId","getBlockListSettings","getMultiSelectedBlockClientIds","getSelectedBlockClientId","hasMultiSelection","getSettings","ownerDocument","current","targetRootClientId","blockOrder","length","previous","isLast","next","indexOf","hasReducedUI","multiSelectedBlockClientIds","selectedBlockClientId","blockOrientation","orientation","previousElement","nextElement","nextClientId","isHidden","includes","style","previousRect","getBoundingClientRect","nextRect","width","offsetWidth","height","top","bottom","left","right","offsetHeight","getAnchorRect","className","onClick","event","target","onFocus","showInsertionPointInserter","showInsertionPointIndicator","useInsertionPoint","setIsInserterShown","inserterClientId","setInserterClientId","_isMultiSelecting","isMultiSelecting","isBlockInsertionPointVisible","getBlockInsertionPoint","_getBlockListSettings","insertionPoint","order","isInserterVisible","selectedClientId","index","onMouseMove","classList","contains","blockElement","getAttribute","closest","rect","offsetTop","clientY","offsetLeft","clientX","children","Array","from","find","blockEl","element","id","firstElementChild","slice","elementRect","enableMouseMove","addEventListener","removeEventListener","isVisible","value"],"mappings":"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","sourcesContent":["/**\n * External dependencies\n */\nimport classnames from 'classnames';\n\n/**\n * WordPress dependencies\n */\nimport { useSelect, useDispatch } from '@wordpress/data';\nimport {\n\tuseState,\n\tuseEffect,\n\tuseCallback,\n\tuseRef,\n\tuseMemo,\n} from '@wordpress/element';\nimport { Popover } from '@wordpress/components';\nimport { isRTL } from '@wordpress/i18n';\n\n/**\n * Internal dependencies\n */\nimport Inserter from '../inserter';\nimport { getBlockDOMNode } from '../../utils/dom';\nimport { store as blockEditorStore } from '../../store';\n\nfunction InsertionPointInserter( {\n\tclientId,\n\trootClientId,\n\tsetIsInserterForced,\n} ) {\n\treturn (\n\t\t<div\n\t\t\tclassName={ classnames(\n\t\t\t\t'block-editor-block-list__insertion-point-inserter'\n\t\t\t) }\n\t\t>\n\t\t\t<Inserter\n\t\t\t\tposition=\"bottom center\"\n\t\t\t\tclientId={ clientId }\n\t\t\t\trootClientId={ rootClientId }\n\t\t\t\t__experimentalIsQuick\n\t\t\t\tonToggle={ setIsInserterForced }\n\t\t\t\tonSelectOrClose={ () => setIsInserterForced( false ) }\n\t\t\t/>\n\t\t</div>\n\t);\n}\n\nfunction InsertionPointPopover( {\n\tclientId,\n\tselectedRootClientId,\n\tisInserterShown,\n\tisInserterForced,\n\tsetIsInserterForced,\n\tcontainerRef,\n\tshowInsertionPoint,\n} ) {\n\tconst { selectBlock } = useDispatch( blockEditorStore );\n\tconst ref = useRef();\n\n\tconst {\n\t\tpreviousElement,\n\t\tnextElement,\n\t\torientation,\n\t\tisHidden,\n\t\tnextClientId,\n\t\trootClientId,\n\t} = useSelect(\n\t\t( select ) => {\n\t\t\tconst {\n\t\t\t\tgetBlockOrder,\n\t\t\t\tgetBlockRootClientId,\n\t\t\t\tgetBlockListSettings,\n\t\t\t\tgetMultiSelectedBlockClientIds,\n\t\t\t\tgetSelectedBlockClientId,\n\t\t\t\thasMultiSelection,\n\t\t\t\tgetSettings,\n\t\t\t} = select( blockEditorStore );\n\t\t\tconst { ownerDocument } = containerRef.current;\n\t\t\tconst targetRootClientId = clientId\n\t\t\t\t? getBlockRootClientId( clientId )\n\t\t\t\t: selectedRootClientId;\n\t\t\tconst blockOrder = getBlockOrder( targetRootClientId );\n\t\t\tif ( ! blockOrder.length ) {\n\t\t\t\treturn {};\n\t\t\t}\n\t\t\tconst previous = clientId\n\t\t\t\t? clientId\n\t\t\t\t: blockOrder[ blockOrder.length - 1 ];\n\t\t\tconst isLast = previous === blockOrder[ blockOrder.length - 1 ];\n\t\t\tconst next = isLast\n\t\t\t\t? null\n\t\t\t\t: blockOrder[ blockOrder.indexOf( previous ) + 1 ];\n\t\t\tconst { hasReducedUI } = getSettings();\n\t\t\tconst multiSelectedBlockClientIds = getMultiSelectedBlockClientIds();\n\t\t\tconst selectedBlockClientId = getSelectedBlockClientId();\n\t\t\tconst blockOrientation =\n\t\t\t\tgetBlockListSettings( targetRootClientId )?.orientation ||\n\t\t\t\t'vertical';\n\n\t\t\treturn {\n\t\t\t\tpreviousElement: getBlockDOMNode( previous, ownerDocument ),\n\t\t\t\tnextElement: getBlockDOMNode( next, ownerDocument ),\n\t\t\t\tnextClientId: next,\n\t\t\t\tisHidden:\n\t\t\t\t\thasReducedUI ||\n\t\t\t\t\t( hasMultiSelection()\n\t\t\t\t\t\t? next && multiSelectedBlockClientIds.includes( next )\n\t\t\t\t\t\t: next &&\n\t\t\t\t\t\t  blockOrientation === 'vertical' &&\n\t\t\t\t\t\t  next === selectedBlockClientId ),\n\t\t\t\torientation: blockOrientation,\n\t\t\t\trootClientId: targetRootClientId,\n\t\t\t};\n\t\t},\n\t\t[ clientId, selectedRootClientId ]\n\t);\n\n\tconst style = useMemo( () => {\n\t\tif ( ! previousElement ) {\n\t\t\treturn {};\n\t\t}\n\t\tconst previousRect = previousElement.getBoundingClientRect();\n\t\tconst nextRect = nextElement\n\t\t\t? nextElement.getBoundingClientRect()\n\t\t\t: null;\n\n\t\tif ( orientation === 'vertical' ) {\n\t\t\treturn {\n\t\t\t\twidth: previousElement.offsetWidth,\n\t\t\t\theight: nextRect ? nextRect.top - previousRect.bottom : 0,\n\t\t\t};\n\t\t}\n\n\t\tlet width = 0;\n\t\tif ( nextElement ) {\n\t\t\twidth = isRTL()\n\t\t\t\t? previousRect.left - nextRect.right\n\t\t\t\t: nextRect.left - previousRect.right;\n\t\t}\n\n\t\treturn {\n\t\t\twidth,\n\t\t\theight: previousElement.offsetHeight,\n\t\t};\n\t}, [ previousElement, nextElement ] );\n\n\tconst getAnchorRect = useCallback( () => {\n\t\tconst previousRect = previousElement.getBoundingClientRect();\n\t\tconst nextRect = nextElement\n\t\t\t? nextElement.getBoundingClientRect()\n\t\t\t: null;\n\t\tif ( orientation === 'vertical' ) {\n\t\t\treturn {\n\t\t\t\ttop: previousRect.bottom,\n\t\t\t\tleft: previousRect.left,\n\t\t\t\tright: previousRect.right,\n\t\t\t\tbottom: nextRect ? nextRect.top : previousRect.bottom,\n\t\t\t};\n\t\t}\n\n\t\tif ( isRTL() ) {\n\t\t\treturn {\n\t\t\t\ttop: previousRect.top,\n\t\t\t\tleft: nextRect ? nextRect.right : previousRect.left,\n\t\t\t\tright: previousRect.left,\n\t\t\t\tbottom: previousRect.bottom,\n\t\t\t};\n\t\t}\n\n\t\treturn {\n\t\t\ttop: previousRect.top,\n\t\t\tleft: previousRect.right,\n\t\t\tright: nextRect ? nextRect.left : previousRect.right,\n\t\t\tbottom: previousRect.bottom,\n\t\t};\n\t}, [ previousElement, nextElement ] );\n\n\tif ( ! previousElement ) {\n\t\treturn null;\n\t}\n\n\tconst className = classnames(\n\t\t'block-editor-block-list__insertion-point',\n\t\t'is-' + orientation\n\t);\n\n\tfunction onClick( event ) {\n\t\tif ( event.target === ref.current && nextClientId ) {\n\t\t\tselectBlock( nextClientId, -1 );\n\t\t}\n\t}\n\n\tfunction onFocus( event ) {\n\t\t// Only handle click on the wrapper specifically, and not an event\n\t\t// bubbled from the inserter itself.\n\t\tif ( event.target !== ref.current ) {\n\t\t\tsetIsInserterForced( true );\n\t\t}\n\t}\n\n\t// Only show the inserter when there's a `nextElement` (a block after the\n\t// insertion point). At the end of the block list the trailing appender\n\t// should serve the purpose of inserting blocks.\n\tconst showInsertionPointInserter =\n\t\t! isHidden && nextElement && ( isInserterShown || isInserterForced );\n\n\t// Show the indicator if the insertion point inserter is visible, or if\n\t// the `showInsertionPoint` state is `true`. The latter is generally true\n\t// when hovering blocks for insertion in the block library.\n\tconst showInsertionPointIndicator =\n\t\tshowInsertionPointInserter || ( ! isHidden && showInsertionPoint );\n\n\t/* eslint-disable jsx-a11y/no-static-element-interactions, jsx-a11y/click-events-have-key-events */\n\t// While ideally it would be enough to capture the\n\t// bubbling focus event from the Inserter, due to the\n\t// characteristics of click focusing of `button`s in\n\t// Firefox and Safari, it is not reliable.\n\t//\n\t// See: https://developer.mozilla.org/en-US/docs/Web/HTML/Element/button#Clicking_and_focus\n\treturn (\n\t\t<Popover\n\t\t\tnoArrow\n\t\t\tanimate={ false }\n\t\t\tgetAnchorRect={ getAnchorRect }\n\t\t\tfocusOnMount={ false }\n\t\t\tclassName=\"block-editor-block-list__insertion-point-popover\"\n\t\t\t__unstableSlotName=\"block-toolbar\"\n\t\t>\n\t\t\t<div\n\t\t\t\tref={ ref }\n\t\t\t\ttabIndex={ -1 }\n\t\t\t\tonClick={ onClick }\n\t\t\t\tonFocus={ onFocus }\n\t\t\t\tclassName={ className }\n\t\t\t\tstyle={ style }\n\t\t\t>\n\t\t\t\t{ showInsertionPointIndicator && (\n\t\t\t\t\t<div className=\"block-editor-block-list__insertion-point-indicator\" />\n\t\t\t\t) }\n\t\t\t\t{ showInsertionPointInserter && (\n\t\t\t\t\t<InsertionPointInserter\n\t\t\t\t\t\trootClientId={ rootClientId }\n\t\t\t\t\t\tclientId={ nextClientId }\n\t\t\t\t\t\tsetIsInserterForced={ setIsInserterForced }\n\t\t\t\t\t/>\n\t\t\t\t) }\n\t\t\t</div>\n\t\t</Popover>\n\t);\n\t/* eslint-enable jsx-a11y/no-static-element-interactions, jsx-a11y/click-events-have-key-events */\n}\n\nexport default function useInsertionPoint( ref ) {\n\tconst [ isInserterShown, setIsInserterShown ] = useState( false );\n\tconst [ isInserterForced, setIsInserterForced ] = useState( false );\n\tconst [ inserterClientId, setInserterClientId ] = useState( null );\n\tconst {\n\t\tisMultiSelecting,\n\t\tisInserterVisible,\n\t\tselectedClientId,\n\t\tselectedRootClientId,\n\t\tgetBlockListSettings,\n\t} = useSelect( ( select ) => {\n\t\tconst {\n\t\t\tisMultiSelecting: _isMultiSelecting,\n\t\t\tisBlockInsertionPointVisible,\n\t\t\tgetBlockInsertionPoint,\n\t\t\tgetBlockOrder,\n\t\t\tgetBlockListSettings: _getBlockListSettings,\n\t\t} = select( blockEditorStore );\n\n\t\tconst insertionPoint = getBlockInsertionPoint();\n\t\tconst order = getBlockOrder( insertionPoint.rootClientId );\n\n\t\treturn {\n\t\t\tgetBlockListSettings: _getBlockListSettings,\n\t\t\tisMultiSelecting: _isMultiSelecting(),\n\t\t\tisInserterVisible: isBlockInsertionPointVisible(),\n\t\t\tselectedClientId: order[ insertionPoint.index - 1 ],\n\t\t\tselectedRootClientId: insertionPoint.rootClientId,\n\t\t};\n\t}, [] );\n\n\tconst onMouseMove = useCallback(\n\t\t( event ) => {\n\t\t\tif (\n\t\t\t\t! event.target.classList.contains(\n\t\t\t\t\t'block-editor-block-list__layout'\n\t\t\t\t)\n\t\t\t) {\n\t\t\t\tif ( isInserterShown ) {\n\t\t\t\t\tsetIsInserterShown( false );\n\t\t\t\t}\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tlet rootClientId;\n\t\t\tif ( ! event.target.classList.contains( 'is-root-container' ) ) {\n\t\t\t\tconst blockElement = !! event.target.getAttribute(\n\t\t\t\t\t'data-block'\n\t\t\t\t)\n\t\t\t\t\t? event.target\n\t\t\t\t\t: event.target.closest( '[data-block]' );\n\t\t\t\trootClientId = blockElement.getAttribute( 'data-block' );\n\t\t\t}\n\n\t\t\tconst orientation =\n\t\t\t\tgetBlockListSettings( rootClientId )?.orientation || 'vertical';\n\t\t\tconst rect = event.target.getBoundingClientRect();\n\t\t\tconst offsetTop = event.clientY - rect.top;\n\t\t\tconst offsetLeft = event.clientX - rect.left;\n\n\t\t\tconst children = Array.from( event.target.children );\n\t\t\tconst nextElement = children.find( ( blockEl ) => {\n\t\t\t\treturn (\n\t\t\t\t\t( blockEl.classList.contains( 'wp-block' ) &&\n\t\t\t\t\t\torientation === 'vertical' &&\n\t\t\t\t\t\tblockEl.offsetTop > offsetTop ) ||\n\t\t\t\t\t( blockEl.classList.contains( 'wp-block' ) &&\n\t\t\t\t\t\torientation === 'horizontal' &&\n\t\t\t\t\t\tblockEl.offsetLeft > offsetLeft )\n\t\t\t\t);\n\t\t\t} );\n\n\t\t\tlet element = nextElement\n\t\t\t\t? children[ children.indexOf( nextElement ) - 1 ]\n\t\t\t\t: children[ children.length - 1 ];\n\n\t\t\tif ( ! element ) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// The block may be in an alignment wrapper, so check the first direct\n\t\t\t// child if the element has no ID.\n\t\t\tif ( ! element.id ) {\n\t\t\t\telement = element.firstElementChild;\n\n\t\t\t\tif ( ! element ) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tconst clientId = element.id.slice( 'block-'.length );\n\n\t\t\tif ( ! clientId ) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst elementRect = element.getBoundingClientRect();\n\n\t\t\tif (\n\t\t\t\t( orientation === 'horizontal' &&\n\t\t\t\t\t( event.clientY > elementRect.bottom ||\n\t\t\t\t\t\tevent.clientY < elementRect.top ) ) ||\n\t\t\t\t( orientation === 'vertical' &&\n\t\t\t\t\t( event.clientX > elementRect.right ||\n\t\t\t\t\t\tevent.clientX < elementRect.left ) )\n\t\t\t) {\n\t\t\t\tif ( isInserterShown ) {\n\t\t\t\t\tsetIsInserterShown( false );\n\t\t\t\t}\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tsetIsInserterShown( true );\n\t\t\tsetInserterClientId( clientId );\n\t\t},\n\t\t[ isInserterShown, setIsInserterShown, setInserterClientId ]\n\t);\n\n\tconst enableMouseMove = ! isInserterForced && ! isMultiSelecting;\n\n\tuseEffect( () => {\n\t\tif ( ! enableMouseMove ) {\n\t\t\treturn;\n\t\t}\n\n\t\tref.current.addEventListener( 'mousemove', onMouseMove );\n\n\t\treturn () => {\n\t\t\tref.current.removeEventListener( 'mousemove', onMouseMove );\n\t\t};\n\t}, [ enableMouseMove, onMouseMove ] );\n\n\tconst isVisible = isInserterShown || isInserterForced || isInserterVisible;\n\n\treturn (\n\t\t! isMultiSelecting &&\n\t\tisVisible && (\n\t\t\t<InsertionPointPopover\n\t\t\t\tclientId={\n\t\t\t\t\tisInserterVisible ? selectedClientId : inserterClientId\n\t\t\t\t}\n\t\t\t\tselectedRootClientId={ selectedRootClientId }\n\t\t\t\tisInserterShown={ isInserterShown }\n\t\t\t\tisInserterForced={ isInserterForced }\n\t\t\t\tsetIsInserterForced={ ( value ) => {\n\t\t\t\t\tsetIsInserterForced( value );\n\t\t\t\t\tif ( ! value ) {\n\t\t\t\t\t\tsetIsInserterShown( value );\n\t\t\t\t\t}\n\t\t\t\t} }\n\t\t\t\tcontainerRef={ ref }\n\t\t\t\tshowInsertionPoint={ isInserterVisible }\n\t\t\t/>\n\t\t)\n\t);\n}\n"]}