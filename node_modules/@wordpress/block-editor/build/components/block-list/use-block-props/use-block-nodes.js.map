{"version":3,"sources":["@wordpress/block-editor/src/components/block-list/use-block-props/use-block-nodes.js"],"names":["useBlockNodes","clientId","setBlockNodes","SetBlockNodes","isNodeNeeded","select","blockEditorStore","isBlockSelected","isFirstMultiSelectedBlock","getLastMultiSelectedBlockClientId","node","nodes"],"mappings":";;;;;;;;;;;AAGA;;AAKA;;AACA;;AACA;;AAKA;;AACA;;;;;;AAEO,SAASA,aAAT,CAAwBC,QAAxB,EAAmC;AACzC,MAAMC,aAAa,GAAG,yBAAYC,eAAZ,CAAtB,CADyC,CAEzC;AACA;AACA;AACA;;AACA,MAAMC,YAAY,GAAG,qBACpB,UAAEC,MAAF,EAAc;AAAA,kBAKTA,MAAM,CAAEC,YAAF,CALG;AAAA,QAEZC,eAFY,WAEZA,eAFY;AAAA,QAGZC,yBAHY,WAGZA,yBAHY;AAAA,QAIZC,iCAJY,WAIZA,iCAJY;;AAMb,WACCF,eAAe,CAAEN,QAAF,CAAf,IACAO,yBAAyB,CAAEP,QAAF,CADzB,IAEAQ,iCAAiC,OAAOR,QAHzC;AAKA,GAZmB,CAapB;AACA;AACA;AACA;AAhBoB,GAArB;AAmBA,SAAO,2BACN,UAAES,IAAF,EAAY;AACX,QAAK,CAAEN,YAAP,EAAsB;AACrB;AACA;;AAEDF,IAAAA,aAAa,CAAE,UAAES,KAAF;AAAA,6CACXA,KADW,yCAEZV,QAFY,EAEAS,IAFA;AAAA,KAAF,CAAb;AAKA,WAAO,YAAM;AACZR,MAAAA,aAAa,CAAE,UAAES,KAAF;AAAA,eAAa,kBAAMA,KAAN,EAAaV,QAAb,CAAb;AAAA,OAAF,CAAb;AACA,KAFD;AAGA,GAdK,EAeN,CAAEG,YAAF,EAAgBH,QAAhB,EAA0BC,aAA1B,CAfM,CAAP;AAiBA","sourcesContent":["/**\n * External dependencies\n */\nimport { omit } from 'lodash';\n\n/**\n * WordPress dependencies\n */\nimport { useContext } from '@wordpress/element';\nimport { useRefEffect } from '@wordpress/compose';\nimport { useSelect } from '@wordpress/data';\n\n/**\n * Internal dependencies\n */\nimport { SetBlockNodes } from '../';\nimport { store as blockEditorStore } from '../../../store';\n\nexport function useBlockNodes( clientId ) {\n\tconst setBlockNodes = useContext( SetBlockNodes );\n\t// Provide the selected node, or the first and last nodes of a multi-\n\t// selection, so it can be used to position the contextual block toolbar.\n\t// We only provide what is necessary, and remove the nodes again when they\n\t// are no longer selected.\n\tconst isNodeNeeded = useSelect(\n\t\t( select ) => {\n\t\t\tconst {\n\t\t\t\tisBlockSelected,\n\t\t\t\tisFirstMultiSelectedBlock,\n\t\t\t\tgetLastMultiSelectedBlockClientId,\n\t\t\t} = select( blockEditorStore );\n\t\t\treturn (\n\t\t\t\tisBlockSelected( clientId ) ||\n\t\t\t\tisFirstMultiSelectedBlock( clientId ) ||\n\t\t\t\tgetLastMultiSelectedBlockClientId() === clientId\n\t\t\t);\n\t\t}\n\t\t// To do: figure out why tests are failing when dependencies are added.\n\t\t// This data was originally retrieved with `withSelect` in `block.js`.\n\t\t// For some reason, adding `clientId` as a dependency results in\n\t\t// `toolbar-roving-tabindex.test.js` e2e test failures.\n\t);\n\n\treturn useRefEffect(\n\t\t( node ) => {\n\t\t\tif ( ! isNodeNeeded ) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tsetBlockNodes( ( nodes ) => ( {\n\t\t\t\t...nodes,\n\t\t\t\t[ clientId ]: node,\n\t\t\t} ) );\n\n\t\t\treturn () => {\n\t\t\t\tsetBlockNodes( ( nodes ) => omit( nodes, clientId ) );\n\t\t\t};\n\t\t},\n\t\t[ isNodeNeeded, clientId, setBlockNodes ]\n\t);\n}\n"]}