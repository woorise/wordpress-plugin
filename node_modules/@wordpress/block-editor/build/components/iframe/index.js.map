{"version":3,"sources":["@wordpress/block-editor/src/components/iframe/index.js"],"names":["BODY_CLASS_NAME","BLOCK_PREFIX","styleSheetsCompat","doc","Array","from","document","styleSheets","forEach","styleSheet","cssRules","e","ownerNode","isMatch","find","selectorText","includes","getElementById","id","head","appendChild","cloneNode","bubbleEvents","defaultView","frameElement","bubbleEvent","event","prototype","Object","getPrototypeOf","constructorName","constructor","name","Constructor","window","init","key","MouseEvent","rect","getBoundingClientRect","clientX","left","clientY","top","newEvent","type","cancelled","dispatchEvent","preventDefault","eventTypes","addEventListener","setBodyClassName","dir","body","className","classList","startsWith","add","setHead","innerHTML","Iframe","ref","contentRef","children","headHTML","props","iframeDocument","setIframeDocument","setRef","node","setDocumentIfReady","contentDocument","readyState","current"],"mappings":"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","sourcesContent":["/**\n * WordPress dependencies\n */\nimport {\n\tuseState,\n\tcreatePortal,\n\tuseCallback,\n\tforwardRef,\n} from '@wordpress/element';\nimport { __ } from '@wordpress/i18n';\nimport { useMergeRefs } from '@wordpress/compose';\n\nconst BODY_CLASS_NAME = 'editor-styles-wrapper';\nconst BLOCK_PREFIX = 'wp-block';\n\n/**\n * Clones stylesheets targetting the editor canvas to the given document. A\n * stylesheet is considered targetting the editor a canvas if it contains the\n * `editor-styles-wrapper`, `wp-block`, or `wp-block-*` class selectors.\n *\n * Ideally, this hook should be removed in the future and styles should be added\n * explicitly as editor styles.\n *\n * @param {Document} doc The document to append cloned stylesheets to.\n */\nfunction styleSheetsCompat( doc ) {\n\t// Search the document for stylesheets targetting the editor canvas.\n\tArray.from( document.styleSheets ).forEach( ( styleSheet ) => {\n\t\ttry {\n\t\t\t// May fail for external styles.\n\t\t\t// eslint-disable-next-line no-unused-expressions\n\t\t\tstyleSheet.cssRules;\n\t\t} catch ( e ) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst { ownerNode, cssRules } = styleSheet;\n\n\t\tif ( ! cssRules ) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst isMatch = Array.from( cssRules ).find(\n\t\t\t( { selectorText } ) =>\n\t\t\t\tselectorText &&\n\t\t\t\t( selectorText.includes( `.${ BODY_CLASS_NAME }` ) ||\n\t\t\t\t\tselectorText.includes( `.${ BLOCK_PREFIX }` ) )\n\t\t);\n\n\t\tif ( isMatch && ! doc.getElementById( ownerNode.id ) ) {\n\t\t\tdoc.head.appendChild( ownerNode.cloneNode( true ) );\n\t\t}\n\t} );\n}\n\n/**\n * Bubbles some event types (keydown, keypress, and dragover) to parent document\n * document to ensure that the keyboard shortcuts and drag and drop work.\n *\n * Ideally, we should remove event bubbling in the future. Keyboard shortcuts\n * should be context dependent, e.g. actions on blocks like Cmd+A should not\n * work globally outside the block editor.\n *\n * @param {Document} doc Document to attach listeners to.\n */\nfunction bubbleEvents( doc ) {\n\tconst { defaultView } = doc;\n\tconst { frameElement } = defaultView;\n\n\tfunction bubbleEvent( event ) {\n\t\tconst prototype = Object.getPrototypeOf( event );\n\t\tconst constructorName = prototype.constructor.name;\n\t\tconst Constructor = window[ constructorName ];\n\n\t\tconst init = {};\n\n\t\tfor ( const key in event ) {\n\t\t\tinit[ key ] = event[ key ];\n\t\t}\n\n\t\tif ( event instanceof defaultView.MouseEvent ) {\n\t\t\tconst rect = frameElement.getBoundingClientRect();\n\t\t\tinit.clientX += rect.left;\n\t\t\tinit.clientY += rect.top;\n\t\t}\n\n\t\tconst newEvent = new Constructor( event.type, init );\n\t\tconst cancelled = ! frameElement.dispatchEvent( newEvent );\n\n\t\tif ( cancelled ) {\n\t\t\tevent.preventDefault();\n\t\t}\n\t}\n\n\tconst eventTypes = [ 'keydown', 'keypress', 'dragover' ];\n\n\tfor ( const name of eventTypes ) {\n\t\tdoc.addEventListener( name, bubbleEvent );\n\t}\n}\n\n/**\n * Sets the document direction.\n *\n * Sets the `editor-styles-wrapper` class name on the body.\n *\n * Copies the `admin-color-*` class name to the body so that the admin color\n * scheme applies to components in the iframe.\n *\n * @param {Document} doc Document to add class name to.\n */\nfunction setBodyClassName( doc ) {\n\tdoc.dir = document.dir;\n\tdoc.body.className = BODY_CLASS_NAME;\n\n\tfor ( const name of document.body.classList ) {\n\t\tif ( name.startsWith( 'admin-color-' ) ) {\n\t\t\tdoc.body.classList.add( name );\n\t\t}\n\t}\n}\n\n/**\n * Sets the document head and default styles.\n *\n * @param {Document} doc  Document to set the head for.\n * @param {string}   head HTML to set as the head.\n */\nfunction setHead( doc, head ) {\n\tdoc.head.innerHTML =\n\t\t// Body margin must be overridable by themes.\n\t\t'<style>body{margin:0}</style>' + head;\n}\n\nfunction Iframe( { contentRef, children, head, headHTML, ...props }, ref ) {\n\tconst [ iframeDocument, setIframeDocument ] = useState();\n\n\tconst setRef = useCallback( ( node ) => {\n\t\tif ( ! node ) {\n\t\t\treturn;\n\t\t}\n\n\t\tfunction setDocumentIfReady() {\n\t\t\tconst { contentDocument } = node;\n\t\t\tconst { readyState, body } = contentDocument;\n\n\t\t\tif ( readyState !== 'interactive' && readyState !== 'complete' ) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tif ( typeof contentRef === 'function' ) {\n\t\t\t\tcontentRef( body );\n\t\t\t} else if ( contentRef ) {\n\t\t\t\tcontentRef.current = body;\n\t\t\t}\n\n\t\t\tsetHead( contentDocument, headHTML );\n\t\t\tsetBodyClassName( contentDocument );\n\t\t\tstyleSheetsCompat( contentDocument );\n\t\t\tbubbleEvents( contentDocument );\n\t\t\tsetBodyClassName( contentDocument );\n\t\t\tsetIframeDocument( contentDocument );\n\n\t\t\treturn true;\n\t\t}\n\n\t\tif ( setDocumentIfReady() ) {\n\t\t\treturn;\n\t\t}\n\n\t\t// Document is not immediately loaded in Firefox.\n\t\tnode.addEventListener( 'load', () => {\n\t\t\tsetDocumentIfReady();\n\t\t} );\n\t}, [] );\n\n\treturn (\n\t\t<iframe\n\t\t\t{ ...props }\n\t\t\tref={ useMergeRefs( [ ref, setRef ] ) }\n\t\t\ttabIndex=\"0\"\n\t\t\ttitle={ __( 'Editor canvas' ) }\n\t\t\tname=\"editor-canvas\"\n\t\t>\n\t\t\t{ iframeDocument && createPortal( children, iframeDocument.body ) }\n\t\t\t{ iframeDocument && createPortal( head, iframeDocument.head ) }\n\t\t</iframe>\n\t);\n}\n\nexport default forwardRef( Iframe );\n"]}