{"version":3,"sources":["@wordpress/block-editor/src/components/use-moving-animation/index.js"],"names":["counterReducer","state","getAbsolutePosition","element","top","offsetTop","left","offsetLeft","useMovingAnimation","isSelected","adjustScrolling","enableAnimation","triggerAnimationOnChange","ref","prefersReducedMotion","triggeredAnimation","triggerAnimation","finishedAnimation","endAnimation","x","y","transform","setTransform","previous","current","preserveScrollPosition","scrollContainer","prevRect","getBoundingClientRect","blockRect","diff","scrollTop","style","destination","Math","round","onFrameChange","isMoving","transformOrigin","zIndex","onFrame","from","to","reset","config","mass","tension","friction","immediate"],"mappings":"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","sourcesContent":["/**\n * External dependencies\n */\nimport { useSpring } from 'react-spring/web.cjs';\n\n/**\n * WordPress dependencies\n */\nimport {\n\tuseState,\n\tuseLayoutEffect,\n\tuseReducer,\n\tuseMemo,\n\tuseRef,\n} from '@wordpress/element';\nimport { useReducedMotion } from '@wordpress/compose';\nimport { getScrollContainer } from '@wordpress/dom';\n\n/**\n * Simple reducer used to increment a counter.\n *\n * @param {number} state  Previous counter value.\n * @return {number} New state value.\n */\nconst counterReducer = ( state ) => state + 1;\n\nconst getAbsolutePosition = ( element ) => {\n\treturn {\n\t\ttop: element.offsetTop,\n\t\tleft: element.offsetLeft,\n\t};\n};\n\n/**\n * Hook used to compute the styles required to move a div into a new position.\n *\n * The way this animation works is the following:\n *  - It first renders the element as if there was no animation.\n *  - It takes a snapshot of the position of the block to use it\n *    as a destination point for the animation.\n *  - It restores the element to the previous position using a CSS transform\n *  - It uses the \"resetAnimation\" flag to reset the animation\n *    from the beginning in order to animate to the new destination point.\n *\n * @param {Object}  $1                          Options\n * @param {boolean} $1.isSelected               Whether it's the current block or not.\n * @param {boolean} $1.adjustScrolling          Adjust the scroll position to the current block.\n * @param {boolean} $1.enableAnimation          Enable/Disable animation.\n * @param {*}       $1.triggerAnimationOnChange Variable used to trigger the animation if it changes.\n */\nfunction useMovingAnimation( {\n\tisSelected,\n\tadjustScrolling,\n\tenableAnimation,\n\ttriggerAnimationOnChange,\n} ) {\n\tconst ref = useRef();\n\tconst prefersReducedMotion = useReducedMotion() || ! enableAnimation;\n\tconst [ triggeredAnimation, triggerAnimation ] = useReducer(\n\t\tcounterReducer,\n\t\t0\n\t);\n\tconst [ finishedAnimation, endAnimation ] = useReducer( counterReducer, 0 );\n\tconst [ transform, setTransform ] = useState( { x: 0, y: 0 } );\n\tconst previous = useMemo(\n\t\t() => ( ref.current ? getAbsolutePosition( ref.current ) : null ),\n\t\t[ triggerAnimationOnChange ]\n\t);\n\n\t// Calculate the previous position of the block relative to the viewport and\n\t// return a function to maintain that position by scrolling.\n\tconst preserveScrollPosition = useMemo( () => {\n\t\tif ( ! adjustScrolling || ! ref.current ) {\n\t\t\treturn () => {};\n\t\t}\n\n\t\tconst scrollContainer = getScrollContainer( ref.current );\n\n\t\tif ( ! scrollContainer ) {\n\t\t\treturn () => {};\n\t\t}\n\n\t\tconst prevRect = ref.current.getBoundingClientRect();\n\t\treturn () => {\n\t\t\tconst blockRect = ref.current.getBoundingClientRect();\n\t\t\tconst diff = blockRect.top - prevRect.top;\n\n\t\t\tif ( diff ) {\n\t\t\t\tscrollContainer.scrollTop += diff;\n\t\t\t}\n\t\t};\n\t}, [ triggerAnimationOnChange, adjustScrolling ] );\n\n\tuseLayoutEffect( () => {\n\t\tif ( triggeredAnimation ) {\n\t\t\tendAnimation();\n\t\t}\n\t}, [ triggeredAnimation ] );\n\tuseLayoutEffect( () => {\n\t\tif ( ! previous ) {\n\t\t\treturn;\n\t\t}\n\n\t\tif ( prefersReducedMotion ) {\n\t\t\t// if the animation is disabled and the scroll needs to be adjusted,\n\t\t\t// just move directly to the final scroll position.\n\t\t\tpreserveScrollPosition();\n\n\t\t\treturn;\n\t\t}\n\n\t\tref.current.style.transform = '';\n\t\tconst destination = getAbsolutePosition( ref.current );\n\n\t\ttriggerAnimation();\n\t\tsetTransform( {\n\t\t\tx: Math.round( previous.left - destination.left ),\n\t\t\ty: Math.round( previous.top - destination.top ),\n\t\t} );\n\t}, [ triggerAnimationOnChange ] );\n\n\t// Only called when either the x or y value changes.\n\tfunction onFrameChange( { x, y } ) {\n\t\tif ( ! ref.current ) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst isMoving = x === 0 && y === 0;\n\t\tref.current.style.transformOrigin = isMoving ? '' : 'center';\n\t\tref.current.style.transform = isMoving\n\t\t\t? ''\n\t\t\t: `translate3d(${ x }px,${ y }px,0)`;\n\t\tref.current.style.zIndex = ! isSelected || isMoving ? '' : '1';\n\n\t\tpreserveScrollPosition();\n\t}\n\n\t// Called for every frame computed by useSpring.\n\tfunction onFrame( { x, y } ) {\n\t\tx = Math.round( x );\n\t\ty = Math.round( y );\n\n\t\tif ( x !== onFrame.x || y !== onFrame.y ) {\n\t\t\tonFrameChange( { x, y } );\n\t\t\tonFrame.x = x;\n\t\t\tonFrame.y = y;\n\t\t}\n\t}\n\n\tonFrame.x = 0;\n\tonFrame.y = 0;\n\n\tuseSpring( {\n\t\tfrom: {\n\t\t\tx: transform.x,\n\t\t\ty: transform.y,\n\t\t},\n\t\tto: {\n\t\t\tx: 0,\n\t\t\ty: 0,\n\t\t},\n\t\treset: triggeredAnimation !== finishedAnimation,\n\t\tconfig: { mass: 5, tension: 2000, friction: 200 },\n\t\timmediate: prefersReducedMotion,\n\t\tonFrame,\n\t} );\n\n\treturn ref;\n}\n\nexport default useMovingAnimation;\n"]}