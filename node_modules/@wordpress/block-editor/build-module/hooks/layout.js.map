{"version":3,"sources":["@wordpress/block-editor/src/hooks/layout.js"],"names":["classnames","has","Platform","createHigherOrderComponent","useInstanceId","addFilter","hasBlockSupport","useSelect","ToggleControl","PanelBody","__experimentalUnitControl","UnitControl","__","Icon","positionCenter","stretchWide","store","blockEditorStore","InspectorControls","useEditorFeature","LayoutStyle","isWeb","OS","CSS_UNITS","value","label","default","LayoutPanel","setAttributes","attributes","layout","wideSize","contentSize","inherit","defaultLayout","themeSupportsLayout","select","getSettings","supportsLayout","nextWidth","parseFloat","addAttribute","settings","type","withInspectorControls","BlockEdit","props","blockName","name","supportLayout","withLayoutStyles","BlockListBlock","id","usedLayout","className"],"mappings":"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","sourcesContent":["/**\n * External dependencies\n */\nimport classnames from 'classnames';\nimport { has } from 'lodash';\n\n/**\n * WordPress dependencies\n */\nimport { Platform } from '@wordpress/element';\nimport { createHigherOrderComponent, useInstanceId } from '@wordpress/compose';\nimport { addFilter } from '@wordpress/hooks';\nimport { hasBlockSupport } from '@wordpress/blocks';\nimport { useSelect } from '@wordpress/data';\nimport {\n\tToggleControl,\n\tPanelBody,\n\t__experimentalUnitControl as UnitControl,\n} from '@wordpress/components';\nimport { __ } from '@wordpress/i18n';\nimport { Icon, positionCenter, stretchWide } from '@wordpress/icons';\n\n/**\n * Internal dependencies\n */\nimport { store as blockEditorStore } from '../store';\nimport { InspectorControls } from '../components';\nimport useEditorFeature from '../components/use-editor-feature';\nimport { LayoutStyle } from '../components/block-list/layout';\n\nconst isWeb = Platform.OS === 'web';\nconst CSS_UNITS = [\n\t{\n\t\tvalue: '%',\n\t\tlabel: isWeb ? '%' : __( 'Percentage (%)' ),\n\t\tdefault: '',\n\t},\n\t{\n\t\tvalue: 'px',\n\t\tlabel: isWeb ? 'px' : __( 'Pixels (px)' ),\n\t\tdefault: '',\n\t},\n\t{\n\t\tvalue: 'em',\n\t\tlabel: isWeb ? 'em' : __( 'Relative to parent font size (em)' ),\n\t\tdefault: '',\n\t},\n\t{\n\t\tvalue: 'rem',\n\t\tlabel: isWeb ? 'rem' : __( 'Relative to root font size (rem)' ),\n\t\tdefault: '',\n\t},\n\t{\n\t\tvalue: 'vw',\n\t\tlabel: isWeb ? 'vw' : __( 'Viewport width (vw)' ),\n\t\tdefault: '',\n\t},\n];\n\nfunction LayoutPanel( { setAttributes, attributes } ) {\n\tconst { layout = {} } = attributes;\n\tconst { wideSize, contentSize, inherit = false } = layout;\n\tconst defaultLayout = useEditorFeature( 'layout' );\n\tconst themeSupportsLayout = useSelect( ( select ) => {\n\t\tconst { getSettings } = select( blockEditorStore );\n\t\treturn getSettings().supportsLayout;\n\t}, [] );\n\n\tif ( ! themeSupportsLayout ) {\n\t\treturn null;\n\t}\n\treturn (\n\t\t<InspectorControls>\n\t\t\t<PanelBody title={ __( 'Layout' ) }>\n\t\t\t\t{ !! defaultLayout && (\n\t\t\t\t\t<ToggleControl\n\t\t\t\t\t\tlabel={ __( 'Inherit default layout' ) }\n\t\t\t\t\t\tchecked={ !! inherit }\n\t\t\t\t\t\tonChange={ () =>\n\t\t\t\t\t\t\tsetAttributes( { layout: { inherit: ! inherit } } )\n\t\t\t\t\t\t}\n\t\t\t\t\t/>\n\t\t\t\t) }\n\t\t\t\t{ ! inherit && (\n\t\t\t\t\t<div className=\"block-editor-hooks__layout-controls\">\n\t\t\t\t\t\t<div className=\"block-editor-hooks__layout-controls-unit\">\n\t\t\t\t\t\t\t<UnitControl\n\t\t\t\t\t\t\t\tlabel={ __( 'Content' ) }\n\t\t\t\t\t\t\t\tlabelPosition=\"top\"\n\t\t\t\t\t\t\t\t__unstableInputWidth=\"80px\"\n\t\t\t\t\t\t\t\tvalue={ contentSize || wideSize || '' }\n\t\t\t\t\t\t\t\tonChange={ ( nextWidth ) => {\n\t\t\t\t\t\t\t\t\tnextWidth =\n\t\t\t\t\t\t\t\t\t\t0 > parseFloat( nextWidth )\n\t\t\t\t\t\t\t\t\t\t\t? '0'\n\t\t\t\t\t\t\t\t\t\t\t: nextWidth;\n\t\t\t\t\t\t\t\t\tsetAttributes( {\n\t\t\t\t\t\t\t\t\t\tlayout: {\n\t\t\t\t\t\t\t\t\t\t\t...layout,\n\t\t\t\t\t\t\t\t\t\t\tcontentSize: nextWidth,\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t} );\n\t\t\t\t\t\t\t\t} }\n\t\t\t\t\t\t\t\tunits={ CSS_UNITS }\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t<Icon icon={ positionCenter } />\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div className=\"block-editor-hooks__layout-controls-unit\">\n\t\t\t\t\t\t\t<UnitControl\n\t\t\t\t\t\t\t\tlabel={ __( 'Wide' ) }\n\t\t\t\t\t\t\t\tlabelPosition=\"top\"\n\t\t\t\t\t\t\t\t__unstableInputWidth=\"80px\"\n\t\t\t\t\t\t\t\tvalue={ wideSize || contentSize || '' }\n\t\t\t\t\t\t\t\tonChange={ ( nextWidth ) => {\n\t\t\t\t\t\t\t\t\tnextWidth =\n\t\t\t\t\t\t\t\t\t\t0 > parseFloat( nextWidth )\n\t\t\t\t\t\t\t\t\t\t\t? '0'\n\t\t\t\t\t\t\t\t\t\t\t: nextWidth;\n\t\t\t\t\t\t\t\t\tsetAttributes( {\n\t\t\t\t\t\t\t\t\t\tlayout: {\n\t\t\t\t\t\t\t\t\t\t\t...layout,\n\t\t\t\t\t\t\t\t\t\t\twideSize: nextWidth,\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t} );\n\t\t\t\t\t\t\t\t} }\n\t\t\t\t\t\t\t\tunits={ CSS_UNITS }\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t<Icon icon={ stretchWide } />\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t) }\n\t\t\t\t<p className=\"block-editor-hooks__layout-controls-helptext\">\n\t\t\t\t\t{ __(\n\t\t\t\t\t\t'Customize the width for all elements that are assigned to the center or wide columns.'\n\t\t\t\t\t) }\n\t\t\t\t</p>\n\t\t\t</PanelBody>\n\t\t</InspectorControls>\n\t);\n}\n\n/**\n * Filters registered block settings, extending attributes to include `layout`.\n *\n * @param  {Object} settings Original block settings\n * @return {Object}          Filtered block settings\n */\nexport function addAttribute( settings ) {\n\tif ( has( settings.attributes, [ 'layout', 'type' ] ) ) {\n\t\treturn settings;\n\t}\n\tif ( hasBlockSupport( settings, '__experimentalLayout' ) ) {\n\t\tsettings.attributes = {\n\t\t\t...settings.attributes,\n\t\t\tlayout: {\n\t\t\t\ttype: 'object',\n\t\t\t},\n\t\t};\n\t}\n\n\treturn settings;\n}\n\n/**\n * Override the default edit UI to include layout controls\n *\n * @param  {Function} BlockEdit Original component\n * @return {Function}           Wrapped component\n */\nexport const withInspectorControls = createHigherOrderComponent(\n\t( BlockEdit ) => ( props ) => {\n\t\tconst { name: blockName } = props;\n\t\tconst supportLayout = hasBlockSupport(\n\t\t\tblockName,\n\t\t\t'__experimentalLayout'\n\t\t);\n\n\t\treturn [\n\t\t\tsupportLayout && <LayoutPanel key=\"layout\" { ...props } />,\n\t\t\t<BlockEdit key=\"edit\" { ...props } />,\n\t\t];\n\t},\n\t'withInspectorControls'\n);\n\n/**\n * Override the default block element to add the layout styles.\n *\n * @param  {Function} BlockListBlock Original component\n * @return {Function}                Wrapped component\n */\nexport const withLayoutStyles = createHigherOrderComponent(\n\t( BlockListBlock ) => ( props ) => {\n\t\tconst { name, attributes } = props;\n\t\tconst supportLayout = hasBlockSupport( name, '__experimentalLayout' );\n\t\tconst id = useInstanceId( BlockListBlock );\n\t\tconst defaultLayout = useEditorFeature( 'layout' ) || {};\n\t\tif ( ! supportLayout ) {\n\t\t\treturn <BlockListBlock { ...props } />;\n\t\t}\n\t\tconst { layout = {} } = attributes;\n\t\tconst usedLayout = !! layout && layout.inherit ? defaultLayout : layout;\n\t\tconst className = classnames(\n\t\t\tprops?.className,\n\t\t\t`wp-container-${ id }`\n\t\t);\n\n\t\treturn (\n\t\t\t<>\n\t\t\t\t<LayoutStyle\n\t\t\t\t\tselector={ `.wp-container-${ id }` }\n\t\t\t\t\tlayout={ usedLayout }\n\t\t\t\t/>\n\t\t\t\t<BlockListBlock { ...props } className={ className } />\n\t\t\t</>\n\t\t);\n\t}\n);\n\naddFilter(\n\t'blocks.registerBlockType',\n\t'core/layout/addAttribute',\n\taddAttribute\n);\naddFilter(\n\t'editor.BlockListBlock',\n\t'core/editor/layout/with-layout-styles',\n\twithLayoutStyles\n);\naddFilter(\n\t'editor.BlockEdit',\n\t'core/editor/layout/with-inspector-controls',\n\twithInspectorControls\n);\n"]}