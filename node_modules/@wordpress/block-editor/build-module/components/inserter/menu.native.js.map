{"version":3,"sources":["@wordpress/block-editor/src/components/inserter/menu.native.js"],"names":["View","useEffect","useState","useCallback","useSelect","useDispatch","createBlock","rawHandler","store","blocksStore","BottomSheet","BottomSheetConsumer","getClipboard","InserterSearchResults","InserterSearchForm","blockEditorStore","searchItems","MIN_ITEMS_FOR_SEARCH","InserterMenu","onSelect","onDismiss","rootClientId","clientId","isAppender","shouldReplaceBlock","insertionIndex","filterValue","setFilterValue","searchFormHeight","setSearchFormHeight","__DEV__","showSearchForm","setShowSearchForm","showInsertionPoint","hideInsertionPoint","clearSelectedBlock","insertBlock","removeBlock","resetBlocks","insertDefaultBlock","select","getInserterItems","getBlockRootClientId","getBlockSelectionEnd","selectBlockEditorStore","targetRootClientId","end","undefined","items","destinationRootClientId","getBlockOrder","getBlockCount","canInsertBlockType","getBlockType","count","blockToReplace","getItems","length","onClose","onInsert","item","name","initialAttributes","innerBlocks","newBlock","itemsToDisplay","filter","clipboard","clipboardBlock","HTML","canAddClipboardBlock","icon","attributes","id","listProps","safeAreaBottomInset","value","event","height","nativeEvent","layout"],"mappings":";;;;;AAAA;AACA;AACA;AACA,SAASA,IAAT,QAAqB,cAArB;AACA;AACA;AACA;;AACA,SAASC,SAAT,EAAoBC,QAApB,EAA8BC,WAA9B,QAAiD,oBAAjD;AACA,SAASC,SAAT,EAAoBC,WAApB,QAAuC,iBAAvC;AACA,SACCC,WADD,EAECC,UAFD,EAGCC,KAAK,IAAIC,WAHV,QAIO,mBAJP;AAKA,SACCC,WADD,EAECC,mBAFD,EAGCC,YAHD,QAIO,uBAJP;AAMA;AACA;AACA;;AAEA,OAAOC,qBAAP,MAAkC,kBAAlC;AACA,OAAOC,kBAAP,MAA+B,eAA/B;AACA,SAASN,KAAK,IAAIO,gBAAlB,QAA0C,aAA1C;AACA,SAASC,WAAT,QAA4B,gBAA5B;AAEA,IAAMC,oBAAoB,GAAG,CAA7B;;AAEA,SAASC,YAAT,OAQI;AAAA,MAPHC,SAOG,QAPHA,QAOG;AAAA,MANHC,SAMG,QANHA,SAMG;AAAA,MALHC,YAKG,QALHA,YAKG;AAAA,MAJHC,QAIG,QAJHA,QAIG;AAAA,MAHHC,UAGG,QAHHA,UAGG;AAAA,MAFHC,kBAEG,QAFHA,kBAEG;AAAA,MADHC,cACG,QADHA,cACG;;AAAA,kBACqCvB,QAAQ,CAAE,EAAF,CAD7C;AAAA;AAAA,MACKwB,WADL;AAAA,MACkBC,cADlB;;AAAA,mBAE+CzB,QAAQ,CAAE,CAAF,CAFvD;AAAA;AAAA,MAEK0B,gBAFL;AAAA,MAEuBC,mBAFvB,kBAGH;;;AAHG,mBAI2C3B,QAAQ,CAAE4B,OAAF,CAJnD;AAAA;AAAA,MAIKC,cAJL;AAAA,MAIqBC,iBAJrB;;AAAA,qBAcC3B,WAAW,CAAEU,gBAAF,CAdZ;AAAA,MAOFkB,kBAPE,gBAOFA,kBAPE;AAAA,MAQFC,kBARE,gBAQFA,kBARE;AAAA,MASFC,kBATE,gBASFA,kBATE;AAAA,MAUFC,WAVE,gBAUFA,WAVE;AAAA,MAWFC,WAXE,gBAWFA,WAXE;AAAA,MAYFC,WAZE,gBAYFA,WAZE;AAAA,MAaFC,kBAbE,gBAaFA,kBAbE;;AAAA,mBAsBCnC,SAAS,CAAE,UAAEoC,MAAF,EAAc;AAAA,kBAMxBA,MAAM,CAAEzB,gBAAF,CANkB;AAAA,QAE3B0B,gBAF2B,WAE3BA,gBAF2B;AAAA,QAG3BC,oBAH2B,WAG3BA,oBAH2B;AAAA,QAI3BC,oBAJ2B,WAI3BA,oBAJ2B;AAAA,QAKxBC,sBALwB;;AAQ5B,QAAIC,kBAAkB,GAAGxB,YAAzB;;AACA,QAAK,CAAEwB,kBAAF,IAAwB,CAAEvB,QAA1B,IAAsC,CAAEC,UAA7C,EAA0D;AACzD,UAAMuB,GAAG,GAAGH,oBAAoB,EAAhC;;AACA,UAAKG,GAAL,EAAW;AACVD,QAAAA,kBAAkB,GAAGH,oBAAoB,CAAEI,GAAF,CAApB,IAA+BC,SAApD;AACA;AACD;;AAED,WAAO;AACNC,MAAAA,KAAK,EAAEP,gBAAgB,CAAEI,kBAAF,CADjB;AAENI,MAAAA,uBAAuB,EAAEJ,kBAFnB;AAGNK,MAAAA,aAAa,EAAEN,sBAAsB,CAACM,aAHhC;AAINC,MAAAA,aAAa,EAAEP,sBAAsB,CAACO,aAJhC;AAKNC,MAAAA,kBAAkB,EAAER,sBAAsB,CAACQ;AALrC,KAAP;AAOA,GAvBY,CAtBV;AAAA,MAiBFJ,KAjBE,cAiBFA,KAjBE;AAAA,MAkBFC,uBAlBE,cAkBFA,uBAlBE;AAAA,MAmBFC,aAnBE,cAmBFA,aAnBE;AAAA,MAoBFC,aApBE,cAoBFA,aApBE;AAAA,MAqBFC,kBArBE,cAqBFA,kBArBE;;AAAA,oBA+CsBhD,SAAS,CAAE,UAAEoC,MAAF;AAAA,WAAcA,MAAM,CAAE/B,WAAF,CAApB;AAAA,GAAF,CA/C/B;AAAA,MA+CK4C,YA/CL,eA+CKA,YA/CL;;AAiDHpD,EAAAA,SAAS,CAAE,YAAM;AAAA;;AAChB;AACA,QAAKuB,kBAAL,EAA0B;AACzB,UAAM8B,KAAK,GAAGH,aAAa,EAA3B,CADyB,CAEzB;AACA;;AACA,UAAKG,KAAK,KAAK,CAAV,IAAe,CAAEjC,YAAtB,EAAqC;AACpC;AACA;AACAc,QAAAA,kBAAkB;AAClBG,QAAAA,WAAW,CAAE,EAAF,CAAX;AACA,OALD,MAKO;AACN,YAAMiB,cAAc,GAAGL,aAAa,CAAED,uBAAF,CAAb,CACtBxB,cADsB,CAAvB;AAGAY,QAAAA,WAAW,CAAEkB,cAAF,EAAkB,KAAlB,CAAX;AACA;AACD;;AACDtB,IAAAA,kBAAkB,CAAEgB,uBAAF,EAA2BxB,cAA3B,CAAlB,CAlBgB,CAoBhB;;AACA,QAAK,cAAA+B,QAAQ,YAAR,8CAAYC,MAAZ,IAAqBxC,oBAA1B,EAAiD;AAChDe,MAAAA,iBAAiB,CAAE,KAAF,CAAjB;AACA;;AAED,WAAOE,kBAAP;AACA,GA1BQ,EA0BN,EA1BM,CAAT;AA4BA,MAAMwB,OAAO,GAAGvD,WAAW,CAAE,YAAM;AAClC;AACA;AACA,QAAKqB,kBAAL,EAA0B;AACzBe,MAAAA,kBAAkB,CAAE,EAAF,EAAMU,uBAAN,EAA+BxB,cAA/B,CAAlB;AACA;;AACDL,IAAAA,SAAS;AACT,GAP0B,EAOxB,CAAEI,kBAAF,EAAsByB,uBAAtB,EAA+CxB,cAA/C,CAPwB,CAA3B;AASA,MAAMkC,QAAQ,GAAGxD,WAAW,CAC3B,UAAEyD,IAAF,EAAY;AAAA,QACHC,IADG,GACsCD,IADtC,CACHC,IADG;AAAA,QACGC,iBADH,GACsCF,IADtC,CACGE,iBADH;AAAA,QACsBC,WADtB,GACsCH,IADtC,CACsBG,WADtB;AAGX,QAAMC,QAAQ,GAAG1D,WAAW,CAC3BuD,IAD2B,EAE3BC,iBAF2B,EAG3BC,WAH2B,CAA5B;AAMA3B,IAAAA,WAAW,CAAE4B,QAAF,EAAYvC,cAAZ,EAA4BwB,uBAA5B,CAAX;AACA,GAX0B,EAY3B,CAAEb,WAAF,EAAea,uBAAf,EAAwCxB,cAAxC,CAZ2B,CAA5B;AAeA;AACD;AACA;AACA;AACA;;AACC,WAAS+B,QAAT,GAAoB;AAAA;;AACnB;AACA,QAAIS,cAAc,GAAGjB,KAAK,CAACkB,MAAN,CACpB;AAAA,UAAIL,IAAJ,SAAIA,IAAJ;AAAA,aAAgBA,IAAI,KAAK,YAAzB;AAAA,KADoB,CAArB;AAIAI,IAAAA,cAAc,GAAGjD,WAAW,CAAEiD,cAAF,EAAkBvC,WAAlB,CAA5B;AAEA,QAAMyC,SAAS,GAAGvD,YAAY,EAA9B;AACA,QAAIwD,cAAc,GAAG7D,UAAU,CAAE;AAAE8D,MAAAA,IAAI,EAAEF;AAAR,KAAF,CAAV,CAAmC,CAAnC,CAArB;AAEA,QAAMG,oBAAoB,GAAGlB,kBAAkB,oBAC9CgB,cAD8C,oDAC9C,gBAAgBP,IAD8B,EAE9CZ,uBAF8C,CAA/C;;AAKA,QAAK,CAAEqB,oBAAP,EAA8B;AAC7B,aAAOL,cAAP;AACA;;AAlBkB,wBAoBIZ,YAAY,CAAEe,cAAc,CAACP,IAAjB,CApBhB;AAAA,QAoBXU,IApBW,iBAoBXA,IApBW;AAAA,QAoBLV,IApBK,iBAoBLA,IApBK;;AAAA,2BAqBoCO,cArBpC;AAAA,QAqBCN,iBArBD,oBAqBXU,UArBW;AAAA,QAqBoBT,WArBpB,oBAqBoBA,WArBpB;AAuBnBK,IAAAA,cAAc,GAAG;AAChBK,MAAAA,EAAE,EAAE,WADY;AAEhBZ,MAAAA,IAAI,EAAJA,IAFgB;AAGhBU,MAAAA,IAAI,EAAJA,IAHgB;AAIhBT,MAAAA,iBAAiB,EAAjBA,iBAJgB;AAKhBC,MAAAA,WAAW,EAAXA;AALgB,KAAjB;AAQA,YAASK,cAAT,4BAA4BH,cAA5B;AACA;;AAED,SACC,cAAC,WAAD;AACC,IAAA,SAAS,EAAG,IADb;AAEC,IAAA,OAAO,EAAGP,OAFX;AAGC,IAAA,UAAU,MAHX;AAIC,IAAA,aAAa,MAJd;AAKC,IAAA,uBAAuB,EAAG3B;AAL3B,KAOC,cAAC,mBAAD,QACG;AAAA,QAAI2C,SAAJ,SAAIA,SAAJ;AAAA,QAAeC,mBAAf,SAAeA,mBAAf;AAAA,WACD,cAAC,IAAD,QACG5C,cAAc,IACf,cAAC,kBAAD;AACC,MAAA,QAAQ,EAAG,kBAAE6C,KAAF,EAAa;AACvBjD,QAAAA,cAAc,CAAEiD,KAAF,CAAd;AACA,OAHF;AAIC,MAAA,KAAK,EAAGlD,WAJT;AAKC,MAAA,QAAQ,EAAG,kBAAEmD,KAAF,EAAa;AAAA,YACfC,MADe,GACJD,KAAK,CAACE,WAAN,CAAkBC,MADd,CACfF,MADe;AAEvBjD,QAAAA,mBAAmB,CAAEiD,MAAF,CAAnB;AACA;AARF,MAFF,EAcC,cAAC,qBAAD;AACC,MAAA,KAAK,EAAGtB,QAAQ,EADjB;AAEC,MAAA,QAAQ,EAAG,kBAAEI,IAAF,EAAY;AACtBD,QAAAA,QAAQ,CAAEC,IAAF,CAAR;;AACAzC,QAAAA,SAAQ,CAAEyC,IAAF,CAAR;AACA,OALF;AAOEc,MAAAA,SAAS,EAATA,SAPF;AAQEC,MAAAA,mBAAmB,EAAnBA,mBARF;AASE/C,MAAAA,gBAAgB,EAAhBA;AATF,MAdD,CADC;AAAA,GADH,CAPD,CADD;AAyCA;;AAED,eAAeV,YAAf","sourcesContent":["/**\n * External dependencies\n */\nimport { View } from 'react-native';\n/**\n * WordPress dependencies\n */\nimport { useEffect, useState, useCallback } from '@wordpress/element';\nimport { useSelect, useDispatch } from '@wordpress/data';\nimport {\n\tcreateBlock,\n\trawHandler,\n\tstore as blocksStore,\n} from '@wordpress/blocks';\nimport {\n\tBottomSheet,\n\tBottomSheetConsumer,\n\tgetClipboard,\n} from '@wordpress/components';\n\n/**\n * Internal dependencies\n */\n\nimport InserterSearchResults from './search-results';\nimport InserterSearchForm from './search-form';\nimport { store as blockEditorStore } from '../../store';\nimport { searchItems } from './search-items';\n\nconst MIN_ITEMS_FOR_SEARCH = 2;\n\nfunction InserterMenu( {\n\tonSelect,\n\tonDismiss,\n\trootClientId,\n\tclientId,\n\tisAppender,\n\tshouldReplaceBlock,\n\tinsertionIndex,\n} ) {\n\tconst [ filterValue, setFilterValue ] = useState( '' );\n\tconst [ searchFormHeight, setSearchFormHeight ] = useState( 0 );\n\t// eslint-disable-next-line no-undef\n\tconst [ showSearchForm, setShowSearchForm ] = useState( __DEV__ );\n\n\tconst {\n\t\tshowInsertionPoint,\n\t\thideInsertionPoint,\n\t\tclearSelectedBlock,\n\t\tinsertBlock,\n\t\tremoveBlock,\n\t\tresetBlocks,\n\t\tinsertDefaultBlock,\n\t} = useDispatch( blockEditorStore );\n\n\tconst {\n\t\titems,\n\t\tdestinationRootClientId,\n\t\tgetBlockOrder,\n\t\tgetBlockCount,\n\t\tcanInsertBlockType,\n\t} = useSelect( ( select ) => {\n\t\tconst {\n\t\t\tgetInserterItems,\n\t\t\tgetBlockRootClientId,\n\t\t\tgetBlockSelectionEnd,\n\t\t\t...selectBlockEditorStore\n\t\t} = select( blockEditorStore );\n\n\t\tlet targetRootClientId = rootClientId;\n\t\tif ( ! targetRootClientId && ! clientId && ! isAppender ) {\n\t\t\tconst end = getBlockSelectionEnd();\n\t\t\tif ( end ) {\n\t\t\t\ttargetRootClientId = getBlockRootClientId( end ) || undefined;\n\t\t\t}\n\t\t}\n\n\t\treturn {\n\t\t\titems: getInserterItems( targetRootClientId ),\n\t\t\tdestinationRootClientId: targetRootClientId,\n\t\t\tgetBlockOrder: selectBlockEditorStore.getBlockOrder,\n\t\t\tgetBlockCount: selectBlockEditorStore.getBlockCount,\n\t\t\tcanInsertBlockType: selectBlockEditorStore.canInsertBlockType,\n\t\t};\n\t} );\n\n\tconst { getBlockType } = useSelect( ( select ) => select( blocksStore ) );\n\n\tuseEffect( () => {\n\t\t// Show/Hide insertion point on Mount/Dismount\n\t\tif ( shouldReplaceBlock ) {\n\t\t\tconst count = getBlockCount();\n\t\t\t// Check if there is a rootClientId because that means it is a nested replaceable block\n\t\t\t// and we don't want to clear/reset all blocks.\n\t\t\tif ( count === 1 && ! rootClientId ) {\n\t\t\t\t// Removing the last block is not possilble with `removeBlock` action.\n\t\t\t\t// It always inserts a default block if the last of the blocks have been removed.\n\t\t\t\tclearSelectedBlock();\n\t\t\t\tresetBlocks( [] );\n\t\t\t} else {\n\t\t\t\tconst blockToReplace = getBlockOrder( destinationRootClientId )[\n\t\t\t\t\tinsertionIndex\n\t\t\t\t];\n\t\t\t\tremoveBlock( blockToReplace, false );\n\t\t\t}\n\t\t}\n\t\tshowInsertionPoint( destinationRootClientId, insertionIndex );\n\n\t\t// Show search form if there are enough items to filter.\n\t\tif ( getItems()?.length < MIN_ITEMS_FOR_SEARCH ) {\n\t\t\tsetShowSearchForm( false );\n\t\t}\n\n\t\treturn hideInsertionPoint;\n\t}, [] );\n\n\tconst onClose = useCallback( () => {\n\t\t// if should replace but didn't insert any block\n\t\t// re-insert default block\n\t\tif ( shouldReplaceBlock ) {\n\t\t\tinsertDefaultBlock( {}, destinationRootClientId, insertionIndex );\n\t\t}\n\t\tonDismiss();\n\t}, [ shouldReplaceBlock, destinationRootClientId, insertionIndex ] );\n\n\tconst onInsert = useCallback(\n\t\t( item ) => {\n\t\t\tconst { name, initialAttributes, innerBlocks } = item;\n\n\t\t\tconst newBlock = createBlock(\n\t\t\t\tname,\n\t\t\t\tinitialAttributes,\n\t\t\t\tinnerBlocks\n\t\t\t);\n\n\t\t\tinsertBlock( newBlock, insertionIndex, destinationRootClientId );\n\t\t},\n\t\t[ insertBlock, destinationRootClientId, insertionIndex ]\n\t);\n\n\t/**\n\t * Processes the inserter items to check\n\t * if there's any copied block in the clipboard\n\t * to add it as an extra item\n\t */\n\tfunction getItems() {\n\t\t// Filter out reusable blocks (they will be added in another tab)\n\t\tlet itemsToDisplay = items.filter(\n\t\t\t( { name } ) => name !== 'core/block'\n\t\t);\n\n\t\titemsToDisplay = searchItems( itemsToDisplay, filterValue );\n\n\t\tconst clipboard = getClipboard();\n\t\tlet clipboardBlock = rawHandler( { HTML: clipboard } )[ 0 ];\n\n\t\tconst canAddClipboardBlock = canInsertBlockType(\n\t\t\tclipboardBlock?.name,\n\t\t\tdestinationRootClientId\n\t\t);\n\n\t\tif ( ! canAddClipboardBlock ) {\n\t\t\treturn itemsToDisplay;\n\t\t}\n\n\t\tconst { icon, name } = getBlockType( clipboardBlock.name );\n\t\tconst { attributes: initialAttributes, innerBlocks } = clipboardBlock;\n\n\t\tclipboardBlock = {\n\t\t\tid: 'clipboard',\n\t\t\tname,\n\t\t\ticon,\n\t\t\tinitialAttributes,\n\t\t\tinnerBlocks,\n\t\t};\n\n\t\treturn [ clipboardBlock, ...itemsToDisplay ];\n\t}\n\n\treturn (\n\t\t<BottomSheet\n\t\t\tisVisible={ true }\n\t\t\tonClose={ onClose }\n\t\t\thideHeader\n\t\t\thasNavigation\n\t\t\tsetMinHeightToMaxHeight={ showSearchForm }\n\t\t>\n\t\t\t<BottomSheetConsumer>\n\t\t\t\t{ ( { listProps, safeAreaBottomInset } ) => (\n\t\t\t\t\t<View>\n\t\t\t\t\t\t{ showSearchForm && (\n\t\t\t\t\t\t\t<InserterSearchForm\n\t\t\t\t\t\t\t\tonChange={ ( value ) => {\n\t\t\t\t\t\t\t\t\tsetFilterValue( value );\n\t\t\t\t\t\t\t\t} }\n\t\t\t\t\t\t\t\tvalue={ filterValue }\n\t\t\t\t\t\t\t\tonLayout={ ( event ) => {\n\t\t\t\t\t\t\t\t\tconst { height } = event.nativeEvent.layout;\n\t\t\t\t\t\t\t\t\tsetSearchFormHeight( height );\n\t\t\t\t\t\t\t\t} }\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t) }\n\n\t\t\t\t\t\t<InserterSearchResults\n\t\t\t\t\t\t\titems={ getItems() }\n\t\t\t\t\t\t\tonSelect={ ( item ) => {\n\t\t\t\t\t\t\t\tonInsert( item );\n\t\t\t\t\t\t\t\tonSelect( item );\n\t\t\t\t\t\t\t} }\n\t\t\t\t\t\t\t{ ...{\n\t\t\t\t\t\t\t\tlistProps,\n\t\t\t\t\t\t\t\tsafeAreaBottomInset,\n\t\t\t\t\t\t\t\tsearchFormHeight,\n\t\t\t\t\t\t\t} }\n\t\t\t\t\t\t/>\n\t\t\t\t\t</View>\n\t\t\t\t) }\n\t\t\t</BottomSheetConsumer>\n\t\t</BottomSheet>\n\t);\n}\n\nexport default InserterMenu;\n"]}