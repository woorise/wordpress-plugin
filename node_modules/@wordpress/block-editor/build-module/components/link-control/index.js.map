{"version":3,"sources":["@wordpress/block-editor/src/components/link-control/index.js"],"names":["noop","Button","Spinner","Notice","keyboardReturn","__","useRef","useState","useEffect","focus","LinkControlSettingsDrawer","LinkControlSearchInput","LinkPreview","useCreatePage","ViewerFill","LinkControl","searchInputPlaceholder","value","settings","onChange","noDirectEntry","showSuggestions","showInitialSuggestions","forceIsEditingLink","createSuggestion","withCreateSuggestion","inputValue","propInputValue","suggestionsQuery","noURLSuggestion","createSuggestionButtonText","undefined","isMounting","wrapperNode","url","internalInputValue","setInternalInputValue","currentInputValue","isEditingLink","setIsEditingLink","isEndingEditWithFocus","current","hadFocusLoss","contains","ownerDocument","activeElement","nextFocusTarget","focusable","find","stopEditing","createPage","isCreatingPage","errorMessage","handleSelectSuggestion","updatedValue"],"mappings":";;;AAAA;AACA;AACA;AACA,SAASA,IAAT,QAAqB,QAArB;AAEA;AACA;AACA;;AACA,SAASC,MAAT,EAAiBC,OAAjB,EAA0BC,MAA1B,QAAwC,uBAAxC;AACA,SAASC,cAAT,QAA+B,kBAA/B;AACA,SAASC,EAAT,QAAmB,iBAAnB;AACA,SAASC,MAAT,EAAiBC,QAAjB,EAA2BC,SAA3B,QAA4C,oBAA5C;AACA,SAASC,KAAT,QAAsB,gBAAtB;AAEA;AACA;AACA;;AACA,OAAOC,yBAAP,MAAsC,mBAAtC;AACA,OAAOC,sBAAP,MAAmC,gBAAnC;AACA,OAAOC,WAAP,MAAwB,gBAAxB;AACA,OAAOC,aAAP,MAA0B,mBAA1B;AACA,SAASC,UAAT,QAA2B,eAA3B;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AACA;AACA;AACA;AACA;AACA;;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AACA,SAASC,WAAT,OAeI;AAAA,MAdHC,sBAcG,QAdHA,sBAcG;AAAA,MAbHC,KAaG,QAbHA,KAaG;AAAA,MAZHC,QAYG,QAZHA,QAYG;AAAA,2BAXHC,QAWG;AAAA,MAXHA,QAWG,8BAXQnB,IAWR;AAAA,gCAVHoB,aAUG;AAAA,MAVHA,aAUG,mCAVa,KAUb;AAAA,kCATHC,eASG;AAAA,MATHA,eASG,qCATe,IASf;AAAA,MARHC,sBAQG,QARHA,sBAQG;AAAA,MAPHC,kBAOG,QAPHA,kBAOG;AAAA,MANHC,gBAMG,QANHA,gBAMG;AAAA,MALHC,oBAKG,QALHA,oBAKG;AAAA,6BAJHC,UAIG;AAAA,MAJSC,cAIT,gCAJ0B,EAI1B;AAAA,mCAHHC,gBAGG;AAAA,MAHHA,gBAGG,sCAHgB,EAGhB;AAAA,kCAFHC,eAEG;AAAA,MAFHA,eAEG,qCAFe,KAEf;AAAA,MADHC,0BACG,QADHA,0BACG;;AACH,MAAKL,oBAAoB,KAAKM,SAAzB,IAAsCP,gBAA3C,EAA8D;AAC7DC,IAAAA,oBAAoB,GAAG,IAAvB;AACA;;AAED,MAAMO,UAAU,GAAG1B,MAAM,CAAE,IAAF,CAAzB;AACA,MAAM2B,WAAW,GAAG3B,MAAM,EAA1B;;AANG,kBAOmDC,QAAQ,CAC3DU,KAAK,IAAIA,KAAK,CAACiB,GAAjB,IAA0B,EADmC,CAP3D;AAAA;AAAA,MAOKC,kBAPL;AAAA,MAOyBC,qBAPzB;;AAUH,MAAMC,iBAAiB,GAAGV,cAAc,IAAIQ,kBAA5C;;AAVG,mBAWyC5B,QAAQ,CACnDgB,kBAAkB,KAAKQ,SAAvB,GACGR,kBADH,GAEG,CAAEN,KAAF,IAAW,CAAEA,KAAK,CAACiB,GAH6B,CAXjD;AAAA;AAAA,MAWKI,aAXL;AAAA,MAWoBC,gBAXpB;;AAgBH,MAAMC,qBAAqB,GAAGlC,MAAM,CAAE,KAAF,CAApC;AAEAE,EAAAA,SAAS,CAAE,YAAM;AAChB,QACCe,kBAAkB,KAAKQ,SAAvB,IACAR,kBAAkB,KAAKe,aAFxB,EAGE;AACDC,MAAAA,gBAAgB,CAAEhB,kBAAF,CAAhB;AACA;AACD,GAPQ,EAON,CAAEA,kBAAF,CAPM,CAAT;AASAf,EAAAA,SAAS,CAAE,YAAM;AAChB,QAAKwB,UAAU,CAACS,OAAhB,EAA0B;AACzBT,MAAAA,UAAU,CAACS,OAAX,GAAqB,KAArB;AACA;AACA,KAJe,CAKhB;AACA;AACA;AACA;AACA;AACA;AACA;;;AACA,QAAMC,YAAY,GAAG,CAAET,WAAW,CAACQ,OAAZ,CAAoBE,QAApB,CACtBV,WAAW,CAACQ,OAAZ,CAAoBG,aAApB,CAAkCC,aADZ,CAAvB;;AAIA,QAAKH,YAAL,EAAoB;AACnB;AACA;AACA,UAAMI,eAAe,GACpBrC,KAAK,CAACsC,SAAN,CAAgBC,IAAhB,CAAsBf,WAAW,CAACQ,OAAlC,EAA6C,CAA7C,KACAR,WAAW,CAACQ,OAFb;AAIAK,MAAAA,eAAe,CAACrC,KAAhB;AACA;;AAED+B,IAAAA,qBAAqB,CAACC,OAAtB,GAAgC,KAAhC;AACA,GA3BQ,EA2BN,CAAEH,aAAF,CA3BM,CAAT;AA6BA;AACD;AACA;AACA;;AACC,WAASW,WAAT,GAAuB;AAAA;;AACtBT,IAAAA,qBAAqB,CAACC,OAAtB,GAAgC,CAAC,0BAAER,WAAW,CAACQ,OAAd,iDAAE,qBAAqBE,QAArB,CAClCV,WAAW,CAACQ,OAAZ,CAAoBG,aAApB,CAAkCC,aADA,CAAF,CAAjC;AAIAN,IAAAA,gBAAgB,CAAE,KAAF,CAAhB;AACA;;AAlEE,uBAoEkD1B,aAAa,CACjEW,gBADiE,CApE/D;AAAA,MAoEK0B,UApEL,kBAoEKA,UApEL;AAAA,MAoEiBC,cApEjB,kBAoEiBA,cApEjB;AAAA,MAoEiCC,YApEjC,kBAoEiCA,YApEjC;;AAwEH,MAAMC,sBAAsB,GAAG,SAAzBA,sBAAyB,CAAEC,YAAF,EAAoB;AAClDnC,IAAAA,QAAQ,CAAEmC,YAAF,CAAR;AACAL,IAAAA,WAAW;AACX,GAHD;;AAKA,SACC;AACC,IAAA,QAAQ,EAAG,CAAC,CADb;AAEC,IAAA,GAAG,EAAGhB,WAFP;AAGC,IAAA,SAAS,EAAC;AAHX,KAKGkB,cAAc,IACf;AAAK,IAAA,SAAS,EAAC;AAAf,KACC,cAAC,OAAD,OADD,OACe9C,EAAE,CAAE,UAAF,CADjB,WANF,EAWG,CAAEiC,aAAa,IAAI,CAAErB,KAArB,KAAgC,CAAEkC,cAAlC,IACD,8BACC;AAAK,IAAA,SAAS,EAAC;AAAf,KACC,cAAC,sBAAD;AACC,IAAA,WAAW,EAAGlC,KADf;AAEC,IAAA,SAAS,EAAC,yCAFX;AAGC,IAAA,WAAW,EAAGD,sBAHf;AAIC,IAAA,KAAK,EAAGqB,iBAJT;AAKC,IAAA,oBAAoB,EAAGZ,oBALxB;AAMC,IAAA,kBAAkB,EAAGyB,UANtB;AAOC,IAAA,QAAQ,EAAGd,qBAPZ;AAQC,IAAA,QAAQ,EAAGiB,sBARZ;AASC,IAAA,sBAAsB,EAAG/B,sBAT1B;AAUC,IAAA,gBAAgB,EAAG,CAAEF,aAVtB;AAWC,IAAA,eAAe,EAAGC,eAXnB;AAYC,IAAA,gBAAgB,EAAGO,gBAZpB;AAaC,IAAA,iBAAiB,EAAG,CAAEC,eAbvB;AAcC,IAAA,0BAA0B,EACzBC;AAfF,KAkBC;AAAK,IAAA,SAAS,EAAC;AAAf,KACC,cAAC,MAAD;AACC,IAAA,IAAI,EAAC,QADN;AAEC,IAAA,KAAK,EAAGzB,EAAE,CAAE,QAAF,CAFX;AAGC,IAAA,IAAI,EAAGD,cAHR;AAIC,IAAA,SAAS,EAAC;AAJX,IADD,CAlBD,CADD,CADD,EA8BGgD,YAAY,IACb,cAAC,MAAD;AACC,IAAA,SAAS,EAAC,yCADX;AAEC,IAAA,MAAM,EAAC,OAFR;AAGC,IAAA,aAAa,EAAG;AAHjB,KAKGA,YALH,CA/BF,CAZF,EAsDGnC,KAAK,IAAI,CAAEqB,aAAX,IAA4B,CAAEa,cAA9B,IACD,cAAC,WAAD;AACC,IAAA,KAAK,EAAGlC,KADT;AAEC,IAAA,WAAW,EAAG;AAAA,aAAMsB,gBAAgB,CAAE,IAAF,CAAtB;AAAA;AAFf,IAvDF,EA6DC,cAAC,yBAAD;AACC,IAAA,KAAK,EAAGtB,KADT;AAEC,IAAA,QAAQ,EAAGC,QAFZ;AAGC,IAAA,QAAQ,EAAGC;AAHZ,IA7DD,CADD;AAqEA;;AAEDJ,WAAW,CAACD,UAAZ,GAAyBA,UAAzB;AAEA,eAAeC,WAAf","sourcesContent":["/**\n * External dependencies\n */\nimport { noop } from 'lodash';\n\n/**\n * WordPress dependencies\n */\nimport { Button, Spinner, Notice } from '@wordpress/components';\nimport { keyboardReturn } from '@wordpress/icons';\nimport { __ } from '@wordpress/i18n';\nimport { useRef, useState, useEffect } from '@wordpress/element';\nimport { focus } from '@wordpress/dom';\n\n/**\n * Internal dependencies\n */\nimport LinkControlSettingsDrawer from './settings-drawer';\nimport LinkControlSearchInput from './search-input';\nimport LinkPreview from './link-preview';\nimport useCreatePage from './use-create-page';\nimport { ViewerFill } from './viewer-slot';\n\n/**\n * Default properties associated with a link control value.\n *\n * @typedef WPLinkControlDefaultValue\n *\n * @property {string}   url           Link URL.\n * @property {string=}  title         Link title.\n * @property {boolean=} opensInNewTab Whether link should open in a new browser\n *                                    tab. This value is only assigned if not\n *                                    providing a custom `settings` prop.\n */\n\n/* eslint-disable jsdoc/valid-types */\n/**\n * Custom settings values associated with a link.\n *\n * @typedef {{[setting:string]:any}} WPLinkControlSettingsValue\n */\n/* eslint-enable */\n\n/**\n * Custom settings values associated with a link.\n *\n * @typedef WPLinkControlSetting\n *\n * @property {string} id    Identifier to use as property for setting value.\n * @property {string} title Human-readable label to show in user interface.\n */\n\n/**\n * Properties associated with a link control value, composed as a union of the\n * default properties and any custom settings values.\n *\n * @typedef {WPLinkControlDefaultValue&WPLinkControlSettingsValue} WPLinkControlValue\n */\n\n/** @typedef {(nextValue:WPLinkControlValue)=>void} WPLinkControlOnChangeProp */\n\n/**\n * Properties associated with a search suggestion used within the LinkControl.\n *\n * @typedef WPLinkControlSuggestion\n *\n * @property {string} id    Identifier to use to uniquely identify the suggestion.\n * @property {string} type  Identifies the type of the suggestion (eg: `post`,\n *                          `page`, `url`...etc)\n * @property {string} title Human-readable label to show in user interface.\n * @property {string} url   A URL for the suggestion.\n */\n\n/** @typedef {(title:string)=>WPLinkControlSuggestion} WPLinkControlCreateSuggestionProp */\n\n/**\n * @typedef WPLinkControlProps\n *\n * @property {(WPLinkControlSetting[])=}  settings                   An array of settings objects. Each object will used to\n *                                                                   render a `ToggleControl` for that setting.\n * @property {boolean=}                   forceIsEditingLink         If passed as either `true` or `false`, controls the\n *                                                                   internal editing state of the component to respective\n *                                                                   show or not show the URL input field.\n * @property {WPLinkControlValue=}        value                      Current link value.\n * @property {WPLinkControlOnChangeProp=} onChange                   Value change handler, called with the updated value if\n *                                                                   the user selects a new link or updates settings.\n * @property {boolean=}                   noDirectEntry              Whether to allow turning a URL-like search query directly into a link.\n * @property {boolean=}                   showSuggestions            Whether to present suggestions when typing the URL.\n * @property {boolean=}                   showInitialSuggestions     Whether to present initial suggestions immediately.\n * @property {boolean=}                   withCreateSuggestion       Whether to allow creation of link value from suggestion.\n * @property {Object=}                    suggestionsQuery           Query parameters to pass along to wp.blockEditor.__experimentalFetchLinkSuggestions.\n * @property {boolean=}                   noURLSuggestion            Whether to add a fallback suggestion which treats the search query as a URL.\n * @property {string|Function|undefined}  createSuggestionButtonText The text to use in the button that calls createSuggestion.\n */\n\n/**\n * Renders a link control. A link control is a controlled input which maintains\n * a value associated with a link (HTML anchor element) and relevant settings\n * for how that link is expected to behave.\n *\n * @param {WPLinkControlProps} props Component props.\n */\nfunction LinkControl( {\n\tsearchInputPlaceholder,\n\tvalue,\n\tsettings,\n\tonChange = noop,\n\tnoDirectEntry = false,\n\tshowSuggestions = true,\n\tshowInitialSuggestions,\n\tforceIsEditingLink,\n\tcreateSuggestion,\n\twithCreateSuggestion,\n\tinputValue: propInputValue = '',\n\tsuggestionsQuery = {},\n\tnoURLSuggestion = false,\n\tcreateSuggestionButtonText,\n} ) {\n\tif ( withCreateSuggestion === undefined && createSuggestion ) {\n\t\twithCreateSuggestion = true;\n\t}\n\n\tconst isMounting = useRef( true );\n\tconst wrapperNode = useRef();\n\tconst [ internalInputValue, setInternalInputValue ] = useState(\n\t\t( value && value.url ) || ''\n\t);\n\tconst currentInputValue = propInputValue || internalInputValue;\n\tconst [ isEditingLink, setIsEditingLink ] = useState(\n\t\tforceIsEditingLink !== undefined\n\t\t\t? forceIsEditingLink\n\t\t\t: ! value || ! value.url\n\t);\n\tconst isEndingEditWithFocus = useRef( false );\n\n\tuseEffect( () => {\n\t\tif (\n\t\t\tforceIsEditingLink !== undefined &&\n\t\t\tforceIsEditingLink !== isEditingLink\n\t\t) {\n\t\t\tsetIsEditingLink( forceIsEditingLink );\n\t\t}\n\t}, [ forceIsEditingLink ] );\n\n\tuseEffect( () => {\n\t\tif ( isMounting.current ) {\n\t\t\tisMounting.current = false;\n\t\t\treturn;\n\t\t}\n\t\t// When `isEditingLink` changes, a focus loss could occur\n\t\t// since the link input may be removed from the DOM. To avoid this,\n\t\t// reinstate focus to a suitable target if focus has in-fact been lost.\n\t\t// Note that the check is necessary because while typically unsetting\n\t\t// edit mode would render the read-only mode's link element, it isn't\n\t\t// guaranteed. The link input may continue to be shown if the next value\n\t\t// is still unassigned after calling `onChange`.\n\t\tconst hadFocusLoss = ! wrapperNode.current.contains(\n\t\t\twrapperNode.current.ownerDocument.activeElement\n\t\t);\n\n\t\tif ( hadFocusLoss ) {\n\t\t\t// Prefer to focus a natural focusable descendent of the wrapper,\n\t\t\t// but settle for the wrapper if there are no other options.\n\t\t\tconst nextFocusTarget =\n\t\t\t\tfocus.focusable.find( wrapperNode.current )[ 0 ] ||\n\t\t\t\twrapperNode.current;\n\n\t\t\tnextFocusTarget.focus();\n\t\t}\n\n\t\tisEndingEditWithFocus.current = false;\n\t}, [ isEditingLink ] );\n\n\t/**\n\t * Cancels editing state and marks that focus may need to be restored after\n\t * the next render, if focus was within the wrapper when editing finished.\n\t */\n\tfunction stopEditing() {\n\t\tisEndingEditWithFocus.current = !! wrapperNode.current?.contains(\n\t\t\twrapperNode.current.ownerDocument.activeElement\n\t\t);\n\n\t\tsetIsEditingLink( false );\n\t}\n\n\tconst { createPage, isCreatingPage, errorMessage } = useCreatePage(\n\t\tcreateSuggestion\n\t);\n\n\tconst handleSelectSuggestion = ( updatedValue ) => {\n\t\tonChange( updatedValue );\n\t\tstopEditing();\n\t};\n\n\treturn (\n\t\t<div\n\t\t\ttabIndex={ -1 }\n\t\t\tref={ wrapperNode }\n\t\t\tclassName=\"block-editor-link-control\"\n\t\t>\n\t\t\t{ isCreatingPage && (\n\t\t\t\t<div className=\"block-editor-link-control__loading\">\n\t\t\t\t\t<Spinner /> { __( 'Creating' ) }…\n\t\t\t\t</div>\n\t\t\t) }\n\n\t\t\t{ ( isEditingLink || ! value ) && ! isCreatingPage && (\n\t\t\t\t<>\n\t\t\t\t\t<div className=\"block-editor-link-control__search-input-wrapper\">\n\t\t\t\t\t\t<LinkControlSearchInput\n\t\t\t\t\t\t\tcurrentLink={ value }\n\t\t\t\t\t\t\tclassName=\"block-editor-link-control__search-input\"\n\t\t\t\t\t\t\tplaceholder={ searchInputPlaceholder }\n\t\t\t\t\t\t\tvalue={ currentInputValue }\n\t\t\t\t\t\t\twithCreateSuggestion={ withCreateSuggestion }\n\t\t\t\t\t\t\tonCreateSuggestion={ createPage }\n\t\t\t\t\t\t\tonChange={ setInternalInputValue }\n\t\t\t\t\t\t\tonSelect={ handleSelectSuggestion }\n\t\t\t\t\t\t\tshowInitialSuggestions={ showInitialSuggestions }\n\t\t\t\t\t\t\tallowDirectEntry={ ! noDirectEntry }\n\t\t\t\t\t\t\tshowSuggestions={ showSuggestions }\n\t\t\t\t\t\t\tsuggestionsQuery={ suggestionsQuery }\n\t\t\t\t\t\t\twithURLSuggestion={ ! noURLSuggestion }\n\t\t\t\t\t\t\tcreateSuggestionButtonText={\n\t\t\t\t\t\t\t\tcreateSuggestionButtonText\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<div className=\"block-editor-link-control__search-actions\">\n\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\ttype=\"submit\"\n\t\t\t\t\t\t\t\t\tlabel={ __( 'Submit' ) }\n\t\t\t\t\t\t\t\t\ticon={ keyboardReturn }\n\t\t\t\t\t\t\t\t\tclassName=\"block-editor-link-control__search-submit\"\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</LinkControlSearchInput>\n\t\t\t\t\t</div>\n\t\t\t\t\t{ errorMessage && (\n\t\t\t\t\t\t<Notice\n\t\t\t\t\t\t\tclassName=\"block-editor-link-control__search-error\"\n\t\t\t\t\t\t\tstatus=\"error\"\n\t\t\t\t\t\t\tisDismissible={ false }\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t{ errorMessage }\n\t\t\t\t\t\t</Notice>\n\t\t\t\t\t) }\n\t\t\t\t</>\n\t\t\t) }\n\n\t\t\t{ value && ! isEditingLink && ! isCreatingPage && (\n\t\t\t\t<LinkPreview\n\t\t\t\t\tvalue={ value }\n\t\t\t\t\tonEditClick={ () => setIsEditingLink( true ) }\n\t\t\t\t/>\n\t\t\t) }\n\n\t\t\t<LinkControlSettingsDrawer\n\t\t\t\tvalue={ value }\n\t\t\t\tsettings={ settings }\n\t\t\t\tonChange={ onChange }\n\t\t\t/>\n\t\t</div>\n\t);\n}\n\nLinkControl.ViewerFill = ViewerFill;\n\nexport default LinkControl;\n"]}