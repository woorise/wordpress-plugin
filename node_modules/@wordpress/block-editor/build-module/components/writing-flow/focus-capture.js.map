{"version":3,"sources":["@wordpress/block-editor/src/components/writing-flow/focus-capture.js"],"names":["first","last","forwardRef","focus","useSelect","useDispatch","store","blockEditorStore","FocusCapture","ref","selectedClientId","isReverse","containerRef","noCapture","lastFocus","hasMultiSelection","multiSelectionContainer","isNavigationMode","select","setNavigationMode","onFocus","current","tabbables","tabbable","find","length","undefined","position"],"mappings":";;AAAA;AACA;AACA;AACA,SAASA,KAAT,EAAgBC,IAAhB,QAA4B,QAA5B;AAEA;AACA;AACA;;AACA,SAASC,UAAT,QAA2B,oBAA3B;AACA,SAASC,KAAT,QAAsB,gBAAtB;AACA,SAASC,SAAT,EAAoBC,WAApB,QAAuC,iBAAvC;AAEA;AACA;AACA;;AACA,SAASC,KAAK,IAAIC,gBAAlB,QAA0C,aAA1C;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AACA,IAAMC,YAAY,GAAGN,UAAU,CAC9B,gBAUCO,GAVD,EAWK;AAAA,MATHC,gBASG,QATHA,gBASG;AAAA,MARHC,SAQG,QARHA,SAQG;AAAA,MAPHC,YAOG,QAPHA,YAOG;AAAA,MANHC,SAMG,QANHA,SAMG;AAAA,MALHC,SAKG,QALHA,SAKG;AAAA,MAJHC,iBAIG,QAJHA,iBAIG;AAAA,MAHHC,uBAGG,QAHHA,uBAGG;AACJ,MAAMC,gBAAgB,GAAGb,SAAS,CAAE,UAAEc,MAAF;AAAA,WACnCA,MAAM,CAAEX,gBAAF,CAAN,CAA2BU,gBAA3B,EADmC;AAAA,GAAF,CAAlC;;AADI,qBAI0BZ,WAAW,CAAEE,gBAAF,CAJrC;AAAA,MAIIY,iBAJJ,gBAIIA,iBAJJ;;AAMJ,WAASC,OAAT,GAAmB;AAClB;AACA,QAAKP,SAAS,CAACQ,OAAf,EAAyB;AACxBR,MAAAA,SAAS,CAACQ,OAAV,GAAoB,IAApB;AACA;AACA,KALiB,CAOlB;AACA;AACA;;;AACA,QAAK,CAAEX,gBAAP,EAA0B;AACzB,UAAKK,iBAAL,EAAyB;AACxBC,QAAAA,uBAAuB,CAACK,OAAxB,CAAgClB,KAAhC;AACA;AACA;;AAEDgB,MAAAA,iBAAiB,CAAE,IAAF,CAAjB;AAEA,UAAMG,SAAS,GAAGnB,KAAK,CAACoB,QAAN,CAAeC,IAAf,CAAqBZ,YAAY,CAACS,OAAlC,CAAlB;;AAEA,UAAKC,SAAS,CAACG,MAAf,EAAwB;AACvB,YAAKd,SAAL,EAAiB;AAChBV,UAAAA,IAAI,CAAEqB,SAAF,CAAJ,CAAkBnB,KAAlB;AACA,SAFD,MAEO;AACNH,UAAAA,KAAK,CAAEsB,SAAF,CAAL,CAAmBnB,KAAnB;AACA;AACD;;AAED;AACA;;AAEDW,IAAAA,SAAS,CAACO,OAAV,CAAkBlB,KAAlB;AACA;;AAED,SACC;AACC,IAAA,GAAG,EAAGM,GADP,CAEC;AAFD;AAGC,IAAA,QAAQ,EAAG,CAAEQ,gBAAF,GAAqB,GAArB,GAA2BS,SAHvC;AAIC,IAAA,OAAO,EAAGN,OAJX,CAKC;AACA;AAND;AAOC,IAAA,KAAK,EAAG;AAAEO,MAAAA,QAAQ,EAAE;AAAZ;AAPT,IADD;AAWA,CA/D6B,CAA/B;AAkEA,eAAenB,YAAf","sourcesContent":["/**\n * External dependencies\n */\nimport { first, last } from 'lodash';\n\n/**\n * WordPress dependencies\n */\nimport { forwardRef } from '@wordpress/element';\nimport { focus } from '@wordpress/dom';\nimport { useSelect, useDispatch } from '@wordpress/data';\n\n/**\n * Internal dependencies\n */\nimport { store as blockEditorStore } from '../../store';\n\n/**\n * Renders focus capturing areas to redirect focus to the selected block if not\n * in Navigation mode.\n *\n * @param {string}  selectedClientId Client ID of the selected block.\n * @param {boolean} isReverse        Set to true if the component is rendered\n *                                   after the block list, false if rendered\n *                                   before.\n * @param {Object}  containerRef     Reference containing the element reference\n *                                   of the block list container.\n * @param {boolean} noCapture        Reference containing the flag for enabling\n *                                   or disabling capturing.\n *\n * @return {WPElement} The focus capture element.\n */\nconst FocusCapture = forwardRef(\n\t(\n\t\t{\n\t\t\tselectedClientId,\n\t\t\tisReverse,\n\t\t\tcontainerRef,\n\t\t\tnoCapture,\n\t\t\tlastFocus,\n\t\t\thasMultiSelection,\n\t\t\tmultiSelectionContainer,\n\t\t},\n\t\tref\n\t) => {\n\t\tconst isNavigationMode = useSelect( ( select ) =>\n\t\t\tselect( blockEditorStore ).isNavigationMode()\n\t\t);\n\t\tconst { setNavigationMode } = useDispatch( blockEditorStore );\n\n\t\tfunction onFocus() {\n\t\t\t// Do not capture incoming focus if set by us in WritingFlow.\n\t\t\tif ( noCapture.current ) {\n\t\t\t\tnoCapture.current = null;\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// When focus coming in from out of the block list, and no block is\n\t\t\t// selected, enable Navigation mode and select the first or last block\n\t\t\t// depending on the direction.\n\t\t\tif ( ! selectedClientId ) {\n\t\t\t\tif ( hasMultiSelection ) {\n\t\t\t\t\tmultiSelectionContainer.current.focus();\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tsetNavigationMode( true );\n\n\t\t\t\tconst tabbables = focus.tabbable.find( containerRef.current );\n\n\t\t\t\tif ( tabbables.length ) {\n\t\t\t\t\tif ( isReverse ) {\n\t\t\t\t\t\tlast( tabbables ).focus();\n\t\t\t\t\t} else {\n\t\t\t\t\t\tfirst( tabbables ).focus();\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tlastFocus.current.focus();\n\t\t}\n\n\t\treturn (\n\t\t\t<div\n\t\t\t\tref={ ref }\n\t\t\t\t// Don't allow tabbing to this element in Navigation mode.\n\t\t\t\ttabIndex={ ! isNavigationMode ? '0' : undefined }\n\t\t\t\tonFocus={ onFocus }\n\t\t\t\t// Needs to be positioned within the viewport, so focus to this\n\t\t\t\t// element does not scroll the page.\n\t\t\t\tstyle={ { position: 'fixed' } }\n\t\t\t/>\n\t\t);\n\t}\n);\n\nexport default FocusCapture;\n"]}