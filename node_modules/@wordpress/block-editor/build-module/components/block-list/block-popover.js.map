{"version":3,"sources":["@wordpress/block-editor/src/components/block-list/block-popover.js"],"names":["find","classnames","useState","useCallback","useContext","useRef","useEffect","isUnmodifiedDefaultBlock","Popover","useDispatch","useSelect","useShortcut","useViewportMatch","getScrollContainer","BlockSelectionButton","BlockContextualToolbar","Inserter","BlockNodes","getBlockDOMNode","store","blockEditorStore","selector","select","isNavigationMode","isMultiSelecting","hasMultiSelection","isTyping","isCaretWithinFormattedText","getSettings","getLastMultiSelectedBlockClientId","hasFixedToolbar","lastClientId","BlockPopover","clientId","rootClientId","isValid","isEmptyDefaultBlock","capturingClientId","isLargeViewport","isToolbarForced","setIsToolbarForced","isInserterShown","setIsInserterShown","blockNodes","stopTyping","showEmptyBlockSideInserter","shouldShowBreadcrumb","shouldShowContextualToolbar","canFocusHiddenToolbar","bindGlobal","eventName","isDisabled","initialToolbarItemIndexRef","current","undefined","node","ownerDocument","anchorRef","bottomNode","top","bottom","onFocus","onBlur","popoverPosition","stickyBoundaryElement","defaultView","frameElement","body","index","wrapperSelector","getSelectedBlockClientId","getFirstMultiSelectedBlockClientId","getBlockRootClientId","__unstableGetBlockWithoutInnerBlocks","getBlockParents","__experimentalGetBlockListSettingsForBlocks","name","attributes","blockParentsClientIds","parentBlockListSettings","parentClientId","__experimentalCaptureToolbars","WrappedBlockPopover","selected"],"mappings":";;;AAAA;AACA;AACA;AACA,SAASA,IAAT,QAAqB,QAArB;AACA,OAAOC,UAAP,MAAuB,YAAvB;AAEA;AACA;AACA;;AACA,SACCC,QADD,EAECC,WAFD,EAGCC,UAHD,EAICC,MAJD,EAKCC,SALD,QAMO,oBANP;AAOA,SAASC,wBAAT,QAAyC,mBAAzC;AACA,SAASC,OAAT,QAAwB,uBAAxB;AACA,SAASC,WAAT,EAAsBC,SAAtB,QAAuC,iBAAvC;AACA,SAASC,WAAT,QAA4B,+BAA5B;AACA,SAASC,gBAAT,QAAiC,oBAAjC;AACA,SAASC,kBAAT,QAAmC,gBAAnC;AAEA;AACA;AACA;;AACA,OAAOC,oBAAP,MAAiC,0BAAjC;AACA,OAAOC,sBAAP,MAAmC,4BAAnC;AACA,OAAOC,QAAP,MAAqB,aAArB;AACA,SAASC,UAAT,QAA2B,IAA3B;AACA,SAASC,eAAT,QAAgC,iBAAhC;AACA,SAASC,KAAK,IAAIC,gBAAlB,QAA0C,aAA1C;;AAEA,SAASC,QAAT,CAAmBC,MAAnB,EAA4B;AAAA,gBASvBA,MAAM,CAAEF,gBAAF,CATiB;AAAA,MAE1BG,gBAF0B,WAE1BA,gBAF0B;AAAA,MAG1BC,gBAH0B,WAG1BA,gBAH0B;AAAA,MAI1BC,iBAJ0B,WAI1BA,iBAJ0B;AAAA,MAK1BC,QAL0B,WAK1BA,QAL0B;AAAA,MAM1BC,0BAN0B,WAM1BA,0BAN0B;AAAA,MAO1BC,WAP0B,WAO1BA,WAP0B;AAAA,MAQ1BC,iCAR0B,WAQ1BA,iCAR0B;;AAU3B,SAAO;AACNN,IAAAA,gBAAgB,EAAEA,gBAAgB,EAD5B;AAENC,IAAAA,gBAAgB,EAAEA,gBAAgB,EAF5B;AAGNE,IAAAA,QAAQ,EAAEA,QAAQ,EAHZ;AAINC,IAAAA,0BAA0B,EAAEA,0BAA0B,EAJhD;AAKNF,IAAAA,iBAAiB,EAAEA,iBAAiB,EAL9B;AAMNK,IAAAA,eAAe,EAAEF,WAAW,GAAGE,eANzB;AAONC,IAAAA,YAAY,EAAEF,iCAAiC;AAPzC,GAAP;AASA;;AAED,SAASG,YAAT,OAMI;AAAA,MALHC,QAKG,QALHA,QAKG;AAAA,MAJHC,YAIG,QAJHA,YAIG;AAAA,MAHHC,OAGG,QAHHA,OAGG;AAAA,MAFHC,mBAEG,QAFHA,mBAEG;AAAA,MADHC,iBACG,QADHA,iBACG;;AAAA,mBASC3B,SAAS,CAAEW,QAAF,EAAY,EAAZ,CATV;AAAA,MAEFE,gBAFE,cAEFA,gBAFE;AAAA,MAGFC,gBAHE,cAGFA,gBAHE;AAAA,MAIFE,QAJE,cAIFA,QAJE;AAAA,MAKFC,0BALE,cAKFA,0BALE;AAAA,MAMFF,iBANE,cAMFA,iBANE;AAAA,MAOFK,eAPE,cAOFA,eAPE;AAAA,MAQFC,YARE,cAQFA,YARE;;AAUH,MAAMO,eAAe,GAAG1B,gBAAgB,CAAE,QAAF,CAAxC;;AAVG,kBAW6CV,QAAQ,CAAE,KAAF,CAXrD;AAAA;AAAA,MAWKqC,eAXL;AAAA,MAWsBC,kBAXtB;;AAAA,mBAY6CtC,QAAQ,CAAE,KAAF,CAZrD;AAAA;AAAA,MAYKuC,eAZL;AAAA,MAYsBC,kBAZtB;;AAaH,MAAMC,UAAU,GAAGvC,UAAU,CAAEa,UAAF,CAA7B;;AAbG,qBAcoBR,WAAW,CAAEW,gBAAF,CAd/B;AAAA,MAcKwB,UAdL,gBAcKA,UAdL,EAgBH;AACA;;;AACA,MAAMC,0BAA0B,GAC/B,CAAEnB,QAAF,IAAc,CAAEH,gBAAhB,IAAoCa,mBAApC,IAA2DD,OAD5D;AAEA,MAAMW,oBAAoB,GAAGvB,gBAA7B;AACA,MAAMwB,2BAA2B,GAChC,CAAExB,gBAAF,IACA,CAAEO,eADF,IAEAQ,eAFA,IAGA,CAAEO,0BAHF,IAIA,CAAErB,gBAJF,KAKE,CAAEE,QAAF,IAAcC,0BALhB,CADD;AAOA,MAAMqB,qBAAqB,GAC1B,CAAEzB,gBAAF,IACA,CAAEwB,2BADF,IAEA,CAAEjB,eAFF,IAGA,CAAEM,mBAJH;AAMAzB,EAAAA,WAAW,CACV,iCADU,EAEVR,WAAW,CAAE,YAAM;AAClBqC,IAAAA,kBAAkB,CAAE,IAAF,CAAlB;AACAI,IAAAA,UAAU,CAAE,IAAF,CAAV;AACA,GAHU,EAGR,EAHQ,CAFD,EAMV;AACCK,IAAAA,UAAU,EAAE,IADb;AAECC,IAAAA,SAAS,EAAE,SAFZ;AAGCC,IAAAA,UAAU,EAAE,CAAEH;AAHf,GANU,CAAX;AAaA1C,EAAAA,SAAS,CAAE,YAAM;AAChB,QAAK,CAAEyC,2BAAP,EAAqC;AACpCP,MAAAA,kBAAkB,CAAE,KAAF,CAAlB;AACA;AACD,GAJQ,EAIN,CAAEO,2BAAF,CAJM,CAAT,CA/CG,CAqDH;AACA;;AACA,MAAMK,0BAA0B,GAAG/C,MAAM,EAAzC;AAEAC,EAAAA,SAAS,CAAE,YAAM;AAChB;AACA;AACA8C,IAAAA,0BAA0B,CAACC,OAA3B,GAAqCC,SAArC;AACA,GAJQ,EAIN,CAAErB,QAAF,CAJM,CAAT;;AAMA,MACC,CAAEa,oBAAF,IACA,CAAEC,2BADF,IAEA,CAAER,eAFF,IAGA,CAAEM,0BAJH,EAKE;AACD,WAAO,IAAP;AACA;;AAED,MAAIU,IAAI,GAAGZ,UAAU,CAAEV,QAAF,CAArB;;AAEA,MAAK,CAAEsB,IAAP,EAAc;AACb,WAAO,IAAP;AACA;;AA5EE,cA8EuBA,IA9EvB;AAAA,MA8EKC,aA9EL,SA8EKA,aA9EL;;AAgFH,MAAKnB,iBAAL,EAAyB;AACxBkB,IAAAA,IAAI,GAAGrC,eAAe,CAAEmB,iBAAF,EAAqBmB,aAArB,CAAtB;AACA;;AAED,MAAIC,SAAS,GAAGF,IAAhB;;AAEA,MAAK9B,iBAAL,EAAyB;AACxB,QAAMiC,UAAU,GAAGf,UAAU,CAAEZ,YAAF,CAA7B,CADwB,CAGxB;AACA;;AACA,QAAK,CAAE2B,UAAP,EAAoB;AACnB,aAAO,IAAP;AACA;;AAEDD,IAAAA,SAAS,GAAG;AACXE,MAAAA,GAAG,EAAEJ,IADM;AAEXK,MAAAA,MAAM,EAAEF;AAFG,KAAZ;AAIA;;AAED,WAASG,OAAT,GAAmB;AAClBnB,IAAAA,kBAAkB,CAAE,IAAF,CAAlB;AACA;;AAED,WAASoB,MAAT,GAAkB;AACjBpB,IAAAA,kBAAkB,CAAE,KAAF,CAAlB;AACA,GA3GE,CA6GH;AACA;AACA;AACA;;;AACA,MAAMqB,eAAe,GAAGlB,0BAA0B,GAC/C,gBAD+C,GAE/C,gBAFH;AAGA,MAAMmB,qBAAqB,GAAGnB,0BAA0B,GACrDS,SADqD,GAErD;AACA;AACA;AACA;AACAE,EAAAA,aAAa,CAACS,WAAd,CAA0BC,YAA1B,IACArD,kBAAkB,CAAE0C,IAAF,CADlB,IAEAC,aAAa,CAACW,IARjB;AAUA,SACC,cAAC,OAAD;AACC,IAAA,OAAO,MADR;AAEC,IAAA,OAAO,EAAG,KAFX;AAGC,IAAA,QAAQ,EAAGJ,eAHZ;AAIC,IAAA,YAAY,EAAG,KAJhB;AAKC,IAAA,SAAS,EAAGN,SALb;AAMC,IAAA,SAAS,EAAC,wCANX;AAOC,IAAA,+BAA+B,EAAGO,qBAPnC;AAQC,IAAA,kBAAkB,EAAC,eARpB;AASC,IAAA,wBAAwB,MATzB,CAUC;AAVD;AAWC,IAAA,wBAAwB,EAAGT,IAX5B;AAYC,IAAA,0BAA0B;AAZ3B,KAcG,CAAER,2BAA2B,IAAIR,eAAjC,KACD;AACC,IAAA,OAAO,EAAGsB,OADX;AAEC,IAAA,MAAM,EAAGC,MAFV,CAGC;AACA;AACA;AACA;AACA;AACA;AARD;AASC,IAAA,QAAQ,EAAG,CAAC,CATb;AAUC,IAAA,SAAS,EAAG7D,UAAU,CACrB,iDADqB,EAErB;AACC,oBAAcwC;AADf,KAFqB;AAVvB,KAiBC,cAAC,QAAD;AACC,IAAA,QAAQ,EAAGR,QADZ;AAEC,IAAA,YAAY,EAAGC,YAFhB;AAGC,IAAA,qBAAqB;AAHtB,IAjBD,CAfF,EAuCG,CAAEa,2BAA2B,IAAIR,eAAjC,KACD,cAAC,sBAAD,CACC;AACA;AAFD;AAGC,IAAA,YAAY,EAAGA,eAHhB;AAIC,IAAA,0BAA0B,EACzBa,0BAA0B,CAACC,OAL7B;AAOC,IAAA,2BAA2B,EAAG,qCAAEe,KAAF,EAAa;AAC1ChB,MAAAA,0BAA0B,CAACC,OAA3B,GAAqCe,KAArC;AACA;AATF,IAxCF,EAoDGtB,oBAAoB,IACrB,cAAC,oBAAD;AACC,IAAA,QAAQ,EAAGb,QADZ;AAEC,IAAA,YAAY,EAAGC,YAFhB;AAGC,IAAA,YAAY,EAAGqB;AAHhB,IArDF,EA2DGV,0BAA0B,IAC3B;AAAK,IAAA,SAAS,EAAC;AAAf,KACC,cAAC,QAAD;AACC,IAAA,QAAQ,EAAC,cADV;AAEC,IAAA,YAAY,EAAGX,YAFhB;AAGC,IAAA,QAAQ,EAAGD,QAHZ;AAIC,IAAA,qBAAqB;AAJtB,IADD,CA5DF,CADD;AAwEA;;AAED,SAASoC,eAAT,CAA0B/C,MAA1B,EAAmC;AAAA,iBAQ9BA,MAAM,CAAEF,gBAAF,CARwB;AAAA,MAEjCkD,wBAFiC,YAEjCA,wBAFiC;AAAA,MAGjCC,kCAHiC,YAGjCA,kCAHiC;AAAA,MAIjCC,oBAJiC,YAIjCA,oBAJiC;AAAA,MAKjCC,oCALiC,YAKjCA,oCALiC;AAAA,MAMjCC,eANiC,YAMjCA,eANiC;AAAA,MAOjCC,2CAPiC,YAOjCA,2CAPiC;;AAUlC,MAAM1C,QAAQ,GACbqC,wBAAwB,MAAMC,kCAAkC,EADjE;;AAGA,MAAK,CAAEtC,QAAP,EAAkB;AACjB;AACA;;AAfiC,cAkBjCwC,oCAAoC,CAAExC,QAAF,CAApC,IAAoD,EAlBnB;AAAA,MAiB1B2C,IAjB0B,SAiB1BA,IAjB0B;AAAA,+BAiBpBC,UAjBoB;AAAA,MAiBpBA,UAjBoB,iCAiBP,EAjBO;AAAA,MAiBH1C,OAjBG,SAiBHA,OAjBG;;AAmBlC,MAAM2C,qBAAqB,GAAGJ,eAAe,CAAEzC,QAAF,CAA7C,CAnBkC,CAqBlC;;AACA,MAAM8C,uBAAuB,GAAGJ,2CAA2C,CAC1EG,qBAD0E,CAA3E,CAtBkC,CA0BlC;;;AACA,MAAMzC,iBAAiB,GAAGrC,IAAI,CAC7B8E,qBAD6B,EAE7B,UAAEE,cAAF;AAAA;;AAAA,oCACCD,uBAAuB,CAAEC,cAAF,CADxB,0DACC,sBACGC,6BAFJ;AAAA,GAF6B,CAA9B;AAOA,SAAO;AACNhD,IAAAA,QAAQ,EAARA,QADM;AAENC,IAAAA,YAAY,EAAEsC,oBAAoB,CAAEvC,QAAF,CAF5B;AAGN2C,IAAAA,IAAI,EAAJA,IAHM;AAINzC,IAAAA,OAAO,EAAPA,OAJM;AAKNC,IAAAA,mBAAmB,EAClBwC,IAAI,IAAIrE,wBAAwB,CAAE;AAAEqE,MAAAA,IAAI,EAAJA,IAAF;AAAQC,MAAAA,UAAU,EAAVA;AAAR,KAAF,CAN3B;AAONxC,IAAAA,iBAAiB,EAAjBA;AAPM,GAAP;AASA;;AAED,eAAe,SAAS6C,mBAAT,GAA+B;AAC7C,MAAMC,QAAQ,GAAGzE,SAAS,CAAE2D,eAAF,EAAmB,EAAnB,CAA1B;;AAEA,MAAK,CAAEc,QAAP,EAAkB;AACjB,WAAO,IAAP;AACA;;AAL4C,MAQ5ClD,QAR4C,GAczCkD,QAdyC,CAQ5ClD,QAR4C;AAAA,MAS5CC,YAT4C,GAczCiD,QAdyC,CAS5CjD,YAT4C;AAAA,MAU5C0C,IAV4C,GAczCO,QAdyC,CAU5CP,IAV4C;AAAA,MAW5CzC,OAX4C,GAczCgD,QAdyC,CAW5ChD,OAX4C;AAAA,MAY5CC,mBAZ4C,GAczC+C,QAdyC,CAY5C/C,mBAZ4C;AAAA,MAa5CC,iBAb4C,GAczC8C,QAdyC,CAa5C9C,iBAb4C;;AAgB7C,MAAK,CAAEuC,IAAP,EAAc;AACb,WAAO,IAAP;AACA;;AAED,SACC,cAAC,YAAD;AACC,IAAA,QAAQ,EAAG3C,QADZ;AAEC,IAAA,YAAY,EAAGC,YAFhB;AAGC,IAAA,OAAO,EAAGC,OAHX;AAIC,IAAA,mBAAmB,EAAGC,mBAJvB;AAKC,IAAA,iBAAiB,EAAGC;AALrB,IADD;AASA","sourcesContent":["/**\n * External dependencies\n */\nimport { find } from 'lodash';\nimport classnames from 'classnames';\n\n/**\n * WordPress dependencies\n */\nimport {\n\tuseState,\n\tuseCallback,\n\tuseContext,\n\tuseRef,\n\tuseEffect,\n} from '@wordpress/element';\nimport { isUnmodifiedDefaultBlock } from '@wordpress/blocks';\nimport { Popover } from '@wordpress/components';\nimport { useDispatch, useSelect } from '@wordpress/data';\nimport { useShortcut } from '@wordpress/keyboard-shortcuts';\nimport { useViewportMatch } from '@wordpress/compose';\nimport { getScrollContainer } from '@wordpress/dom';\n\n/**\n * Internal dependencies\n */\nimport BlockSelectionButton from './block-selection-button';\nimport BlockContextualToolbar from './block-contextual-toolbar';\nimport Inserter from '../inserter';\nimport { BlockNodes } from './';\nimport { getBlockDOMNode } from '../../utils/dom';\nimport { store as blockEditorStore } from '../../store';\n\nfunction selector( select ) {\n\tconst {\n\t\tisNavigationMode,\n\t\tisMultiSelecting,\n\t\thasMultiSelection,\n\t\tisTyping,\n\t\tisCaretWithinFormattedText,\n\t\tgetSettings,\n\t\tgetLastMultiSelectedBlockClientId,\n\t} = select( blockEditorStore );\n\treturn {\n\t\tisNavigationMode: isNavigationMode(),\n\t\tisMultiSelecting: isMultiSelecting(),\n\t\tisTyping: isTyping(),\n\t\tisCaretWithinFormattedText: isCaretWithinFormattedText(),\n\t\thasMultiSelection: hasMultiSelection(),\n\t\thasFixedToolbar: getSettings().hasFixedToolbar,\n\t\tlastClientId: getLastMultiSelectedBlockClientId(),\n\t};\n}\n\nfunction BlockPopover( {\n\tclientId,\n\trootClientId,\n\tisValid,\n\tisEmptyDefaultBlock,\n\tcapturingClientId,\n} ) {\n\tconst {\n\t\tisNavigationMode,\n\t\tisMultiSelecting,\n\t\tisTyping,\n\t\tisCaretWithinFormattedText,\n\t\thasMultiSelection,\n\t\thasFixedToolbar,\n\t\tlastClientId,\n\t} = useSelect( selector, [] );\n\tconst isLargeViewport = useViewportMatch( 'medium' );\n\tconst [ isToolbarForced, setIsToolbarForced ] = useState( false );\n\tconst [ isInserterShown, setIsInserterShown ] = useState( false );\n\tconst blockNodes = useContext( BlockNodes );\n\tconst { stopTyping } = useDispatch( blockEditorStore );\n\n\t// Controls when the side inserter on empty lines should\n\t// be shown, including writing and selection modes.\n\tconst showEmptyBlockSideInserter =\n\t\t! isTyping && ! isNavigationMode && isEmptyDefaultBlock && isValid;\n\tconst shouldShowBreadcrumb = isNavigationMode;\n\tconst shouldShowContextualToolbar =\n\t\t! isNavigationMode &&\n\t\t! hasFixedToolbar &&\n\t\tisLargeViewport &&\n\t\t! showEmptyBlockSideInserter &&\n\t\t! isMultiSelecting &&\n\t\t( ! isTyping || isCaretWithinFormattedText );\n\tconst canFocusHiddenToolbar =\n\t\t! isNavigationMode &&\n\t\t! shouldShowContextualToolbar &&\n\t\t! hasFixedToolbar &&\n\t\t! isEmptyDefaultBlock;\n\n\tuseShortcut(\n\t\t'core/block-editor/focus-toolbar',\n\t\tuseCallback( () => {\n\t\t\tsetIsToolbarForced( true );\n\t\t\tstopTyping( true );\n\t\t}, [] ),\n\t\t{\n\t\t\tbindGlobal: true,\n\t\t\teventName: 'keydown',\n\t\t\tisDisabled: ! canFocusHiddenToolbar,\n\t\t}\n\t);\n\n\tuseEffect( () => {\n\t\tif ( ! shouldShowContextualToolbar ) {\n\t\t\tsetIsToolbarForced( false );\n\t\t}\n\t}, [ shouldShowContextualToolbar ] );\n\n\t// Stores the active toolbar item index so the block toolbar can return focus\n\t// to it when re-mounting.\n\tconst initialToolbarItemIndexRef = useRef();\n\n\tuseEffect( () => {\n\t\t// Resets the index whenever the active block changes so this is not\n\t\t// persisted. See https://github.com/WordPress/gutenberg/pull/25760#issuecomment-717906169\n\t\tinitialToolbarItemIndexRef.current = undefined;\n\t}, [ clientId ] );\n\n\tif (\n\t\t! shouldShowBreadcrumb &&\n\t\t! shouldShowContextualToolbar &&\n\t\t! isToolbarForced &&\n\t\t! showEmptyBlockSideInserter\n\t) {\n\t\treturn null;\n\t}\n\n\tlet node = blockNodes[ clientId ];\n\n\tif ( ! node ) {\n\t\treturn null;\n\t}\n\n\tconst { ownerDocument } = node;\n\n\tif ( capturingClientId ) {\n\t\tnode = getBlockDOMNode( capturingClientId, ownerDocument );\n\t}\n\n\tlet anchorRef = node;\n\n\tif ( hasMultiSelection ) {\n\t\tconst bottomNode = blockNodes[ lastClientId ];\n\n\t\t// Wait to render the popover until the bottom reference is available\n\t\t// as well.\n\t\tif ( ! bottomNode ) {\n\t\t\treturn null;\n\t\t}\n\n\t\tanchorRef = {\n\t\t\ttop: node,\n\t\t\tbottom: bottomNode,\n\t\t};\n\t}\n\n\tfunction onFocus() {\n\t\tsetIsInserterShown( true );\n\t}\n\n\tfunction onBlur() {\n\t\tsetIsInserterShown( false );\n\t}\n\n\t// Position above the anchor, pop out towards the right, and position in the\n\t// left corner. For the side inserter, pop out towards the left, and\n\t// position in the right corner.\n\t// To do: refactor `Popover` to make this prop clearer.\n\tconst popoverPosition = showEmptyBlockSideInserter\n\t\t? 'top left right'\n\t\t: 'top right left';\n\tconst stickyBoundaryElement = showEmptyBlockSideInserter\n\t\t? undefined\n\t\t: // The sticky boundary element should be the boundary at which the\n\t\t  // the block toolbar becomes sticky when the block scolls out of view.\n\t\t  // In case of an iframe, this should be the iframe boundary, otherwise\n\t\t  // the scroll container.\n\t\t  ownerDocument.defaultView.frameElement ||\n\t\t  getScrollContainer( node ) ||\n\t\t  ownerDocument.body;\n\n\treturn (\n\t\t<Popover\n\t\t\tnoArrow\n\t\t\tanimate={ false }\n\t\t\tposition={ popoverPosition }\n\t\t\tfocusOnMount={ false }\n\t\t\tanchorRef={ anchorRef }\n\t\t\tclassName=\"block-editor-block-list__block-popover\"\n\t\t\t__unstableStickyBoundaryElement={ stickyBoundaryElement }\n\t\t\t__unstableSlotName=\"block-toolbar\"\n\t\t\t__unstableBoundaryParent\n\t\t\t// Observe movement for block animations (especially horizontal).\n\t\t\t__unstableObserveElement={ node }\n\t\t\tshouldAnchorIncludePadding\n\t\t>\n\t\t\t{ ( shouldShowContextualToolbar || isToolbarForced ) && (\n\t\t\t\t<div\n\t\t\t\t\tonFocus={ onFocus }\n\t\t\t\t\tonBlur={ onBlur }\n\t\t\t\t\t// While ideally it would be enough to capture the\n\t\t\t\t\t// bubbling focus event from the Inserter, due to the\n\t\t\t\t\t// characteristics of click focusing of `button`s in\n\t\t\t\t\t// Firefox and Safari, it is not reliable.\n\t\t\t\t\t//\n\t\t\t\t\t// See: https://developer.mozilla.org/en-US/docs/Web/HTML/Element/button#Clicking_and_focus\n\t\t\t\t\ttabIndex={ -1 }\n\t\t\t\t\tclassName={ classnames(\n\t\t\t\t\t\t'block-editor-block-list__block-popover-inserter',\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t'is-visible': isInserterShown,\n\t\t\t\t\t\t}\n\t\t\t\t\t) }\n\t\t\t\t>\n\t\t\t\t\t<Inserter\n\t\t\t\t\t\tclientId={ clientId }\n\t\t\t\t\t\trootClientId={ rootClientId }\n\t\t\t\t\t\t__experimentalIsQuick\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t) }\n\t\t\t{ ( shouldShowContextualToolbar || isToolbarForced ) && (\n\t\t\t\t<BlockContextualToolbar\n\t\t\t\t\t// If the toolbar is being shown because of being forced\n\t\t\t\t\t// it should focus the toolbar right after the mount.\n\t\t\t\t\tfocusOnMount={ isToolbarForced }\n\t\t\t\t\t__experimentalInitialIndex={\n\t\t\t\t\t\tinitialToolbarItemIndexRef.current\n\t\t\t\t\t}\n\t\t\t\t\t__experimentalOnIndexChange={ ( index ) => {\n\t\t\t\t\t\tinitialToolbarItemIndexRef.current = index;\n\t\t\t\t\t} }\n\t\t\t\t/>\n\t\t\t) }\n\t\t\t{ shouldShowBreadcrumb && (\n\t\t\t\t<BlockSelectionButton\n\t\t\t\t\tclientId={ clientId }\n\t\t\t\t\trootClientId={ rootClientId }\n\t\t\t\t\tblockElement={ node }\n\t\t\t\t/>\n\t\t\t) }\n\t\t\t{ showEmptyBlockSideInserter && (\n\t\t\t\t<div className=\"block-editor-block-list__empty-block-inserter\">\n\t\t\t\t\t<Inserter\n\t\t\t\t\t\tposition=\"bottom right\"\n\t\t\t\t\t\trootClientId={ rootClientId }\n\t\t\t\t\t\tclientId={ clientId }\n\t\t\t\t\t\t__experimentalIsQuick\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t) }\n\t\t</Popover>\n\t);\n}\n\nfunction wrapperSelector( select ) {\n\tconst {\n\t\tgetSelectedBlockClientId,\n\t\tgetFirstMultiSelectedBlockClientId,\n\t\tgetBlockRootClientId,\n\t\t__unstableGetBlockWithoutInnerBlocks,\n\t\tgetBlockParents,\n\t\t__experimentalGetBlockListSettingsForBlocks,\n\t} = select( blockEditorStore );\n\n\tconst clientId =\n\t\tgetSelectedBlockClientId() || getFirstMultiSelectedBlockClientId();\n\n\tif ( ! clientId ) {\n\t\treturn;\n\t}\n\n\tconst { name, attributes = {}, isValid } =\n\t\t__unstableGetBlockWithoutInnerBlocks( clientId ) || {};\n\tconst blockParentsClientIds = getBlockParents( clientId );\n\n\t// Get Block List Settings for all ancestors of the current Block clientId\n\tconst parentBlockListSettings = __experimentalGetBlockListSettingsForBlocks(\n\t\tblockParentsClientIds\n\t);\n\n\t// Get the clientId of the topmost parent with the capture toolbars setting.\n\tconst capturingClientId = find(\n\t\tblockParentsClientIds,\n\t\t( parentClientId ) =>\n\t\t\tparentBlockListSettings[ parentClientId ]\n\t\t\t\t?.__experimentalCaptureToolbars\n\t);\n\n\treturn {\n\t\tclientId,\n\t\trootClientId: getBlockRootClientId( clientId ),\n\t\tname,\n\t\tisValid,\n\t\tisEmptyDefaultBlock:\n\t\t\tname && isUnmodifiedDefaultBlock( { name, attributes } ),\n\t\tcapturingClientId,\n\t};\n}\n\nexport default function WrappedBlockPopover() {\n\tconst selected = useSelect( wrapperSelector, [] );\n\n\tif ( ! selected ) {\n\t\treturn null;\n\t}\n\n\tconst {\n\t\tclientId,\n\t\trootClientId,\n\t\tname,\n\t\tisValid,\n\t\tisEmptyDefaultBlock,\n\t\tcapturingClientId,\n\t} = selected;\n\n\tif ( ! name ) {\n\t\treturn null;\n\t}\n\n\treturn (\n\t\t<BlockPopover\n\t\t\tclientId={ clientId }\n\t\t\trootClientId={ rootClientId }\n\t\t\tisValid={ isValid }\n\t\t\tisEmptyDefaultBlock={ isEmptyDefaultBlock }\n\t\t\tcapturingClientId={ capturingClientId }\n\t\t/>\n\t);\n}\n"]}