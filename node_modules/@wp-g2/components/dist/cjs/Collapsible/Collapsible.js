"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _objectWithoutProperties2 = _interopRequireDefault(require("@babel/runtime/helpers/objectWithoutProperties"));

var _context = require("@wp-g2/context");

var _utils = require("@wp-g2/utils");

var _react = _interopRequireDefault(require("react"));

var _reakit = require("reakit");

var _View = require("../View");

var _Collapsible = require("./Collapsible.Context");

function Collapsible(props, forwardedRef) {
  var _useContextSystem = (0, _context.useContextSystem)(props, 'Collapsible'),
      baseId = _useContextSystem.baseId,
      children = _useContextSystem.children,
      visible = _useContextSystem.visible,
      _useContextSystem$onV = _useContextSystem.onVisibleChange,
      onVisibleChange = _useContextSystem$onV === void 0 ? _utils.noop : _useContextSystem$onV,
      otherProps = (0, _objectWithoutProperties2.default)(_useContextSystem, ["baseId", "children", "visible", "onVisibleChange"]);

  var disclosure = (0, _reakit.useDisclosureState)({
    baseId: baseId,
    visible: visible
  });
  (0, _utils.useUpdateEffect)(function () {
    if (!visible) {
      disclosure.hide();
    } else {
      disclosure.show();
    }
  }, [visible]);
  (0, _utils.useUpdateEffect)(function () {
    onVisibleChange(disclosure.visible, disclosure);
  }, [disclosure.visible]);
  return /*#__PURE__*/_react.default.createElement(_Collapsible.CollapsibleContext.Provider, {
    value: {
      disclosure: disclosure
    }
  }, /*#__PURE__*/_react.default.createElement(_View.View, Object.assign({}, otherProps, {
    "data-expanded": disclosure.visible,
    ref: forwardedRef
  }), children));
}

var _default = (0, _context.contextConnect)(Collapsible, 'Collapsible');

exports.default = _default;